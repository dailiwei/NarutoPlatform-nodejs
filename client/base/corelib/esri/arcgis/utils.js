// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.16/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(r,h,g,t,q,e,w,d,a,c){r=r([a],{declaredClass:"esri.layers._OnDemandMode",constructor:function(f){this.featureLayer=f;this._featureMap={};this._queryErrorHandler=g.hitch(this,this._queryErrorHandler)},initialize:function(f){this.inherited(arguments);var m=this.featureLayer,
a=m._srInfo;this._gridLayer=new c(new w(a?a.valid[0]:f.extent.xmin,a?a.valid[1]:f.extent.ymax,f.spatialReference),{width:m._tileWidth,height:m._tileHeight},{width:f.width,height:f.height},a);this._cellMap={};this._gridLayer.setResolution(f.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(f){this._init&&(2>f?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(f){var m=this._gridLayer,a=f.geometry,c=[];if(a)for(var c=m.getCellsInExtent("point"===a.type?{xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y}:a.getExtent(),!1).cells,m=this._cellMap,d,b=f.attributes[this.featureLayer.objectIdField],k,z,u,a=0;a<c.length;a++)d=c[a],k=d.latticeID,z=d.row,u=d.col,k?d=m[k]=m[k]||d:(m[z]=m[z]||{},d=m[z][u]=m[z][u]||d),d.features=
d.features||[],d.features.push(f),this._addFeatureIIf(b,f),this._incRefCount(b)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},_enableConnectors:function(){var f=this.map;this._zoomConnect=h.connect(f,"onZoomEnd",this,this._zoomHandler);this._panConnect=h.connect(f,"onPanEnd",this,this._panHandler);this._resizeConnect=h.connect(f,"onResize",this,this._panHandler)},_disableConnectors:function(){h.disconnect(this._zoomConnect);
h.disconnect(this._panConnect);h.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var f=this.featureLayer,m=this.map;f.suspended||(f._fireUpdateStart(),this._clearIIf(),(f=f._trackManager)&&f.clearTracks(),this._cellMap={},this._gridLayer.setResolution(m.extent),this._sendRequest())},_panHandler:function(f){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&f)},_getRequestId:function(f,m){return("_"+f.name+f.layerId+f._ulid+"_"+m.resolution+
"_"+(m.latticeID||m.row+"_"+m.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(f){this._exceeds=!1;var m=this.featureLayer,a=this.map;f=f||a.extent;a=this._gridLayer.getCellsInExtent(f,m.latticeTiling).cells;if(!m.isEditable())var c=this._cellMap,a=t.filter(a,function(b){if(b.lattice){if(c[b.latticeID])return!1}else if(c[b.row]&&c[b.row][b.col])return!1;return!0});var e=m.getOutFields(),b=m.getDefinitionExpression(),k=m._getOffsettedTE(m._mapTimeExtent),z=m.supportsAdvancedQueries?m.getOrderByFields():
null,u=m._usePatch,v=this._ioQueue,y,p=this,l=this._drawFeatures,s,g,N;this._pending=this._pending||0;for(y=0;y<a.length;y++){s=a[y];g=new d;g.geometry=s.extent||s.lattice;g.outFields=e;g.where=b;m.latticeTiling&&s.extent&&(g.spatialRelationship=d.SPATIAL_REL_CONTAINS);g.returnGeometry=!0;g.timeExtent=k;m._ts&&(g._ts=(new Date).getTime());g.orderByFields=z;g.multipatchOption=m.multipatchOption;g.maxAllowableOffset=m._maxOffset;g.quantizationParameters=m._quantizationParameters;if((N=m.advancedQueryCapabilities)&&
N.supportsQueryWithResultType)g.resultType="tile";N=null;if(u&&(N=this._getRequestId(m,s),this._isPending(N)))continue;this._pending++;v.push(m._task.execute(g,function(){var b=s;return function(k){l.apply(p,[k,b])}}.call(this),this._queryErrorHandler,N))}this._removeOldCells(f);this._endCheck()},_drawFeatures:function(f,m){this._exceeds=this._exceeds||f.exceededTransferLimit;this._finalizeIO();var a=this.map.extent,c=m.extent,d=m.row,b=m.col,k=this.featureLayer.objectIdField,z=f.features,u=this._gridLayer,
v=this._cellMap,y=m.latticeID,p=y?v[y]:v[d]&&v[d][b];if(m.resolution!=u._resolution||(y?y!==u.getLatticeID(a):!u.intersects(c,a)))p&&this._removeCell(d,b,y);else if(p)this._updateCell(p,z);else{m.features=z;y?v[y]=m:(v[d]=v[d]||{},v[d][b]=m);c=z.length;for(a=0;a<c;a++)d=z[a],b=d.attributes[k],this._addFeatureIIf(b,d),this._incRefCount(b)}this._endCheck()},_queryErrorHandler:function(f){this._finalizeIO();this.featureLayer._errorHandler(f);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();
this._pending--},_endCheck:function(f){if(0===this._pending){this._processIOQueue();var a=this.featureLayer,c=a._trackManager;c&&(c.clearTracks(),c.addFeatures(a.graphics),a._ager&&t.forEach(a.graphics,function(f){f._shape&&a._repaint(f)}),c.moveLatestToFront(),c.drawTracks());this.featureLayer._fireUpdateEnd(f&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)a.onQueryLimitExceeded()}},_processIOQueue:function(f){this._ioQueue=
t.filter(this._ioQueue,function(f){return-1<f.fired?!1:!0});f&&t.forEach(this._ioQueue,this._cancelPendingRequest)},_removeOldCells:function(f){var a=this._cellMap,c=this._gridLayer,d,e;for(d in a)if(a[d]){var b=a[d],k=b.latticeID,z=0,u=0;if(k)z++,k!==c.getLatticeID(f)&&(this._removeCell(null,null,k),u++);else for(e in b)b[e]&&(z++,c.intersects(b[e].extent,f)||(this._removeCell(d,e),u++));u===z&&delete a[d]}},_updateCell:function(f,a){var c=this.featureLayer,d=c.objectIdField,c=c._selectedFeatures,
e,b=a.length;f.features=f.features||[];for(e=0;e<b;e++){var k=a[e],z=k.attributes[d],u=this._addFeatureIIf(z,k);u===k?(this._incRefCount(z),f.features.push(u)):z in c||(u.setGeometry(k.geometry),u.setAttributes(k.attributes))}},_removeCell:function(f,a,c){var d=this._cellMap,e=this.featureLayer,b=e.objectIdField,k=c?d[c]:d[f]&&d[f][a];if(k){c?delete d[c]:delete d[f][a];f=k.features;for(a=0;a<f.length;a++)c=f[a].attributes[b],this._decRefCount(c),c in e._selectedFeatures||this._removeFeatureIIf(c)}}});
q("extend-esri")&&g.setObject("layers._OnDemandMode",r,e);return r})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(r,h,g,t,q,e){return r([e,q],{_onMap:function(e){var d=this.constructor._onMap,a;if(!d||!d.FINAL)delete this.constructor._onMap,d=this.registerConnectEvents(),d.FINAL=!0;e=e.toLowerCase();d[e]?a=this[d[e].method]:(e=this._onCamelCase(e),this[e]&&(a=e));return a},on:function(e,d){var a=
this._onMap(e),c=e.replace(/\-/g,""),f="on"+c in this.domNode;return a||!f?this.inherited(arguments):this.own(t(this.domNode,c,d))[0]},emit:function(e,d,a){var c,f,m,g=e.toLowerCase(),n=this.constructor._onMap||this.registerConnectEvents();f=this[this._onMap(g)];d=d||{};d.target||(d.target=this);f&&(n&&n[g])&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},n[g].argKeys)(d),m=h.mixin({},arguments),m[2]=c,m[0]=n[g].name.replace(/^on/,""));return this.inherited(m||arguments)}})})},
"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),function(r,h,g,t,q,e,w,d,a,c,f,m,x){function n(){}function A(b){var k=b.layer;return{geometry:b.geometry,attributes:b.attributes,getLayer:function(){return k}}}r=r(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,
sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(b){this.sourceLayer=b;this._hndls=[]},initialize:function(b){this.map=b;var k=this.sourceLayer,a=k.renderer;k.setDrawMode(!1);this.imageLayer=b._getMapImageLyr();var c=this;this.heatmapRenderer=a instanceof f?a:(a.getRendererInfoByZoom(b.getZoom())||a.getRendererInfoByScale(b.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=
this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=this._reprojectFeature.bind(this);q(["../workers/heatmapCalculator"],function(b){c._calculator=new b(h.mixin({width:c.map.width,height:c.map.height},c._getOptions()));c._setupRenderer();c.heatmapRenderer.getStats=b.calculateStats;
c.heatmapRenderer.getHistogramData=b.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},_handleRendererChange:function(b){var k=b.renderer,a=k instanceof f;this.heatmapRenderer?a?this.heatmapRenderer=k:this._removeRenderer(b):a&&(this.heatmapRenderer=k,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(b){b=
b.opacity;var k=this._getImageBySourceId(this.sourceLayer.id);k&&k.setOpacity(b)},_setupRenderer:function(){var b=this._hndls,k=this.sourceLayer,a=this.map,f=this;k._originalDraw=k._draw;k._draw=n;k._div.clear();clearTimeout(this._resetTimer);this._resetTimer=setTimeout(this._resetGraphics.bind(this),250);b.push(k.on("update-end",this._setupDraw));b.push(k.on("suspend",function(b){(b=f._getImageBySourceId(f.sourceLayer.id))&&b.hide()}));b.push(k.on("resume",function(b){(b=f._getImageBySourceId(f.sourceLayer.id))&&
b.show()}));b.push(g.after(k,"redraw",this._setupDraw));b.push(a.on("layer-remove",function(b){b.layer==k&&((b=f._getImageBySourceId(f.sourceLayer.id))&&f.imageLayer.removeImage(b),f._removeRenderer({target:k}))}));k._collection&&b.push(k.on("graphic-add",function(b){f._reprojectFeature(b.graphic);f._setupDraw()}));1!==k.mode&&(b.push(a.on("resize, pan-end",this._setupDraw)),b.push(a.on("zoom-end",this._setupDraw)));b.push(k.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&
this.imageLayer.resume();k.graphics&&k.graphics.length&&(k.graphics[0].geometry&&!a.spatialReference.equals(k.graphics[0].geometry.spatialReference)&&t.forEach(k.graphics,function(b){this._reprojectFeature(b)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var b=this;this._drawTimer=setTimeout(function(){clearTimeout(b._drawTimer);b._drawTimer=null;b.sourceLayer._getRenderer().isInstanceOf(f)&&b.recalculateHeatmap()},16)}},_removeRenderer:function(b){var k=b.target;k._draw=
k._originalDraw;delete k._originalDraw;k.setDrawMode(!0);this._removeHandlers();this._hndls=[];var a=this._getImageBySourceId(this.sourceLayer.id);a&&this.imageLayer.removeImage(a);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;k.renderer!=b.renderer&&k.renderer.getRendererInfo?this.heatmapRenderer=null:(k.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},
_reprojectFeature:function(b){if(b&&b.geometry){var k=b.geometry,f=this.map.spatialReference;f.equals(k.spatialReference)||(k=a.project(k,f),null==k?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):b.geometry=k)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var b=this.sourceLayer,k=this.map,a=this.heatmapRenderer,f=this.map.extent,d=this.map.width,y=this.map.height,p=this._calculator,l=this,s=function(s){s=
l._getScreenPoints(s.features,k,b);s=p.calculateImageData(h.mixin({screenPoints:s,mapinfo:{extent:[f.xmin,f.ymin,f.xmax,f.ymax],resolution:k.getResolution()},width:d,height:y},l._getOptions()));s=a.getSymbol(A({geometry:k.extent,attributes:{size:[d,y],imageData:s},layer:b}));s=new c({extent:k.extent,href:s.url,opacity:0,sourceId:b.id});l._swapMapImages(s,l._getImageBySourceId(b.id));b.suspended&&s.hide()},e={geometry:k.extent,timeExtent:b.useMapTime?k.timeExtent:void 0,spatialRelationship:m.SPATIAL_REL_INTERSECTS};
null!=b._canDoClientSideQuery(e)?b.queryFeatures(e,s):s({features:b.graphics})},_getScreenPoints:function(b,k,f){var a=[],c=b.length,m=0,p=0,l,s=new d(k.extent.xmin,k.extent.ymax,k.spatialReference),e=k.toScreen(s),n=e.x,e=e.y,g=k.getResolution(),x;for((p=k.extent.getCacheValue("_parts"))&&(x=t.map(p,function(b){return f._intersects(k,b.extent)[0]}));c--;)p=b[c],p.geometry&&(l={x:Math.ceil((p.geometry.x-s.x)/g+n),y:Math.floor((s.y-p.geometry.y)/g-e),attributes:p.attributes},x&&(p=1<x.length&&l.x<
-x[0]?x[1]:x[0],l.x+=p),a[m++]=l);return a},_getImageBySourceId:function(b){var k=this.imageLayer.getImages(),k=t.filter(k,function(k){return k.sourceId==b});if(k.length)return k[k.length-1]},_swapMapImages:function(b,k){function f(){a.removeImage(k)}var a=this.imageLayer,c=this.sourceLayer.opacity||1;a.addImage(b);x.anim(b._node,{opacity:c},null,null,function(){b.opacity=c});null!=k&&x.anim(k._node,{opacity:0},null,null,f)},_removeHandlers:function(){if(null!=this._hndls)for(var b=this._hndls.length;b--;)this._hndls[b].remove()},
_getOptions:function(){var b=this.heatmapRenderer;return{blurRadius:b.blurRadius,gradient:b.gradient,maxPixelIntensity:b.maxPixelIntensity,minPixelIntensity:b.minPixelIntensity,field:b.field,fieldOffset:b.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);this._resetTimer=null;for(var b=this.sourceLayer.graphics,k=b.length,f;k--;)f=b[k],f._shape=f._offsets=void 0}});w("extend-esri")&&h.setObject("layers.HeatmapManager",r,e);return r})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),
function(r,h,g,t,q,e,w){var d={_isElementShown:function(a){var c=t.get(a);return"hidden"!=c.visibility&&"collapsed"!=c.visibility&&"none"!=c.display&&"hidden"!=g.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return g.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var c;try{var f=a.contentDocument;if("designMode"in f&&"on"==f.designMode)return!0;c=f.body}catch(m){try{c=a.contentWindow.document.body}catch(d){return!1}}return c&&
("true"==c.contentEditable||c.firstChild&&"true"==c.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(a){return g.get(a,"disabled")?void 0:g.has(a,"tabIndex")?+g.get(a,"tabIndex"):d.hasDefaultTabStop(a)?0:void 0},isTabNavigable:function(a){return 0<=d.effectiveTabIndex(a)},isFocusable:function(a){return-1<=d.effectiveTabIndex(a)},_getTabNavigable:function(a){function c(b){return b&&"input"==b.tagName.toLowerCase()&&b.type&&"radio"==b.type.toLowerCase()&&
b.name&&b.name.toLowerCase()}var f,m,x,n,h,b,k={},z=d._isElementShown,u=d.effectiveTabIndex,v=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=e("ie")&&"HTML"!==a.scopeName||!z(a))){var p=u(a);if(0<=p){if(0==p)f||(f=a),m=a;else if(0<p){if(!x||p<n)n=p,x=a;if(!h||p>=b)b=p,h=a}p=c(a);g.get(a,"checked")&&p&&(k[p]=a)}"SELECT"!=a.nodeName.toUpperCase()&&v(a)}};z(a)&&v(a);return{first:k[c(f)]||f,last:k[c(m)]||m,lowest:k[c(x)]||x,highest:k[c(h)]||h}},getFirstInTabbingOrder:function(a,
c){var f=d._getTabNavigable(h.byId(a,c));return f.lowest?f.lowest:f.first},getLastInTabbingOrder:function(a,c){var f=d._getTabNavigable(h.byId(a,c));return f.last?f.last:f.highest}};q.mixin(w,d);return d})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),function(r,h,g,t,q,e,w,d,a,c){r=r([c],{declaredClass:"esri.layers._StreamMode",
constructor:function(a,c){this.featureLayer=a;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=h.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;a.purgeOptions&&(a.purgeOptions.age&&"number"===typeof a.purgeOptions.age)&&(this._maxFeatureAge=1E3*Math.ceil(60*a.purgeOptions.age));this._drawFeatures=h.hitch(this,this._drawFeatures);this._queryErrorHandler=h.hitch(this,
this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(a){this._init&&(0===a?this._applyTimeFilter():3===a?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},drawFeature:function(a){var c=this.featureLayer,d=c.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));c._joinField&&this._getFeature(a.attributes[d])?this._drawBuffer.updates.push({oid:a.attributes[d],
updates:a}):this._drawBuffer.adds.push(a)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var a=this.featureLayer;a&&(!a._relatedUrl&&!a._keepLatestUrl?(a._fireUpdateStart(),a.clear(),a._fireUpdateEnd()):(a._fireUpdateStart(),a._refreshing=!0,a.disconnect(),a.clear(),a._relatedQueried=!1,a._keepLatestQueried=!1,a.connect()))},_drawFeatures:function(a,c){this._purgeRequests();var d=this.featureLayer;d._create(a.features||[]);d._fireUpdateEnd(null,c)},_applyTimeFilter:function(a){this.inherited(arguments);
this._redrawAllTracks()},_removeFeatures:function(a){var c=this.featureLayer,d=c.objectIdField;a&&g.forEach(a,function(a){a=a.attributes[d];c._unSelectFeatureIIf(a,this);this._decRefCount(a);this._removeFeatureIIf(a)},this)},_addFeatures:function(a){var c=this.featureLayer,d=c._endTimeField,e=c._startTimeField,h,b,k,z=[],u=[],v=[];h=c._trackManager;b=c.objectIdField;if(h)for(k in a=h.addFeatures(a),a)a.hasOwnProperty(k)&&(z.push(k),a[k].adds&&(u=u.concat(a[k].adds)),a[k].deletes&&(v=v.concat(a[k].deletes)));
else u=a;g.forEach(u,function(a){var k=a.attributes[b],c;c=d&&a.attributes[d];!c&&this._maxFeatureAge&&(c=e&&a.attributes[e]?a.attributes[e]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);c&&(c=1E3*Math.ceil(c/1E3),this._featuresByTime[c]?this._featuresByTime[c].push(k):this._featuresByTime[c]=[k]);this._addFeatureIIf(k,a);this._incRefCount(k)},this);v.length&&this._removeFeatures(v);h&&h.refreshTracks(z)},_updateFeatures:function(a){var c=this.featureLayer,d,e,h=[];d=c._trackManager;e=c._trackIdField;
g.forEach(a,function(b){var a=b.updates;b=this._getFeature(b.oid);var f;if(b){a.geometry&&b.setGeometry(a.geometry);a=a.attributes||{};for(f in a)a.hasOwnProperty(f)&&(b.attributes[f]=a[f]);b.visible=this._checkFeatureTimeIntersects(b);d&&b.attributes[e]?h.push(b.attributes[e]):c._repaint(b,null,!0)}},this);h.length&&d.refreshTracks(h)},_redrawAllTracks:function(){var a=this.featureLayer._trackManager,c;if(a&&(c=a.trimTracks())&&0<c.length)this._removeFeatures(c),a.refreshTracks()},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);
var a=this._drawBuffer,c=a.adds.splice(0,a.adds.length),d=a.updates.splice(0,a.updates.length),a=this.featureLayer;if(!a)return!1;a.updating||a._fireUpdateStart();this._addFeatures(c);this._updateFeatures(d);if((c=this._getExpiredFeatures())&&c.length)this._removeFeatures(c),a._trackManager&&a._trackManager.removeFeatures(c);a._purge();a._fireUpdateEnd();this._timeoutId=null},_clearDrawBuffer:function(){var a=this._timeoutId,c=this._drawBuffer,d=c.adds,c=c.updates;a&&clearTimeout(a);d.splice(0,d.length);
c.splice(0,c.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(a){a=a||0===a?a:200;0>a&&(a=200);this._refreshRate=a},_checkFeatureTimeIntersects:function(a){var c=this.featureLayer,d=c.getMap(),d=d?d.timeExtent:null;return!d||!c.timeInfo||!c.timeInfo.startTimeField&&!c.timeInfo.endTimeField?!0:0<c._filterByTime([a],d.startTime,d.endTime).match.length},
_getRequestId:function(a){return("_"+a.name+a.layerId+a._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(c){var m=this.featureLayer,g,n,h,b,k;m._fireUpdateStart();if(c&&this.map){g=new d(c);n=new w;c=this.map;h=m.getFilter()||{};b=h.where||"1\x3d1";k=h.geometry?a.fromJson(h.geometry):null;h=h.outFields?h.outFields.split(","):["*"];n.geometry=k;n.where=b;n.outFields=h;n.returnGeometry=!0;n.outSpatialReference=new e(c.spatialReference.toJson());m._usePatch&&(c=this._getRequestId(m),this._cancelPendingRequest(null,
c));var z=0,u=this,v=null,y=function(b){z++;g.execute(n).then(function(a){b(null,a)},function(a){b(a)})},p=function(b,a){b?2<=z||!m._relatedUrl?u._queryErrorHandler(Error("Could not get features from related feature service")):(v={relatedFeatureWarning:"Querying related feature service using the current filter failed. All related features are displayed, and the filter is applied to the stream service only"},n.where="1\x3d1",y(p)):u._drawFeatures(a,v)};y(p)}else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),
!1},_queryErrorHandler:function(a){this._purgeRequests();var c=this.featureLayer;c._errorHandler(a);c._fireUpdateEnd(a)},_getExpiredFeatures:function(){var a,c,d,e=[],h=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return h;a=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=c=1E3*Math.ceil(Date.now()/1E3);if(a&&a!==c)for(d=this._featuresByTime;a<=c;a+=1E3)d[a]&&(e=e.concat(d[a]),delete d[a]);g.forEach(e,function(a){(a=this._getFeature(a))&&h.push(a)},this);return h}});
t("extend-esri")&&h.setObject("layers._StreamMode",r,q);return r})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A,b){r=r(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){h.mixin(this,b);this.info=
a;this.title=this.getTitle;this.content=this.getContent;var c=this._fieldLabels={},d=this._fieldsMap={};a.fieldInfos&&g.forEach(a.fieldInfos,function(a){var b=a.fieldName.toLowerCase();c[b]=a.label;d[b]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return t.fromJson(t.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var b;g.some(this.info&&this.info.fieldInfos,
function(c){c.fieldName===a&&(b=c);return!!b});return b},getComponents:function(a){var b=this.info,c=new w,d,f;b.fieldInfos&&(f=g.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));f&&0<f.length&&(d=this._getRelatedRecords({graphic:a,fieldsInfo:f}));d?d.always(h.hitch(this,function(){c.resolve(this._getPopupValues(a))})):c.resolve(this._getPopupValues(a));return c.promise},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&
(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_getPopupValues:function(a,b){var d=this.info,f=a.getLayer(),e=h.clone(a.attributes)||{},p=h.clone(e),l=d.fieldInfos,s="",m="",n,C,x,q,t,r=f&&f._getDateOpts&&f._getDateOpts().properties,r=r&&r.slice(0),A={dateFormat:{properties:r,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(q in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(q)){var w=
this._relatedInfo[q],E=this._relatedLayersInfo[q];w&&(g.forEach(w.relatedFeatures,function(a){for(t in a.attributes)if(a.attributes.hasOwnProperty(t)&&"esriRelCardinalityOneToOne"===E.relation.cardinality){var b=this._toRelatedFieldName([E.relation.id,t]);e[b]=p[b]=a.attributes[t]}},this),g.forEach(w.relatedStatsFeatures,function(a){for(t in a.attributes)if(a.attributes.hasOwnProperty(t)){var b=this._toRelatedFieldName([E.relation.id,t]);e[b]=p[b]=a.attributes[t]}},this))}l&&g.forEach(l,function(a){C=
a.fieldName;var b=this._getLayerFieldInfo(f,C);b&&(C=a.fieldName=b.name);p[C]=this._formatValue(p[C],C,A);r&&(a.format&&a.format.dateFormat)&&(a=g.indexOf(r,C),-1<a&&r.splice(a,1))},this);if(f){q=f.types;var F=(w=f.typeIdField)&&e[w];for(C in e)if(e.hasOwnProperty(C)&&-1===C.indexOf(this._relatedFieldPrefix)&&(x=e[C],c.isDefined(x))){var D=this._getDomainName(f,a,q,F,C,x);c.isDefined(D)?p[C]=D:C===w&&(D=this._getTypeName(f,a,x),c.isDefined(D)&&(p[C]=D))}}d.title&&(s=this._processFieldsInLinks(this._fixTokens(d.title,
f),e),s=h.trim(c.substitute(p,s,A)||""));if(b)return{title:s};d.description&&(m=this._processFieldsInLinks(this._fixTokens(d.description,f),e),m=h.trim(c.substitute(p,m,A)||""));l&&(n=[],g.forEach(l,function(a){(C=a.fieldName)&&a.visible&&n.push([a.label||C,c.substitute(p,"${"+C+"}",A)||""])}));var Q,K;d.mediaInfos&&(Q=[],g.forEach(d.mediaInfos,function(a){K=0;x=a.value;switch(a.type){case "image":var b=x.sourceURL,b=b&&h.trim(c.substitute(e,this._fixTokens(b,f)));K=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":var k,
b=x.normalizeField;x.fields=g.map(x.fields,function(a){return(k=this._getLayerFieldInfo(f,a))?k.name:a},this);b&&(k=this._getLayerFieldInfo(f,b),x.normalizeField=k?k.name:b);K=g.some(x.fields,function(a){return c.isDefined(e[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(K){a=h.clone(a);x=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title,f),e):"",d=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,f),e):"";a.title=
b?h.trim(c.substitute(p,b,A)||""):"";a.caption=d?h.trim(c.substitute(p,d,A)||""):"";if("image"===a.type)x.sourceURL=c.substitute(e,this._fixTokens(x.sourceURL,f)),x.linkURL&&(x.linkURL=h.trim(c.substitute(e,this._fixTokens(x.linkURL,f))||""));else{var s,l;g.forEach(x.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))l=this._getRelatedChartInfos(a,x,e,A),l instanceof Array?x.fields=l:x.fields[b]=l;else{var k=e[a],k=void 0===k?null:k;s=e[x.normalizeField]||0;k&&s&&(k/=s);x.fields[b]=
{y:k,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(k,a,A,!!s)}}},this)}Q.push(a)}},this));return{title:s,description:m,hasDescription:!!d.description,fields:n&&n.length?n:null,mediaInfos:Q&&Q.length?Q:null,formatted:p,editSummary:f&&f.getEditSummary?f.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,c,d){var f,p,l,s,e,m;f=[];m=this._fromRelatedFieldName(a);e=m[0];p=this._relatedInfo[e];e=this._relatedLayersInfo[e];p&&g.forEach(p.relatedFeatures,function(p){p=
p.attributes;var e,g;for(g in p)if(p.hasOwnProperty(g)&&g===m[1]){e={};s=p[g];b.normalizeField&&(l=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?p[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);s&&l&&(s/=l);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var n=this._fromRelatedFieldName(b.tooltipField)[1];e.tooltip=p[n]&&"string"===typeof p[n]?p[n]+":\x3cbr/\x3e"+this._formatValue(s,p[n],d,!!l):n+":\x3cbr/\x3e"+this._formatValue(s,n,d,!!l)}else e.tooltip=
(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(s,b.tooltipField,d,!!l);else e.tooltip=s;e.y=s;f.push(e)}},this);return"esriRelCardinalityOneToMany"===e.relation.cardinality||"esriRelCardinalityManyToMany"===e.relation.cardinality?f:f[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,
_fixTokens:function(a,b){var c=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,k,d){a=c._getLayerFieldInfo(b,d);return"$"+(a?"{"+a.name+"}":k)})},_encodeAttributes:function(a){a=h.clone(a)||{};var b,c;for(b in a)if((c=a[b])&&"string"===typeof c)c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),a[b]=c;return a},_processFieldsInLinks:function(a,b){var c=this._encodeAttributes(b),d=this;a&&(a=a.replace(this._reHref,function(a,k){return d._addValuesToHref(a,k,b,c)}).replace(this._reHrefApos,function(a,
k){return d._addValuesToHref(a,k,b,c)}));return a},_addValuesToHref:function(a,b,d,f){b=b&&h.trim(b);return c.substitute(b&&0===b.indexOf("${")?d:f,a)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(a,d,f,e){var m=this._fieldsMap[d.toLowerCase()],p=m&&m.format;d=-1!==g.indexOf(f.dateFormat.properties,d);var l="number"===typeof a&&!d&&(!p||!p.dateFormat);if(!c.isDefined(a)||!m||!c.isDefined(p))return l?this._forceLTR(a):a;var s="",m=[],n=p.hasOwnProperty("places")||
p.hasOwnProperty("digitSeparator"),N=p.hasOwnProperty("digitSeparator")?p.digitSeparator:!0;if(n&&!d)s="NumberFormat",m.push("places: "+(c.isDefined(p.places)&&(!e||0<p.places)?Number(p.places):"Infinity")),m.length&&(s+="("+m.join(",")+")");else if(p.dateFormat)s="DateFormat"+this._insertOffset(this._dateFormats[p.dateFormat]||this._dateFormats.shortDateShortTime);else return l?this._forceLTR(a):a;var C=this._applyFormatting(a,s,f);n&&-1<a.constructor.toString().indexOf("Array")&&(C="",g.forEach(a,
h.hitch(this,function(a){C=C+this._applyFormatting(a,s,f)+" "})));n&&!N&&b.group&&(C=C.replace(RegExp("\\"+b.group,"g"),""));return l?this._forceLTR(C):C},_applyFormatting:function(a,b,d){return c.substitute({myKey:a},"${myKey:"+b+"}",d)||""},_forceLTR:function(a){var b=d("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=c.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,
b,c,d,f,e){return(a=a.getDomain&&a.getDomain(f,{feature:b}))&&a.codedValues?a.getName(e):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c=new w,d;this._relatedLayersInfo?this._queryRelatedLayers(b).then(h.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),h.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(h.hitch(this,function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=
a[d]);this._queryRelatedLayers(b).then(h.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),h.hitch(this,this._handlerErrorResponse,c))}),h.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(b){var c=b.fieldsInfo,d,f,e={};d=b.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});g.forEach(c,function(a){var b,c,k,f;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(this._relatedLayersInfo[c]||(g.some(d.relationships,
function(a){if(a.id==c)return f=a,!0}),f&&(this._relatedLayersInfo[c]={relation:f,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(k=new A,k.statisticType=a.statisticType,k.onStatisticField=b,k.outStatisticFieldName=b,this._relatedLayersInfo[c].outStatistics.push(k))))},this);for(f in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(f)&&this._relatedLayersInfo[f]&&(b=this._relatedLayersInfo[f].relation,
b=d.url.replace(/[0-9]+$/,b.relatedTableId),this._relatedLayersInfo[f].relatedLayerUrl=b,e[f]=m({url:b,content:{f:"json"},callbackParamName:"callback"}));return a(e)},_queryRelatedLayers:function(b){var c={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(c[d]=this._queryRelatedLayer({graphic:b,relatedInfo:this._relatedLayersInfo[d]}));return a(c)},_queryRelatedLayer:function(b){var c,d,f,e,p,l,s,m,h,C;c=b.graphic;d=c.getLayer().url.match(/[0-9]+$/g)[0];m=b.relatedInfo;
s=m.relatedLayerInfo;h=m.relatedLayerUrl;C=m.relation;g.some(s.relationships,function(a){if(a.relatedTableId===parseInt(d,10))return f=a,!0},this);f&&(b=new x,g.some(s.fields,function(a){if(a.name===f.keyField)return p=-1!==g.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),e="string"===p?f.keyField+"\x3d'"+c.attributes[C.keyField]+"'":f.keyField+"\x3d"+c.attributes[C.keyField],b.where=e,b.outFields=m.relatedFields,
m.outStatistics&&(0<m.outStatistics.length&&s.supportsStatistics)&&(l=new x,l.where=b.where,l.outFields=b.outFields,l.outStatistics=m.outStatistics),c=new n(h),e=[],e.push(c.execute(b)),l&&e.push(c.execute(l)));return a(e)},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var d in b)if(b.hasOwnProperty(d)&&b[d]){var f=b[d];this._relatedInfo[d]={};this._relatedInfo[d].relatedFeatures=f[0].features;c.isDefined(f[1])&&(this._relatedInfo[d].relatedStatsFeatures=f[1].features)}},_handlerErrorResponse:function(a,
b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});e("extend-esri")&&(f.PopupInfo=f.PopupInfoTemplate=r);return r})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(r,h,g,t,q,e,w){q.add("highcontrast",function(){var d=
w.doc.createElement("div");d.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(h.blankGif||r.toUrl("./resources/blank.gif"))+'");';w.body().appendChild(d);var a=t.getComputedStyle(d),c=a.backgroundImage,a=a.borderTopColor==a.borderRightColor||c&&("none"==c||"url(invalid-url:)"==c);8>=q("ie")?d.outerHTML="":w.body().removeChild(d);return a});e(function(){q("highcontrast")&&g.add(w.body(),"dj_a11y")});return q})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A,b,k,z,u,v,y,p,l){function s(a){return function(b){d[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}x.add("dijit-legacy-requires",!n.isAsync);x.add("dojo-bidi",!1);x("dijit-legacy-requires")&&k(0,function(){r(["dijit/_base/manager"])});var U={};t=e("dijit._WidgetBase",[z,y],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:s("lang"),dir:"",_setDirAttr:s("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:t.blankGif||r.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,
d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=w.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,A.mixin(this,a));this.postMixInProperties();this.id||(this.id=l.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=v.body(this.ownerDocument);l.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&(d.parentNode&&this.domNode!==d)&&(d.parentNode.replaceChild(this.domNode,d),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);h.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var b=this.baseClass.split(" ");this.isLeftToRight()||(b=b.concat(h.map(b,function(a){return a+"Rtl"})));a.add(this.domNode,b)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,h.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&A.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();h.forEach(this._connects,A.hitch(this,"disconnect"));h.forEach(this._supportingWidgets,b);this.domNode&&h.forEach(l.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
l.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?d.remove(this.domNode,"widgetId"):c.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||c.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){h.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;A.isObject(a)?
m.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(b,c,f){f=3<=arguments.length?f:this.attributeMap[b];h.forEach(A.isArray(f)?f:[f],function(f){var k=this[f.node||f||"domNode"];switch(f.type||"attribute"){case "attribute":A.isFunction(c)&&(c=A.hitch(this,c));f=f.attribute?f.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;k.tagName?d.set(k,f,c):k.set(f,c);break;case "innerText":k.innerHTML="";k.appendChild(this.ownerDocument.createTextNode(c));
break;case "innerHTML":k.innerHTML=c;break;case "class":a.replace(k,c,this[b])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(A.isFunction(d))var f=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!A.isFunction(this.focusNode)?"focusNode":"domNode",k=this[d]&&this[d].tagName,e;if(e=k)if(!(e=
U[k])){e=this[d];var s={},l;for(l in e)s[l.toLowerCase()]=!0;e=U[k]=s}l=e;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:l&&c.l in l&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return f||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(a,c,d){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var f,k=this["on"+a];k&&(f=k.apply(this,d?d:[c]));this._started&&!this._beingDestroyed&&
b.emit(this.domNode,a.toLowerCase(),c);return f},on:function(a,c){var d=this._onMap(a);return d?g.after(this,d,c,!0):this.own(b(this.domNode,a,c))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?l.findWidgets(this.containerNode):
[]},getParent:function(){return l.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(q.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(u.subscribe(a,A.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():f.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=m.get(this.domNode,"display")},placeAt:function(a,b){var d=
!a.tagName&&l.byId(a);d&&d.addChild&&(!b||"number"===typeof b)?d.addChild(this,b):(d=d&&"domNode"in d?d.containerNode&&!/after|before|replace/.test(b||"")?d.containerNode:d.domNode:w.byId(a,this.ownerDocument),c.place(this.domNode,d,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(A.hitch(this,function(){c&&(c=null,this._destroyed||A.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});x("dojo-bidi")&&
t.extend(p);return t})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A,b,k,z,u,v,y,p,l,s,U,N,C,P,M,R,S,ba,Z,E,F,D,Q,K,G,H,W,I,X,L,T,ca,ea,Aa,$,da){var fa=u.defaults,J=g(Q,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],
"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=da;b=b||{};this.showLabels=null!=b.showLabels?b.showLabels:!0;
this._outFields=b.outFields;this._defnExpr=b.definitionExpression;this._loadCallback=b.loadCallback;var c=b._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=b.quantize?b.quantize:!0;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=b.editSummaryCallback;this.userId=b.userId;this.userIsAdmin=
b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=
null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=J,c=this.mode=k.isDefined(b.mode)?b.mode:d.MODE_ONDEMAND;this._isStream&&(this.mode=c=d.MODE_STREAM);switch(c){case d.MODE_SNAPSHOT:this.currentMode=
d.MODE_SNAPSHOT;this._mode=new L(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=d.MODE_ONDEMAND;this._tileWidth=b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new T(this);this.latticeTiling=b.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION;this._mode=new ca(this);this._isSelOnly=!0;break;case d.MODE_STREAM:this.currentMode=d.MODE_STREAM,this._mode=new ea(this),this._isStream=!0}this._initLayer=q.hitch(this,this._initLayer);
this._selectHandler=q.hitch(this,this._selectHandler);this._editable=!1;if(q.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=this._isStream?d.MODE_STREAM:d.MODE_SNAPSHOT,this._initLayer(a),this;this._task=new M(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(d=b.resourceInfo)?this._initLayer(d):(this.source&&
(d={source:this.source.toJson()},this._url.query=q.mixin(this._url.query,{layer:w.toJson(d)})),this.gdbVersion&&(this._url.query=q.mixin(this._url.query,{gdbVersion:this.gdbVersion})),z({url:c,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();
this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);this._collection&&(this._isStream||(this.currentMode=J.MODE_SNAPSHOT,this._mode=new L(this)),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===
this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var d=this.capabilities=a.capabilities;d&&-1!==d.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);k.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=w.toJson(this._json);if(this.isEditable())this._setMaxOffset(null);
else if(this.mode!==J.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))this._autoGeneralize=k.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===J.MODE_ONDEMAND||this.mode===J.MODE_AUTO,delete this._optAutoGen;var d=a.effectiveMinScale||a.minScale,f=a.effectiveMaxScale||a.maxScale;!this._hasMin&&d&&this.setMinScale(d);!this._hasMax&&f&&this.setMaxScale(f);this.layerId=a.id;this.name=a.name;this.description=a.description;
this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new Z(a.extent);this.initialExtent=new Z(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new y(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=a.hasM||!1;
this.hasZ=a.hasZ||!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=a.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=
a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;
this.allowGeometryUpdates=k.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this.advancedQueryCapabilities=a.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this.useStandardizedQueries=a.useStandardizedQueries;this.tileMaxRecordCount=a.tileMaxRecordCount;this.standardMaxRecordCount=a.standardMaxRecordCount;this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;
for(var m=this.fields=[],f=a.fields,d=0;d<f.length;d++)m.push(new K(f[d]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){f=a.fields;for(d=0;d<f.length;d++)if(m=f[d],"esriFieldTypeOID"===m.type){this.objectIdField=m.name;break}}!this.objectIdField&&!this._isStream&&console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!k.isDefined(this._nextId)){f=this.objectIdField;m=-1;if(this._collection&&f)for(var g=
(d=this._featureSet)&&d.features,n=g?g.length:0,h,d=0;d<n;d++)h=(h=g[d].attributes)&&h[f],h>m&&(m=h);this._nextId=m+1}this.globalIdField=a.globalIdField;if(d=this.typeIdField=a.typeIdField)if(d=!this._getField(d)&&this._getField(d,!0))this.typeIdField=d.name;this.visibilityField=a.visibilityField;if(f=a.defaultSymbol)this.defaultSymbol=U.fromJson(f);var z=this.types=[],u=a.types,x,v,m=(d=this.editFieldsInfo)&&d.creatorField,g=d&&d.editorField;h=m||g;n=[];if(u)for(d=0;d<u.length;d++)x=new H(u[d]),
v=x.templates,h&&(v&&v.length)&&(n=n.concat(v)),z.push(x);u=a.templates;x=this.templates=[];if(u)for(d=0;d<u.length;d++)z=new W(u[d]),h&&n.push(z),x.push(z);for(d=0;d<n.length;d++)if(h=q.getObject("prototype.attributes",!1,n[d]))m&&delete h[m],g&&delete h[g];if(d=a.timeInfo)this.timeInfo=new G(d),this._startTimeField=d.startTimeField,this._endTimeField=d.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?d.trackIdField=this._trackIdField:this._trackIdField=
d.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var d=a.drawingInfo,t;if((m=d&&d.labelingInfo)&&!this.labelingInfo)this.labelingInfo=e.map(m,function(a){return new X(a)}),this._fixLabelExpr();if(!this.renderer)if(d&&d.renderer){if(t=d.renderer,this.setRenderer(P.fromJson(t)),"classBreaks"===t.type&&this.renderer.setMaxInclusive(!0),!this._collection){var r=t.type,f=[];t=this.renderer;switch(r){case "simple":f.push(t.symbol);break;case "uniqueValue":case "classBreaks":f.push(t.defaultSymbol),
f=f.concat(e.map(t.infos,function(a){return a.symbol}))}var f=e.filter(f,k.isDefined),A=this._url.path+"/images/",M=this._getToken();e.forEach(f,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=A+b),M&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+M))})}}else if(f)u=this.types,0<u.length?(t=new C(this.defaultSymbol,this.typeIdField),e.forEach(u,function(a){t.addValue(a.id,a.symbol)})):t=new N(this.defaultSymbol),this.setRenderer(t);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":r=
new p;break;case "esriGeometryPolyline":r=new l;break;case "esriGeometryPolygon":r=new s;break;default:this.hasXYFootprint()&&(r=new s)}this.setRenderer(r?new N(r):null)}r=d&&d.transparency||0;!this.hasOwnProperty("opacity")&&0<r&&(this.opacity=1-r/100);if((c("ie")||7<=c("trident")||c("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;this.statistics=a.statistics;this._fixRendererFields();this._checkFields();this._updateCaps();var R=function(){this.currentMode!==J.MODE_SNAPSHOT&&(this.queryPagination=
!1);null!=this._maxOffset&&!this._isFractionalOffsetAllowed()&&this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(r=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new S(r)),this._fcAdded=!0,R.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;R.call(a)})}:
R)}},setShowLabels:function(a){this.showLabels=a;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(a){this.inherited(arguments);var b=this._map;this._ager=!(!a||!a.observationAger||!a.observationRenderer);a&&"colors"in a&&"blurRadius"in a&&"maxPixelIntensity"in a?"esriGeometryPoint"==this.geometryType&&(!this._heatmapManager&&b)&&(this._heatmapManager=new $(this),this._heatmapManager.initialize(b)):this.renderer&&this.renderer.getRendererInfo?e.some(this.renderer.rendererInfos,
function(a){return a.renderer&&"colors"in a.renderer&&"blurRadius"in a.renderer})||(this._heatmapManager=null):this._heatmapManager=null;if(a){var c=[],b=e.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],k.isDefined),d=function(a){return null!=a&&"function"!=typeof a&&a};e.forEach(b,function(a){var b=d(a.attributeField),aa=d(a.attributeField2);a=d(a.attributeField3);!1!==b&&c.push(b);!1!==aa&&c.push(aa);!1!==a&&c.push(a)});this._rendererFields=c}else this._rendererFields=
[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},
_setMap:function(a){var b=this.inherited(arguments),c=this._mode,d=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=d._selectedFeatures[a&&a[d.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);t.disconnect(this._zoomConnect);
t.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var a=this._mode;a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return e.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},getField:function(a){return this._getField(a,!0)},getDomain:function(a,
b){var c,d,f=b&&b.feature,k=f&&this.typeIdField&&f.attributes&&f.attributes[this.typeIdField];null!=k&&e.some(this.types,function(b){if(b.id==k){if((c=b.domains&&b.domains[a])&&"inherited"===c.type)c=this._getLayerDomain(a),d=!0;return!0}return!1},this);!d&&!c&&(c=this._getLayerDomain(a));return c},_getLayerDomain:function(a){var b;e.some(this.fields,function(c){c.name===a&&(b=c.domain);return!!b});return b},getType:function(a){var b,c=a&&this.typeIdField&&a.attributes&&a.attributes[this.typeIdField];
e.some(this.types,function(a){a.id==c&&(b=a);return!!b});return b},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;
var c=a&&a.feature;a=a&&a.userId;var d=e.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],q.trim),f=-1<e.indexOf(d,"editing"),k=f&&-1<e.indexOf(d,"create"),b=f&&-1<e.indexOf(d,"update"),d=f&&-1<e.indexOf(d,"delete"),l=this.ownershipBasedAccessControlForFeatures,s=this.editFieldsInfo,p=s&&s.creatorField,s=s&&s.realm,c=(c=c&&c.attributes)&&p?c[p]:void 0,m=!!this.userIsAdmin,p=!l||m||!(!l.allowOthersToUpdate&&!l.allowUpdateToOthers),l=!l||m||!(!l.allowOthersToDelete&&!l.allowDeleteToOthers);
if(m||f&&!k&&!b&&!d)k=b=d=!0;f={canCreate:k,canUpdate:b,canDelete:d};null===c?(f.canUpdate=b&&p,f.canDelete=d&&l):""!==c&&c&&((a=a||this.getUserId())&&s&&(a=a+"@"+s),a.toLowerCase()!==c.toLowerCase()&&(f.canUpdate=b&&p,f.canDelete=d&&l));return f},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,c){c=
k.isDefined(c)?c:(new Date).getTime();var d="";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(q.isString(c))d=c;else{if(c){a=c.action;b=c.userId;var f=c.timeValue,e=0;a&&e++;b&&e++;k.isDefined(f)&&e++;1<e&&(d=("edit"===a?"edit":"create")+(b?"User":"")+(k.isDefined(f)?c.displayPattern:""))}d=d&&k.substitute(c,this.i18n.layers.FeatureLayer[d])}return d},getEditInfo:function(a,b,c){if(this.loaded){c=k.isDefined(c)?c:(new Date).getTime();b=b&&b.action||"last";
var d=this.editFieldsInfo,f=d&&d.creatorField,e=d&&d.creationDateField,l=d&&d.editorField,d=d&&d.editDateField,l=(a=a&&a.attributes)&&l?a[l]:void 0,d=a&&d?a[d]:null,f=this._getEditData(a&&f?a[f]:void 0,a&&e?a[e]:null,c);c=this._getEditData(l,d,c);var s;switch(b){case "creation":s=f;break;case "edit":s=c;break;case "last":s=c||f}s&&(s.action=s===c?"edit":"creation");return s}},_getEditData:function(b,c,d){var f,e,l;k.isDefined(c)&&(e=d-c,l=0>e?"Full":6E4>e?"Seconds":12E4>e?"Minute":36E5>e?"Minutes":
72E5>e?"Hour":864E5>e?"Hours":6048E5>e?"WeekDay":"Full");if(void 0!==b||l)f=f||{},f.userId=b,l&&(b=a.format,d=new Date(c),f.minutes=Math.floor(e/6E4),f.hours=Math.floor(e/36E5),f.weekDay=b(d,{datePattern:"EEEE",selector:"date"}),f.formattedDate=b(d,{selector:"date"}),f.formattedTime=b(d,{selector:"time"}),f.displayPattern=l,f.timeValue=c);return f},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(a){this.isEditable()||this._setMaxOffset(a,!0);return this},
getMaxAllowableOffset:function(){var a=this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:a},_setMaxOffset:function(a,b){if(null==a)return delete this._maxOffset,delete this._quantizationParameters,this;if(this.quantize&&this.supportsCoordinatesQuantization)"esriGeometryPolyline"===this.geometryType?this._maxOffset=a:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:a,extent:this.fullExtent};
else{if(!this._isFractionalOffsetAllowed()||!b)a=Math.floor(a);isNaN(a)||0===a?delete this._maxOffset:this._maxOffset=a;delete this._quantizationParameters}return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(a){a=(a=a&&a.split("-"))&&a[0]&&a[0].toLowerCase();return-1!==e.indexOf(this._langsWithDot,a)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(a){if(this.loaded){if(!this.isEditable()&&
this.mode!==J.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))(this._autoGeneralize=a)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)}else this._optAutoGen=a;return this},setGDBVersion:function(a){if(!this._collection&&a!==this.gdbVersion&&(a||this.gdbVersion))this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=q.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),
this._map&&this.refresh()),this.onGDBVersionChange();return this},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+
this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,c,f){b=b||J.SELECTION_NEW;a=this._getShallowClone(a);var k=this._map,e,l=this,s=v._fixDfd(new d(v._dfdCanceller));a.outFields=this.getOutFields();
a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;k&&(a.outSpatialReference=new y(k.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return e={features:[]},this._selectHandler(e,b,c,f,s),s;if(k=this._canDoClientSideQuery(a))s._pendingDfd=n(this._doQuery(a,k)),s._pendingDfd.then(function(a){e={features:a};l._selectHandler(e,b,c,f,s)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,f,s,!0),s;var p=this;this._ts&&
(a._ts=(new Date).getTime());(s._pendingDfd=this._task.execute(a)).addCallbacks(function(a){p._selectHandler(a,b,c,f,s)},function(a){p._resolve([a],null,f,s,!0)})}return s},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=this._selectedFeatures,c=this._mode,d;for(d in b)b.hasOwnProperty(d)&&(this._unSelectFeatureIIf(d,c),c._removeFeatureIIf(d));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);
if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,c=this,d=function(a,b){var d=
c._getField(b,!0);return"["+(d&&d.name||b)+"]"};e.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=b.replace(a,d)})},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,b,c,d,f,k){var s=k.assembly,l=k.dfd;this._applyNormalized(a,s&&s[0]);this._applyNormalized(b,s&&s[1]);this.onBeforeApplyEdits(a,b,c);var p={},m=this.objectIdField,s={f:"json"},g=!1;if(this._collection)k={},k.addResults=a?e.map(a,function(){g=!0;return{objectId:this._nextId++,
success:!0}},this):null,k.updateResults=b?e.map(b,function(a){g=!0;var b=a.attributes[m];p[b]=a;return{objectId:b,success:!0}},this):null,k.deleteResults=c?e.map(c,function(a){g=!0;return{objectId:a.attributes[m],success:!0}},this):null,g?this._editHandler(k,a,p,d,f,l):this._resolve([k.addResults,k.updateResults,k.deleteResults],null,d,l);else{a&&0<a.length&&(s.adds=this._convertFeaturesToJson(a,0,1),g=!0);if(b&&0<b.length){for(k=0;k<b.length;k++){var n=b[k];p[n.attributes[m]]=n}s.updates=this._convertFeaturesToJson(b,
0,0,1);g=!0}if(c&&0<c.length){b=[];for(k=0;k<c.length;k++)b.push(c[k].attributes[m]);s.deletes=b.join(",");g=!0}if(g){var h=this;return z({url:this._url.path+"/applyEdits",content:q.mixin(s,this._url.query),callbackParamName:"callback",load:function(b){h._editHandler(b,a,p,d,f,l)},error:function(a){h._resolve([a],null,f,l,!0)}},{usePost:!0})}this._resolve([],null,d,l)}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery",
"onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,b,c){return this._query("executeForCount","onQueryCountComplete",a,b,c)},queryExtent:function(a,b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(a,b,c){var k=this._url.path+"/"+a+"/attachments",s=new d(v._dfdCanceller),l=this;s._pendingDfd=z({url:k,content:q.mixin({f:"json"},this._url.query),
callbackParamName:"callback",load:function(c){c=c.attachmentInfos;var d;e.forEach(c,function(b){d=f.objectToQuery({gdbVersion:l._url.query&&l._url.query.gdbVersion,layer:l._url.query&&l._url.query.layer,token:l._getToken()});b.url=k+"/"+b.id+(d?"?"+d:"");b.objectId=a});l._resolve([c],"onQueryAttachmentInfosComplete",b,s)},error:function(a){l._resolve([a],null,c,s,!0)}});return s},addAttachment:function(a,b,c,d){return this._sendAttachment("add",a,b,c,d)},updateAttachment:function(a,b,c,d,f){c.appendChild(m.create("input",
{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,c,d,f)},deleteAttachments:function(a,b,c,f){var k=this._url.path+"/"+a+"/deleteAttachments",s=new d(v._dfdCanceller),l=this;b={f:"json",attachmentIds:b.join(",")};s._pendingDfd=z({url:k,content:q.mixin(b,this._url.query),callbackParamName:"callback",load:q.hitch(this,function(b){b=b.deleteAttachmentResults;b=e.map(b,function(b){b=new I(b);b.attachmentId=b.objectId;b.objectId=a;return b});l._resolve([b],"onDeleteAttachmentsComplete",
c,s)}),error:function(a){l._resolve([a],null,f,s,!0)}},{usePost:!0});return s},addType:function(a){var b=this.types;if(b){if(e.some(b,function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;e.some(b,function(b,d){return b.id==a?(c=d,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,1)[0]}}},toJson:function(){var a=this._json;if(a=q.isString(a)?w.fromJson(a):q.clone(a)){var a=
a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=e.map(this.types||[],function(a){return a.toJson()});var d=this.renderer,f=this.labelingInfo,k=b.drawingInfo;if((d||f)&&!k)k=b.drawingInfo={};k&&(d&&-1===d.declaredClass.indexOf("TemporalRenderer"))&&(k.renderer=d.toJson());f&&(k.labelingInfo=e.map(f,function(a){return a.toJson()}))}d=null;if(!c||this._fcAdded)d={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,
!0)};a.featureSet=q.mixin({},a.featureSet||{},d);a.featureSet.transform&&(f=a.featureSet.transform,delete a.featureSet.transform,d=new S(a.featureSet),d.quantize(f),a.featureSet=d.toJson());c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},
onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},_forceIdentity:function(a){function c(a){var b=["allowOthersToUpdate","allowOthersToDelete","allowOthersToQuery"];return a&&e.some(b,function(b){return a.hasOwnProperty(b)&&
!a[b]})}var d=this,f,k=this._url&&this._url.path;f=k&&k.toLowerCase().indexOf("/rest/services");(this.userIsAdmin||c(this.ownershipBasedAccessControlForFeatures))&&!this._getToken()&&-1<f&&b.id?(f=k.substring(0,f)+"/rest/info",z({url:f,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(a){if(a.owningSystemUrl)return b.id.checkSignInStatus(a.owningSystemUrl+"/sharing")}).then(function(a){if(a)return b.id.getCredential(k)}).then(function(a){a&&d._findCredential()}).always(function(){a.call(d)})):
a.call(this)},_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;if(this.mode===J.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&c>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto))this.currentMode=J.MODE_SNAPSHOT,this._mode=new L(this),this._isSnapshot=
this._autoSnapshot=!0},_queryLimit:function(){var a=this,b=new d;this._limitPromise=b.promise;setTimeout(function(){var c=new R,d=new ba;d.statisticType="exceedslimit";d.maxPointCount=a.maxPointCountForAuto;d.maxRecordCount=a.maxRecordCountForAuto;d.maxVertexCount=a.maxVertexCountForAuto;d.outStatisticFieldName="exceedslimit";c.outStatistics=[d];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=q.trim(this.capabilities||
""),c=e.map(b?b.split(","):[],q.trim),d=e.map(b?b.toLowerCase().split(","):[],q.trim),b=e.indexOf(d,"editing"),f,d={Create:e.indexOf(d,"create"),Update:e.indexOf(d,"update"),Delete:e.indexOf(d,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(f in d)-1<d[f]&&a.push(d[f]);a.sort();for(f=a.length-1;0<=f;f--)c.splice(a[f],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);
var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);var b=this._mode,c=this._map,d=this._getRenderer();if(a.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&!this._trackManager&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer)))this._trackManager=new Aa(this),this._trackManager.initialize(c);d&&("colors"in d&&"blurRadius"in d&&"maxPixelIntensity"in d)&&("esriGeometryPoint"==
this.geometryType&&!this._heatmapManager)&&(this._heatmapManager=new $(this),this._heatmapManager.initialize(c));if(this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset())d=this.generalizeForScale,this._calculatedScale=d=this.maxScale?this.maxScale:this.minScale?Math.min(d,this.minScale):Math.min(d,D.getScale(c,this.initialExtent)),this._calcMaxOffset=
c.extent.getWidth()/c.width/c.getScale()*d;this._zoomConnect=t.connect(c,"onZoomEnd",this,this._zoomEndHandler);this._updateMaxOffset();this._needsRefresh=!1;b&&b.startup()}else this._zoomEndHandler(),b&&b.resume()},_zoomEndHandler:function(){var a=this._map;this._updateMaxOffset();this._prevScale=a.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._autoSnapshot?(a=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),
!0),this._needsRefresh||(this._needsRefresh=a!=this.getMaxAllowableOffset())):this._setMaxOffset(a.extent.getWidth()/a.width,!a.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var a=this._map.getScale(),b=this._calculatedScale,c=this._calcMaxOffset,d=this._prevScale;return a>=b&&(null==d||d<b)?c:a<b&&(null==d||d>=b)?null:this.getMaxAllowableOffset()}},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,
this._timeConnect||(this._timeConnect=t.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,t.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),
c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);a.maxAllowableOffset||(a.maxAllowableOffset=this._maxOffset);a.quantizationParameters=this._quantizationParameters;b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());
if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,d=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(d&&c&&c.hasOwnProperty(d))a[c[d]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],c=this._map,d;if(!(this._isTable||!c&&!this._collection))if(!a.text&&!(a.where&&
a.where!==this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length&&(d=this.getOrderByFields()||[])&&a.orderByFields.join()!==d.join()||a.outStatistics||a.returnDistinctValues)){d=this._isSnapshot;var f=this._isSelOnly,k=a.geometry;if(k)if(!f&&a.spatialRelationship===R.SPATIAL_REL_INTERSECTS&&"extent"===k.type&&(d||c.extent.contains(k)))b.push(1);else return;if(c=a.objectIds)if(d)b.push(2);else{var k=c.length,s=this._mode,l=0,p;for(p=0;p<k;p++)s._getFeature(c[p])&&l++;if(l===k)b.push(2);
else return}if(this.timeInfo)if(a=a.timeExtent,c=this._mapTimeExtent,d)a&&b.push(3);else if(f){if(a)return}else if(c)if(-1!==e.indexOf(b,2))a&&b.push(3);else if(-1!==e.indexOf(b,1))a==c&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return r.toAbsMid?r.toAbsMid(a):h.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,c){var f=[],k=this.objectIdField,s=this,l=new d,p=new d,m=this.graphics;if(-1!==e.indexOf(b,1)){var g=this.spatialIndex||
this._map&&this._map.spatialIndex,n,h=a.geometry._normalize(null,!0);null==g&&fa.autoSpatialIndexing?n=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(q.hitch(this,q.partial(this._getFromIndex,h,g)),function(a){p.resolve(q.hitch(this,q.partial(this._filterByExtent,m,h)))}):g&&(n=this._getFromIndex(h,g));n?n.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(f=f.concat(a[b].results));p.resolve(f)}).otherwise(function(a){p.reject(a)}):p.resolve(this._filterByExtent(m,
h))}else p.resolve(m);p.then(function(d){f=d;if(-1!==e.indexOf(b,2)){var p=a.objectIds;f=e.filter(f,function(a){return-1<e.indexOf(p,a.attributes[k])})}-1!==e.indexOf(b,3)&&s.timeInfo&&(d=a.timeExtent,f=s._filterByTime(f,d.startTime,d.endTime).match);c&&(f=e.map(f,function(a){return a.attributes[k]},this));l.resolve(f)});return l},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;return A(e.map(a,function(a){return b.intersects(a,
c)}))},_filterByExtent:function(a,b){for(var c=[],d=0,f=a.length;d<f;d++){var k=a[d],s=k.geometry;s&&(this.normalization&&b.length?(b[0].intersects(s)||b[1].intersects(s))&&c.push(k):b.intersects(s)&&c.push(k))}return c},_filterByTime:function(a,b,c){var d=this._startTimeField,f=this._endTimeField,s;this._twoTimeFields||(s=d||f);var l=k.isDefined,e=[],p=[],m,g=a.length,n,h;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(s)for(m=0;m<g;m++)n=a[m],h=n.attributes,d=h[s],d>=b&&d<=c?e.push(n):p.push(n);
else for(m=0;m<g;m++)n=a[m],h=n.attributes,s=h[d],h=h[f],s=l(s)?s:-Infinity,h=l(h)?h:Infinity,s>=b&&s<=c||h>=b&&h<=c||b>=s&&c<=h?e.push(n):p.push(n);return{match:e,noMatch:p}},_resolve:function(a,b,c,d,f){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&v._resDfd(d,a,f)},_getShallowClone:function(a){var b=new R,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_query:function(a,b,c,f,k){var s=this,l=this._map,p=new d(v._dfdCanceller),m=c,g,h;if("executeRelationshipQuery"!==a){var m=this._getShallowClone(c),
z=this.getOutFields();m.outFields||(m.outFields=z);m.outFields&&m.outFields.length&&(h=-1<e.indexOf(z,"*")?!1:!e.every(m.outFields,function(a){return-1<e.indexOf(z,a)}));m.returnGeometry=c.hasOwnProperty("returnGeometry")?c.returnGeometry:!c.outStatistics;m.returnGeometry&&(m.multipatchOption=this.multipatchOption);var u;l&&(c=l&&l.spatialReference,(l=m.outSpatialReference)?g=!l.equals(c):m.outSpatialReference=new y(c.toJson()));if(!this._applyQueryFilters(m,"execute"===a&&!m.outStatistics)){switch(a){case "execute":u=
new S({features:[]});break;case "executeForIds":u=[];break;case "executeForCount":u=0;break;case "executeForExtent":u={}}this._resolve([u],b,f,p);return p}if(c="executeForExtent"!==a&&!g&&!h&&this._canDoClientSideQuery(m))return p._pendingDfd=n(this._doQuery(m,c,"executeForIds"===a||"executeForCount"===a)),p._pendingDfd.then(function(c){switch(a){case "execute":u=new S;u.features=c;break;case "executeForIds":u=c;break;case "executeForCount":u=c.length}s._resolve([u],b,f,p)}),p}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+
this.invalidParams)],null,k,p,!0),p;this._ts&&(m._ts=(new Date).getTime());(p._pendingDfd=this._task[a](m)).addCallbacks(function(c){var d=!!m.outStatistics||g||h;if("execute"===a||"executeRelationshipQuery"===a){var k,l;if("execute"===a){k=c.features;l=k.length;for(l-=1;0<=l;l--)if(k[l]._layer=s,!d&&!s._isTable){var e=s._mode._getFeature(k[l].attributes[s.objectIdField]);e&&k.splice(l,1,e)}}else for(e in c)if(c.hasOwnProperty(e)){k=c[e].features;l=k.length;for(l-=1;0<=l;l--)k[l]._layer=s}}s._resolve([c],
b,f,p)},function(a){s._resolve([a],null,k,p,!0)});return p},_convertFeaturesToJson:function(a,b,c,d){var f=[],k=this._selectionSymbol,s=this.visibilityField,l,p=this.objectIdField;if(this.loaded&&(c||d))l=e.filter(this.fields,function(a){return!1===a.editable&&(!d||a.name!==p)});for(c=0;c<a.length;c++){var m=a[c],g={},n=m.geometry,h=m.attributes,u=m.symbol;if(n&&(!d||!this.loaded||this.allowGeometryUpdates))g.geometry=n.toJson();s?(g.attributes=h=q.mixin({},h),h[s]=m.visible?1:0):h&&(g.attributes=
q.mixin({},h));g.attributes&&(l&&l.length)&&e.forEach(l,function(a){delete g.attributes[a.name]});u&&u!==k&&(g.symbol=u.toJson());f.push(g)}return b?f:w.toJson(f)},_selectHandler:function(a,b,c,d,f){var k;d=J;switch(b){case d.SELECTION_NEW:this.clearSelection(!0);k=!0;break;case d.SELECTION_ADD:k=!0;break;case d.SELECTION_SUBTRACT:k=!1}d=a.features;var s=this._mode,l=[],e=this.objectIdField,p,m;if(k)for(k=0;k<d.length;k++)p=d[k],m=p.attributes[e],p=s._addFeatureIIf(m,p),l.push(p),this._selectFeatureIIf(m,
p,s);else for(k=0;k<d.length;k++)p=d[k],m=p.attributes[e],this._unSelectFeatureIIf(m,s),m=s._removeFeatureIIf(m),l.push(m||p);this._isSelOnly&&s._applyTimeFilter(!0);this._resolve([l,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,f);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var d=this._selectedFeatures,f=d[a];f||(c._incRefCount(a),d[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return f||
b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,
this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),a=e.filter(a,function(a,b,c){return!!a&&e.indexOf(c,a)===b}),b=q.clone(this._outFields);if(b){if(-1!==e.indexOf(b,"*"))return b;e.forEach(a,function(a){-1===e.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();e.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url,
field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!a&&(!this._isTable&&!this._fserver&&!this._collection&&!this._isStream)&&(e.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},
_fixFieldCase:function(a,b,c){var d=a&&a[b],f;if(d&&!q.isFunction(d)){if(f=!this._getField(d)&&this._getField(d,!0))d=a[b]=f.name;c&&c.push(d)}return d},_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;if(a&&0<this.fields.length){var b=[],c,a=e.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],k.isDefined),d=[].concat(a);e.forEach(a,function(a){e.forEach(a.rendererInfos,function(a){a.renderer&&d.push(a.renderer)})});e.forEach(d,function(a){this._fixFieldCase(a,
"attributeField",b);this._fixFieldCase(a,"attributeField2",b);this._fixFieldCase(a,"attributeField3",b);this._fixFieldCase(a.rotationInfo,"field",b);if((c=this._fixFieldCase(a.sizeInfo,"field",b))&&!this._orderBy)this._orderBy=[c+" DESC"];this._fixFieldCase(a.sizeInfo,"normalizationField",b);this._fixFieldCase(a.colorInfo,"field",b);this._fixFieldCase(a.colorInfo,"normalizationField",b);this._fixFieldCase(a.field,"field",b);this._fixFieldCase(a.opacityInfo,"field",b);this._fixFieldCase(a.opacityInfo,
"normalizationField",b);e.forEach(a.visualVariables,function(a){c=this._fixFieldCase(a,"field",b);"sizeInfo"===a.type&&(c&&!this._orderBy)&&(this._orderBy=[c+" DESC"]);this._fixFieldCase(a,"normalizationField",b)},this);if(!this._orderBy&&a.addBreak&&!q.isFunction(a.attributeField)&&(a.backgroundFillSymbol||this._hasSizeDiff(a)))this._orderBy=[a.attributeField+" DESC"]},this);this._rendererFields=e.filter(b,k.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d,f;e.forEach(a.infos,
function(a){if(f=a.symbol){d=0;switch(f.type){case "simplemarkersymbol":d=f.size;break;case "picturemarkersymbol":d=(f.width+f.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":d=f.width;break;case "simplefillsymbol":case "picturefillsymbol":d=f.outline&&f.outline.width}d&&(b=Math.min(b,d),c=Math.max(c,d))}});return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&
a?e.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=this.fields;if(!c||0===c.length)return null;var d;b&&(a=a.toLowerCase());e.some(c,function(c){var f=!1;(f=b?c&&c.name.toLowerCase()===a?!0:!1:c&&c.name===a?!0:!1)&&(d=c);return f});return d},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:e.map(e.filter(this.fields,function(a){return!!(a&&"esriFieldTypeDate"===a.type)}),function(a){return a.name})});return this._dtOpts},
_applyNormalized:function(a,b){a&&b&&e.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,b,c,d,f,k){f=a.addResults;var s=a.updateResults;a=a.deleteResults;var l,p,m,g,n=this.objectIdField,h=this._mode,u=this._isTable;l=this.editFieldsInfo;var z=this.getOutFields()||[],x=l&&l.creatorField,v=l&&l.creationDateField,y=l&&l.editorField,t=l&&l.editDateField;l=l&&l.realm;-1===e.indexOf(z,"*")&&(x&&-1===e.indexOf(z,x)&&(x=null),v&&-1===e.indexOf(z,v)&&(v=null),y&&-1===e.indexOf(z,
y)&&(y=null),t&&-1===e.indexOf(z,t)&&(t=null));var z=v||t?(new Date).getTime():null,r=x||y?this.getUserId():void 0;r&&l&&(r=r+"@"+l);if(f)for(l=0;l<f.length;l++)f[l]=new I(f[l]),u||(p=f[l],p.success&&(p=p.objectId,m=b[l],(g=m._graphicsLayer)&&g!==this&&g.remove(m),g=m.attributes||{},g[n]=p,x&&(g[x]=r),y&&(g[y]=r),v&&(g[v]=z),t&&(g[t]=z),m.setAttributes(g),h._init&&h.drawFeature(m)));if(s)for(l=0;l<s.length;l++)if(s[l]=new I(s[l]),!u&&(p=s[l],p.success)){p=p.objectId;m=c[p];if(b=h._getFeature(p))b.geometry!==
m.geometry&&m.geometry&&b.setGeometry(E.fromJson(m.geometry.toJson())),b.attributes!==m.attributes&&m.attributes&&b.setAttributes(q.mixin(b.attributes,m.attributes)),this._repaint(b,p);m=b||m;g=m.attributes||{};y&&(g[y]=r);t&&(g[t]=z);m.setAttributes(g)}if(a){c=[];for(l=0;l<a.length;l++)if(a[l]=new I(a[l]),!u&&(p=a[l],p.success&&(p=p.objectId,m=h._getFeature(p))))this._unSelectFeatureIIf(p,h)&&c.push(m),m._count=0,h._removeFeatureIIf(p);if(0<c.length)this.onSelectionComplete(c,J.SELECTION_SUBTRACT)}this._resolve([f,
s,a],"onEditsComplete",d,k)},_sendAttachment:function(a,b,c,d,f){var k=this;return z({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),form:c,content:q.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var f="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";c=new I(c["add"===a?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=b;k._resolve([c],
f,d);return c}).addErrback(function(a){k._resolve([a],null,f,null,!0)})},_repaint:function(a,b,c){b=k.isDefined(b)?b:a.attributes[this.objectIdField];(!(b in this._selectedFeatures)||!this._selectionSymbol)&&a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;return b?b.isLatestObservation(a)?1:0:0}});q.mixin(J,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",
POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});F._createWrappers(J);c("extend-esri")&&q.setObject("layers.FeatureLayer",J,b);return J})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(r,h,g,t,q,e,w,d,a,c){function f(a,b,c){return A&&c?function(a,b){return e(a,c,b)}:k?function(c,d){var f=e(c,b,function(a){d.call(this,a);C=(new Date).getTime()}),k=
e(c,a,function(a){(!C||(new Date).getTime()>C+1E3)&&d.call(this,a)});return{remove:function(){f.remove();k.remove()}}}:function(b,c){return e(b,a,c)}}function m(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function x(a,b,d){var f=m(a.target);if(u=!a.target.disabled&&f&&f.dojoClick)if(y=(v="useTarget"==u)?f:a.target,v&&a.preventDefault(),p=a.changedTouches?a.changedTouches[0].pageX-c.global.pageXOffset:a.clientX,l=a.changedTouches?a.changedTouches[0].pageY-c.global.pageYOffset:a.clientY,
s=("object"==typeof u?u.x:"number"==typeof u?u:0)||4,U=("object"==typeof u?u.y:"number"==typeof u?u:0)||4,!z){z=!0;var k=function(a){u=v?g.isDescendant(c.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-c.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-c.global.pageYOffset:a.clientY),y):u&&(a.changedTouches?a.changedTouches[0].target:a.target)==y&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-c.global.pageXOffset:a.clientX)-p)<=s&&Math.abs((a.changedTouches?
a.changedTouches[0].pageY-c.global.pageYOffset:a.clientY)-l)<=U};c.doc.addEventListener(b,function(a){k(a);v&&a.preventDefault()},!0);c.doc.addEventListener(d,function(a){k(a);if(u){N=(new Date).getTime();var b=v?y:a.target;"LABEL"===b.tagName&&(b=g.byId(b.getAttribute("for"))||b);var c=a.changedTouches?a.changedTouches[0]:a,d=document.createEvent("MouseEvents");d._dojo_click=!0;d.initMouseEvent("click",!0,!0,a.view,a.detail,c.screenX,c.screenY,c.clientX,c.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,
0,null);setTimeout(function(){e.emit(b,"click",d);N=(new Date).getTime()},0)}},!0);a=function(a){c.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=N+1E3&&!("INPUT"==b.target.tagName&&t.contains(b.target,"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&
b.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var n=5>w("ios"),A=w("pointer-events")||w("MSPointer"),b=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=w("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),k=w("touch-events"),z,u,v=!1,y,p,l,s,U,N,C,P;A?a(function(){c.doc.addEventListener(b.down,function(a){x(a,b.move,b.up)},!0)}):k&&a(function(){function a(b){var c=q.delegate(b,{bubbles:!0});6<=w("ios")&&(c.touches=
b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}P=c.body();c.doc.addEventListener("touchstart",function(a){C=(new Date).getTime();var b=P;P=a.target;e.emit(b,"dojotouchout",{relatedTarget:P,bubbles:!0});e.emit(P,"dojotouchover",{relatedTarget:b,bubbles:!0});x(a,"touchmove","touchend")},!0);e(c.doc,"touchmove",function(b){C=(new Date).getTime();var d=c.doc.elementFromPoint(b.pageX-
(n?0:c.global.pageXOffset),b.pageY-(n?0:c.global.pageYOffset));d&&(P!==d&&(e.emit(P,"dojotouchout",{relatedTarget:d,bubbles:!0}),e.emit(d,"dojotouchover",{relatedTarget:P,bubbles:!0}),P=d),e.emit(d,"dojotouchmove",a(b))||b.preventDefault())});e(c.doc,"touchend",function(b){C=(new Date).getTime();var d=c.doc.elementFromPoint(b.pageX-(n?0:c.global.pageXOffset),b.pageY-(n?0:c.global.pageYOffset))||c.body();e.emit(d,"dojotouchend",a(b))})});h={press:f("mousedown","touchstart",b.down),move:f("mousemove",
"dojotouchmove",b.move),release:f("mouseup","dojotouchend",b.up),cancel:f(d.leave,"touchcancel",A?b.cancel:null),over:f("mouseover","dojotouchover",b.over),out:f("mouseout","dojotouchout",b.out),enter:d._eventHandler(f("mouseover","dojotouchover",b.over)),leave:d._eventHandler(f("mouseout","dojotouchout",b.out))};return r.touch=h})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(r,h,g,t,q){return g("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var e=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);q.parse(e,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(t.hitch(this,function(e){this._startupWidgets=e;for(var d=0;d<e.length;d++)this._processTemplateNode(e[d],
function(a,c){return a[c]},function(a,c,d){return c in a?a.connect(a,c,d):a.on(c,d,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(e,g,d){return g(e,"dojoType")||g(e,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){r.forEach(this._startupWidgets,function(e){e&&(!e._started&&e.startup)&&e.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),function(r,h,g,t,q,e,w){h=h(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(r._scopeName||"dojo")+"IoScript"},
initialize:function(d){this.map=d;this._init=!0},startup:function(){},propertyChangeHandler:function(d){},destroy:function(){this._init=!1},drawFeature:function(d){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(d){(d=this._featureMap[d])&&d._count++},_decRefCount:function(d){(d=this._featureMap[d])&&d._count--},_getFeature:function(d){return this._featureMap[d]},_addFeatureIIf:function(d,a){var c=this._featureMap,f=c[d],m=this.featureLayer;f||(c[d]=a,m._add(a),
a._count=0);return f||a},_removeFeatureIIf:function(d){var a=this._featureMap[d],c=this.featureLayer;if(a){if(a._count)return;delete this._featureMap[d];c._remove(a)}return a},_clearIIf:function(){var d;d=this.featureLayer;var a=d.graphics,c=d._selectedFeatures,f=d.objectIdField;for(d=a.length-1;0<=d;d--){var m=a[d],e=m.attributes[f];e in c?m._count=1:(m._count=0,this._removeFeatureIIf(e))}},_isPending:function(d){return e[this._prefix+d]?!0:!1},_cancelPendingRequest:function(d,a){if(d=d||e[this._prefix+
a])try{d.cancel(),e._validCheck(d)}catch(c){}},_purgeRequests:function(){e._validCheck(null)},_toggleVisibility:function(d){var a=this.featureLayer,c=a.graphics,f=d?"show":"hide",e,g=c.length;d=d&&a._ager;for(e=0;e<g;e++){var h=c[e];h[f]();d&&a._repaint(h)}},_applyTimeFilter:function(d){var a=this.featureLayer;if(a.timeInfo&&!a.suspended){d||a._fireUpdateStart();var c=a._trackManager;c&&c.clearTracks();var f=a.getTimeDefinition(),e=a._getOffsettedTE(a._mapTimeExtent);e?(e=a._getTimeOverlap(f,e))?
(f=a._filterByTime(a.graphics,e.startTime,e.endTime),c&&c.addFeatures(f.match),t.forEach(f.match,function(c){var d=c._shape;c.visible||(c.show(),(d=c._shape)&&d._moveToFront());a._ager&&d&&a._repaint(c)}),t.forEach(f.noMatch,function(a){a.visible&&a.hide()})):this._toggleVisibility(!1):(c&&c.addFeatures(a.graphics),this._toggleVisibility(!0));c&&(c.moveLatestToFront(),c.drawTracks());d||a._fireUpdateEnd()}}});q("extend-esri")&&g.setObject("layers._RenderMode",h,w);return h})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f){r=r(null,{declaredClass:"esri.layers.FeatureType",constructor:function(e){if(e&&h.isObject(e)){this.id=e.id;this.name=e.name;var g=e.symbol;g&&(this.symbol=w.fromJson(g));var g=e.domains,n,q=this.domains={};for(n in g)if(g.hasOwnProperty(n)){var b=g[n];switch(b.type){case "range":q[n]=new d(b);break;case "codedValue":q[n]=new a(b);break;case "inherited":q[n]=new c(b)}}if(n=e.templates){g=this.templates=[];for(e=0;e<n.length;e++)g.push(new f(n[e]))}}},toJson:function(){var a=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,d=this.domains,f=this.templates,b=e.fixJson;if(d){var k=a.domains={};for(c in d)d.hasOwnProperty(c)&&(k[c]=d[c]&&d[c].toJson());b(k)}f&&(a.templates=g.map(f,function(a){return a.toJson()}));return b(a)}});t("extend-esri")&&h.setObject("layers.FeatureType",r,q);return r})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),
function(r,h,g,t,q,e,w,d){r=r(null,{declaredClass:"esri.layers._TrackManager",constructor:function(a){this.layer=a;this.trackMap={};this.trackLineMap={}},initialize:function(a){this.map=a;var c=this.layer,f=c._getRenderer(),f=f&&f.trackRenderer;if("esriGeometryPoint"===c.geometryType){var e=this.container=new d._GraphicsLayer({id:c.id+"_tracks",_child:!0,visible:c.visible,minScale:c.minScale,maxScale:c.maxScale});e.loaded=!0;e.onLoad(e);e._setMap(a,c._div);e.setRenderer(f);c.on("visibility-change",
h.hitch(this,function(a){this.container.setVisibility(a.visible);this.container.evaluateSuspension()}));c.on("scale-range-change",h.hitch(this,function(){this.container.setScaleRange(this.layer.minScale,this.layer.maxScale)}))}},addFeatures:function(a){var c=this.trackMap,d=this.layer,e=d._trackIdField,h=[];g.forEach(a,function(a){var b=a.attributes[e];(c[b]=c[b]||[]).push(a);-1===g.indexOf(h,b)&&h.push(b)});var n=d._startTimeField,q=d.objectIdField,b=function(a,b){var c=a.attributes[n],d=b.attributes[n];
return c===d?a.attributes[q]<b.attributes[q]?-1:1:c<d?-1:1};g.forEach(h,function(a){c[a].sort(b)})},trimTracks:function(a){function c(a){for(a=d[a]||[];a.length>e;)h.push(a.shift())}var d=this.trackMap,e=this.layer.maximumTrackPoints||0,h=[],n;if(!e)return h;if(a)g.forEach(a,function(a){c(a)});else for(n in d)d.hasOwnProperty(n)&&c(n);return h},drawTracks:function(a){function c(a){var b=h[a],c,g,y;g=d.trackLineMap[a];m.remove(g);delete d.trackLineMap[a];if(!b||2>b.length)return!1;g=[];for(c=b.length-
1;0<=c;c--)(y=b[c].geometry)&&g.push([y.x,y.y]);b={};b[q]=a;1<g.length&&(g=new e(new w({paths:[g],spatialReference:n}),null,b),m.add(g),d.trackLineMap[a]=g)}var d=this,m=this.container,h,n,q,b;if(m)if(h=this.trackMap,n=this.map.spatialReference,q=this.layer._trackIdField,a)g.forEach(a,function(a){c(a)});else for(b in h)h.hasOwnProperty(b)&&c(b)},refreshTracks:function(a){function c(a){var c,g;d.drawTracks([a]);if(n&&n.latestObservationRenderer){a=e[a]||[];c=a.length;for(g=0;g<c;g++)h._repaint(a[g],
null,!0)}}var d=this,e=this.trackMap,h=this.layer,n=h._getRenderer(),q;if(a)g.forEach(a,function(a){c(a)});else for(q in e)e.hasOwnProperty(q)&&c(q);this.moveLatestToFront()},moveLatestToFront:function(a){g.forEach(this.getLatestObservations(a),function(a){var d=a._shape;d&&d._moveToFront();this._repaint(a,null,!0)},this.layer)},getLatestObservations:function(a){function c(a){a=h[a];return a[a.length-1]}var d=[],e=this.layer._getRenderer(),h=this.trackMap,n;if(!e.latestObservationRenderer)return d;
if(a)g.forEach(a,function(a){d.push(c(a))});else for(n in h)h.hasOwnProperty(n)&&d.push(c(n));return d},clearTracks:function(a){var c=this.getLatestObservations(a),d=this.container,e;a?g.forEach(a,function(a){delete this.trackMap[a];d&&(e=this.trackLineMap[a],d.remove(e),delete this.trackLineMap[a])},this):(this.trackMap={},this.trackLineMap={},d&&d.clear());g.forEach(c,function(a){this._repaint(a,null,!0)},this.layer)},isLatestObservation:function(a){var c=this.trackMap[a.attributes[this.layer._trackIdField]];
return c?c[c.length-1]===a:!1},destroy:function(){var a=this.container;a&&(a.clear(),a._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});t("extend-esri")&&h.setObject("layers._TrackManager",r,q);return r})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),function(r,h,g,t,q,e,w,d){r=r(null,{declaredClass:"esri.layers._GridLayout",
constructor:function(a,c,d,e){this.origin=a;this.cellWidth=c.width;this.cellHeight=c.height;this.mapWidth=d.width;this.mapHeight=d.height;this.srInfo=e},setResolution:function(a){this._resolution=(a.xmax-a.xmin)/this.mapWidth;this.srInfo&&(a=Math.round(2*this.srInfo.valid[1]/this._resolution),a=Math.round(a/this.cellWidth),this._frameStats=[a,0,a-1])},getCellCoordinates:function(a){var c=this._resolution,d=this.origin;return{row:Math.floor((d.y-a.y)/(this.cellHeight*c)),col:Math.floor((a.x-d.x)/(this.cellWidth*
c))}},normalize:function(a){var c=this._frameStats;if(c){var d=c[0],e=c[1],c=c[2];a<e?(a%=d,a=a<e?a+d:a):a>c&&(a%=d)}return a},intersects:function(a,c){var d=this.srInfo;return d?g.some(c._getParts(d),function(c){return a.intersects(c.extent)}):a.intersects(c)},getCellExtent:function(a,c){var d=this._resolution,g=this.origin,h=this.cellWidth,n=this.cellHeight;return new w(c*h*d+g.x,g.y-(a+1)*n*d,(c+1)*h*d+g.x,g.y-a*n*d,new e(g.spatialReference.toJson()))},getLatticeID:function(a){var c=this.getCellCoordinates({x:a.xmin,
y:a.ymax}),d=this.getCellCoordinates({x:a.xmax,y:a.ymin});a=c.row;var e=d.row,c=this.normalize(c.col),d=this.normalize(d.col);return a+"_"+e+"_"+c+"_"+d},sorter:function(a,c){return a<c?-1:1},getCellsInExtent:function(a,c){var f=this.getCellCoordinates({x:a.xmin,y:a.ymax}),e=this.getCellCoordinates({x:a.xmax,y:a.ymin}),g=f.row,h=e.row,f=f.col,e=e.col,q=[],b,k,z,u=[],v=[],y,p,l,s=[];for(b=g;b<=h;b++)for(k=f;k<=e;k++)z=this.normalize(k),a=this.getCellExtent(b,z),q.push({row:b,col:z,extent:a,resolution:this._resolution}),
c&&(u.push(a.xmin,a.xmax),v.push(a.ymin,a.ymax));f=this.normalize(f);e=this.normalize(e);u.sort(this.sorter);v.sort(this.sorter);k=u.length;for(b=k-1;0<=b;b--)b<k-1&&u[b]===u[b+1]&&u.splice(b,1);k=v.length;for(b=k-1;0<=b;b--)b<k-1&&v[b]===v[b+1]&&v.splice(b,1);if(u.length&&v.length){z=u[0];y=u[u.length-1];p=v[0];l=v[v.length-1];k=u.length;for(b=0;b<k;b++)s.push([[u[b],l],[u[b],p]]);k=v.length;for(b=0;b<k;b++)s.push([[z,v[b]],[y,v[b]]]);b=new d({paths:s,spatialReference:this.origin.spatialReference.toJson()});
q.push({latticeID:g+"_"+h+"_"+f+"_"+e,lattice:b,resolution:this._resolution})}return{minRow:g,maxRow:h,minCol:f,maxCol:e,cells:q}}});t("extend-esri")&&h.setObject("layers._GridLayout",r,q);return r})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(r,h){var g={};r.setObject("dojo.date.stamp",g);g.fromISOString=function(t,q){g._isoRegExp||(g._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var e=
g._isoRegExp.exec(t),r=null;if(e){e.shift();e[1]&&e[1]--;e[6]&&(e[6]*=1E3);q&&(q=new Date(q),h.forEach(h.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(a){return q["get"+a]()}),function(a,d){e[d]=e[d]||a}));r=new Date(e[0]||1970,e[1]||0,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0);100>e[0]&&r.setFullYear(e[0]||1970);var d=0,a=e[7]&&e[7].charAt(0);"Z"!=a&&(d=60*(e[8]||0)+(Number(e[9])||0),"-"!=a&&(d*=-1));a&&(d-=r.getTimezoneOffset());d&&r.setTime(r.getTime()+6E4*d)}return r};
g.toISOString=function(g,h){var e=function(a){return 10>a?"0"+a:a};h=h||{};var r=[],d=h.zulu?"getUTC":"get",a="";"time"!=h.selector&&(a=g[d+"FullYear"](),a=["0000".substr((a+"").length)+a,e(g[d+"Month"]()+1),e(g[d+"Date"]())].join("-"));r.push(a);if("date"!=h.selector){a=[e(g[d+"Hours"]()),e(g[d+"Minutes"]()),e(g[d+"Seconds"]())].join(":");d=g[d+"Milliseconds"]();h.milliseconds&&(a+="."+(100>d?"0":"")+e(d));if(h.zulu)a+="Z";else if("time"!=h.selector)var d=g.getTimezoneOffset(),c=Math.abs(d),a=a+
((0<d?"-":"+")+e(Math.floor(c/60))+":"+e(c%60));r.push(a)}return r.join("T")};return g})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(r,h,g,t,q,e,w){e.extend(r,{waiRole:"",waiState:""});return q("dijit._Templated",[h,g],{widgetsInTemplate:!1,constructor:function(){w.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(d,a){var c=this.inherited(arguments),f=a(d,"waiRole");f&&d.setAttribute("role",f);(f=a(d,"waiState"))&&t.forEach(f.split(/\s*,\s*/),function(a){-1!=a.indexOf("-")&&(a=a.split("-"),d.setAttribute("aria-"+a[0],a[1]))});return c}})})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A,b,k,z,u,v){var y=0;h=h([u,A,b],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=t.mixin({},v.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(t.hitch(this,this._handleComponentsSuccess),t.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,b=a.length,d=this.domNode,k=this._prevMedia,g=this._nextMedia;if(1<b){var h=0,m=0;q.forEach(a,function(a){"image"===a.type?h++:-1!==a.type.indexOf("chart")&&m++});h&&(c.set(this._imageCount,"innerHTML",h),e.query(".summary .image",d).removeClass("hidden"));m&&(c.set(this._chartCount,"innerHTML",m),e.query(".summary .chart",d).removeClass("hidden"))}else e.query(".summary",
d).addClass("hidden"),f.add(k,"hidden"),f.add(g,"hidden");a=this._mediaPtr;0===a?f.add(k,"hidden"):f.remove(k,"hidden");a===b-1?f.add(g,"hidden"):f.remove(g,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],b=a.title,d=a.caption,k=e.query(".mediaSection .hzLine",this.domNode)[0];c.set(this._mediaTitle,"innerHTML",b);f[b?"remove":"add"](this._mediaTitle,"hidden");c.set(this._mediaCaption,"innerHTML",d);f[d?"remove":"add"](this._mediaCaption,"hidden");f[b&&
d?"remove":"add"](k,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var g=this,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],d=a.value.theme||this.chartTheme;t.isString(d)&&(d=d.replace(/\./gi,"/"),-1===d.indexOf("/")&&(d="dojox/charting/themes/"+d));d||(d="./Rainbow");b.push(d);try{var h=this._rid=y++;r(b,function(b,c,d){h===g._rid&&(g._rid=null,g._showChart(a.type,a.value,b,c,d))})}catch(m){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&t.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){f.add(this._mediaFrame,"image");var b=x.get(this._gallery,"height"),c;a.linkURL&&(c=m.create("a",{href:a.linkURL,target:this._preventNewTab(a.linkURL)?"":"_blank"},this._mediaFrame));m.create("img",{className:"esriPopupMediaImage",src:a.sourceURL},c||this._mediaFrame);var d=e.query(".esriPopupMediaImage",this._mediaFrame)[0],k=this,h;h=g.connect(d,"onload",function(){g.disconnect(h);h=null;k._imageLoaded(d,
b)})},_showChart:function(a,b,c,d,k){f.remove(this._mediaFrame,"image");c=this._chart=new c(m.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});k&&c.setTheme(k);switch(a){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",b.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});q.forEach(b.fields,
function(a,b){a.x=b+1});c.addSeries("Series A",b.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",gap:3});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",b.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",b.fields)}this._action=new d(c);c.render()},
_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);c.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),x.set(a,"marginTop",c+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var d="";!(b instanceof Error)&&(b&&b.length)&&q.forEach(b,function(a){d+="\x3cli\x3e";d+="\x3ca href\x3d'"+z.addProxy(a.url)+"' target\x3d'_blank'\x3e"+
(a.name||"[No name]")+"\x3c/a\x3e";d+="\x3c/li\x3e"});c.set(this._attachmentsList,"innerHTML",d||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(b){if(b){var d=this.showTitle?b.title:"",k=b.description,g=b.fields,h=b.mediaInfos,m=this.domNode,u=this._nls,z=this,v=this.template,y=this.graphic;this._prevMedia.title=u.NLS_prevMedia;this._nextMedia.title=u.NLS_nextMedia;c.set(this._title,"innerHTML",d);d||f.add(this._title,"hidden");!b.hasDescription&&g&&(k="",q.forEach(g,
function(a){k+="\x3ctr valign\x3d'top'\x3e";k+="\x3ctd class\x3d'attrName'\x3e"+n.encode(a[0])+"\x3c/td\x3e";k+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+u.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";k+="\x3c/tr\x3e"}),k&&(k="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+k+"\x3c/table\x3e"));c.set(this._description,"innerHTML",k);k||f.add(this._description,"hidden");e.query("a",
this._description).forEach(function(a){z._preventNewTab(a.href)?"_blank"===a.target&&c.remove(a,"target"):c.set(a,"target","_blank")});d&&k?e.query(".mainSection .hzLine",m).removeClass("hidden"):d||k?e.query(".mainSection .hzLine",m).addClass("hidden"):e.query(".mainSection",m).addClass("hidden");if(d=this._dfd=v.getAttachments(y))d.addBoth(t.hitch(this,this._attListHandler,d)),c.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+u.NLS_searching+"...\x3c/li\x3e"),e.query(".attachmentsSection",m).removeClass("hidden");
h&&h.length&&(e.query(".mediaSection",m).removeClass("hidden"),a.setSelectable(this._mediaFrame,!1),this._mediaInfos=h,this._mediaPtr=0,this._updateUI(),this._displayMedia());b.editSummary&&(c.set(this._editSummary,"innerHTML",b.editSummary),h&&h.length&&f.remove(this._mediaBreak,"hidden"),f.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});w("extend-esri")&&t.setObject("dijit._PopupRenderer",h,k);return h})},
"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(r,h,g,t,q,e,w,d,a){var c=q.delegate(d,{mouseenter:e.enter,mouseleave:e.leave,keypress:g._keypress}),f;g=t("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},
_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var c=a;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(a,c){return a.getAttribute(c)},this._attach)||this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==a)break;for(;!c.nextSibling;)if(c=c.parentNode,c==a)return;c=c.nextSibling}},_processTemplateNode:function(a,c,d){var f=!0,b=this.attachScope||this,k=c(a,"dojoAttachPoint")||c(a,"data-dojo-attach-point");if(k)for(var e=k.split(/\s*,\s*/);k=e.shift();)q.isArray(b[k])?
b[k].push(a):b[k]=a,f="containerNode"!=k,this._attachPoints.push(k);if(c=c(a,"dojoAttachEvent")||c(a,"data-dojo-attach-event")){k=c.split(/\s*,\s*/);for(e=q.trim;c=k.shift();)if(c){var g=null;-1!=c.indexOf(":")?(g=c.split(":"),c=e(g[0]),g=e(g[1])):c=e(c);g||(g=c);this._attachEvents.push(d(a,c,q.hitch(b,g)))}}return f},_attach:function(a,d,e){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?f||(f=r("./a11yclick")):c[d]||d;return w(a,d,e)},_detachTemplateNodes:function(){var a=this.attachScope||
this;h.forEach(this._attachPoints,function(c){delete a[c]});this._attachPoints=[];h.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});q.extend(a,{dojoAttachEvent:"",dojoAttachPoint:""});return g})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),function(r,h,g,t,q,e,w){r=r([w],{declaredClass:"esri.layers._SnapshotMode",
constructor:function(d){this.featureLayer=d;this.pagination=d.queryPagination;this._featureMap={};this._drawFeatures=h.hitch(this,this._drawFeatures);this._queryErrorHandler=h.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(d){this._init&&(d?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(d){var a=d.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(a,d);this._incRefCount(a)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var d=this.featureLayer;d._collection?(d._fireUpdateStart(),d._refresh(!0),d._fireUpdateEnd()):this._fetchAll()},_getRequestId:function(d){return("_"+d.name+d.layerId+d._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var d=this.featureLayer;
!d._collection&&!d.suspended&&(d._fireUpdateStart(),this._clearIIf(),this._sendRequest())},_sendRequest:function(d){var a=this.map,c=this.featureLayer,f=c.getDefinitionExpression(),g=new e;g.outFields=c.getOutFields();g.where=f||"1\x3d1";g.returnGeometry=!0;g.outSpatialReference=new q(a.spatialReference.toJson());g.timeExtent=c.getTimeDefinition();g.maxAllowableOffset=c._maxOffset;g.quantizationParameters=c._quantizationParameters;c._ts&&(g._ts=(new Date).getTime());g.orderByFields=c.supportsAdvancedQueries?
c.getOrderByFields():null;g.multipatchOption=c.multipatchOption;this.pagination&&(this._start=g.start=null==d?0:d,g.num=c.maxRecordCount);var h;c._usePatch&&(h=this._getRequestId(c),this._cancelPendingRequest(null,h));c._task.execute(g,this._drawFeatures,this._queryErrorHandler,h)},_drawFeatures:function(d){this._purgeRequests();var a=d.features,c=this.featureLayer,f=c.objectIdField,e,g=a.length,h=d.exceededTransferLimit&&!c._collection,q=c._selectedFeatures,b=c.mode===c.constructor.MODE_AUTO,k,z,
u;for(e=0;e<g;e++)z=a[e],u=z.attributes[f],k=this._addFeatureIIf(u,z),this._incRefCount(u),b&&(k!==z&&q[u])&&(k.setGeometry(z.geometry),k.setAttributes(z.attributes));this._applyTimeFilter(!0);if(!this.pagination||!h)c._fireUpdateEnd(null,d.exceededTransferLimit?{queryLimitExceeded:!0}:null);h&&(this.pagination&&this._sendRequest(this._start+c.maxRecordCount),c.onQueryLimitExceeded())},_queryErrorHandler:function(d){this._purgeRequests();var a=this.featureLayer;a._errorHandler(d);a._fireUpdateEnd(d)}});
g("extend-esri")&&h.setObject("layers._SnapshotMode",r,t);return r})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(r,h,g,t,q){r=r([q],{declaredClass:"esri.layers._SelectionMode",constructor:function(e){this.featureLayer=e;this._featureMap={}},propertyChangeHandler:function(e){this._init&&0===e&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});g("extend-esri")&&h.setObject("layers._SelectionMode",
r,t);return r})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(r,h,g,t,q,e,w,d){r=r(d,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,c){a&&h.isString(a)&&(this._url=w.urlToObject(this.url=a));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;this._errorHandler=h.hitch(this,this._errorHandler);
this.registerConnectEvents()},_useSSL:function(){var a=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));a&&a.path&&(a.path=a.path.replace(c,"https:"))},_encode:function(a,c,d){var e,q,n={},r,b;for(r in a)if("declaredClass"!==r&&(e=a[r],q=typeof e,null!==e&&void 0!==e&&"function"!==q))if(h.isArray(e)){n[r]=[];b=e.length;for(q=0;q<b;q++)n[r][q]=this._encode(e[q])}else"object"===q?e.toJson&&(q=e.toJson(d&&d[r]),"esri.tasks.FeatureSet"===e.declaredClass&&q.spatialReference&&(q.sr=
q.spatialReference,delete q.spatialReference),n[r]=c?q:g.toJson(q)):n[r]=e;return n},_successHandler:function(a,c,d,g){c&&this[c].apply(this,a);d&&d.apply(null,a);g&&e._resDfd(g,a)},_errorHandler:function(a,c,d){this.onError(a);c&&c(a);d&&d.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});t("extend-esri")&&(q.Task=r);return r})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(r,h,g){r.DeferredList=function(r,
q,e,w,d){var a=[];h.call(this);var c=this;0===r.length&&!q&&this.resolve([0,[]]);var f=0;g.forEach(r,function(d,g){function h(d,b){a[g]=[d,b];f++;f===r.length&&c.resolve(a)}d.then(function(a){q?c.resolve([g,a]):h(!0,a)},function(a){e?c.reject(a):h(!1,a);if(w)return null;throw a;})})};r.DeferredList.prototype=new h;r.DeferredList.prototype.gatherResults=function(h){h=new r.DeferredList(h,!1,!0,!1);h.addCallback(function(h){var e=[];g.forEach(h,function(g){e.push(g[1])});return e});return h};return r.DeferredList})},
"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(r,h,g,t,q,e){r=t("dijit._OnDijitClickMixin",null,{connect:function(g,d,a){return this.inherited(arguments,[g,"ondijitclick"==d?e:d,a])}});r.a11yclick=e;return r})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(r,h,g,t){function q(d){if((d.keyCode===r.ENTER||d.keyCode===r.SPACE)&&!/input|button|textarea/i.test(d.target.nodeName))for(d=
d.target;d;d=d.parentNode)if(d.dojoClick)return!0}var e;g(document,"keydown",function(d){q(d)?(e=d.target,d.preventDefault()):e=null});g(document,"keyup",function(d){q(d)&&d.target==e&&(e=null,g.emit(d.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:d.ctrlKey,shiftKey:d.shiftKey,metaKey:d.metaKey,altKey:d.altKey,_origType:d.type}))});var w=function(d,a){d.dojoClick=!0;return g(d,"click",a)};w.click=w;w.press=function(d,a){var c=g(d,t.press,function(c){("mousedown"!=c.type||h.isLeft(c))&&a(c)}),f=
g(d,"keydown",function(c){(c.keyCode===r.ENTER||c.keyCode===r.SPACE)&&a(c)});return{remove:function(){c.remove();f.remove()}}};w.release=function(d,a){var c=g(d,t.release,function(c){("mouseup"!=c.type||h.isLeft(c))&&a(c)}),f=g(d,"keyup",function(c){(c.keyCode===r.ENTER||c.keyCode===r.SPACE)&&a(c)});return{remove:function(){c.remove();f.remove()}}};w.move=t.move;return w})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(r,h,g,t){g(function(){h("highcontrast")&&
r.add(t.body(),"dijit_a11y")});return h})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(r,h,g,t,q,e,w,d){var a=h("dijit._TemplatedMixin",d,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var d=this.declaredClass,e=this;return w.substitute(a,this,function(a,c){"!"==c.charAt(0)&&(a=t.getObject(c.substr(1),!1,e));if("undefined"==
typeof a)throw Error(d+" template:"+c);return null==a?"":"!"==c.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=r(this.templatePath,{sanitize:!0}));var c=a.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),d;if(t.isString(c)){if(d=
g.toDom(this._stringRepl(c),this.ownerDocument),1!=d.nodeType)throw Error("Invalid template: "+c);}else d=c.cloneNode(!0);this.domNode=d}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var d=this.containerNode;if(a&&d)for(;a.hasChildNodes();)d.appendChild(a.firstChild)}});a._templateCache={};a.getCachedTemplate=function(c,d,e){var h=a._templateCache,n=c,q=h[n];if(q){try{if(!q.ownerDocument||q.ownerDocument==(e||document))return q}catch(b){}g.destroy(q)}c=
w.trim(c);if(d||c.match(/\$\{([^\}]+)\}/g))return h[n]=c;d=g.toDom(c,e);if(1!=d.nodeType)throw Error("Invalid template: "+c);return h[n]=d};e("ie")&&q(window,"unload",function(){var c=a._templateCache,d;for(d in c){var e=c[d];"object"==typeof e&&g.destroy(e);delete c[d]}});return a})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A){r=r(c,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=h.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var c=[],d,e=a.length;for(d=0;d<e;d++)c.push(a[d].toJson());
return{geometryType:A.getJsonType(a[0]),geometries:c}},_decodeGeometries:function(a,c,d){var e=A.getGeometryType(c);a=a.geometries;var f=[],n={spatialReference:d.toJson()},p=h.mixin;g.forEach(a,function(a,b){f[b]=new e(p(a,n))});return f},_toProjectGeometry:function(a){var c=a.spatialReference.toJson();return a instanceof f?new x({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:c}):new m({paths:[[].concat(a.points)],spatialReference:c})},
_fromProjectedGeometry:function(a,c,d){return"esriGeometryEnvelope"===c?(a=a.rings[0],new f(a[0][0],a[0][1],a[2][0],a[2][1],d)):new n({points:a.paths[0],spatialReference:d.toJson()})},project:function(b,c,e,f){var g=h.mixin({},this._url.query,{f:"json"}),n;b.geometries?(f=e,e=c,c=b.outSR,n=b.geometries[0],g=h.mixin(g,b.toJson())):(n=b[0],g=h.mixin(g,{outSR:c.wkid||t.toJson(c.toJson()),inSR:n.spatialReference.wkid||t.toJson(n.spatialReference.toJson()),geometries:t.toJson(this._encodeGeometries(b))}));
var p=A.getJsonType(n),l=this._projectHandler,s=this._errorHandler,m=new q(a._dfdCanceller);m._pendingDfd=d({url:this._url.path+"/project",content:g,callbackParamName:"callback",load:function(a,b){l(a,b,p,c,e,f,m)},error:function(a){s(a,f,m)}});return m},_projectHandler:function(a,c,d,e,f,g,h){try{var l=this._decodeGeometries(a,d,e);this._successHandler([l],"onProjectComplete",f,h)}catch(s){this._errorHandler(s,g,h)}},onProjectComplete:function(){},simplify:function(b,c,e){var f=b[0].spatialReference,
g=h.mixin({},this._url.query,{f:"json",sr:f.wkid?f.wkid:t.toJson(f.toJson()),geometries:t.toJson(this._encodeGeometries(b))}),n=A.getJsonType(b[0]),p=this._simplifyHandler,l=this._errorHandler,s=new q(a._dfdCanceller);s._pendingDfd=d({url:this._url.path+"/simplify",content:g,callbackParamName:"callback",load:function(a,b){p(a,b,n,f,c,e,s)},error:function(a){l(a,e,s)}});return s},_simplifyHandler:function(a,c,d,e,f,g,h){try{var l=this._decodeGeometries(a,d,e);this._successHandler([l],"onSimplifyComplete",
f,h)}catch(s){this._errorHandler(s,g,h)}},onSimplifyComplete:function(){},convexHull:function(b,c,e){var f=b[0].spatialReference;b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(f.toJson()),geometries:t.toJson(this._encodeGeometries(b))});var g=this._convexHullHandler,n=this._errorHandler,p=new q(a._dfdCanceller);p._pendingDfd=d({url:this._url.path+"/convexHull",content:b,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,e,p)},error:function(a){n(a,e,p)}});return p},_convexHullHandler:function(a,
c,d,e,f,g){try{var h=A.fromJson(a.geometry).setSpatialReference(d);this._successHandler([h],"onConvexHullComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onConvexHullComplete:function(){},union:function(b,c,e){var f=b[0].spatialReference;b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(f.toJson()),geometries:t.toJson(this._encodeGeometries(b))});var g=this._unionHandler,n=this._errorHandler,p=new q(a._dfdCanceller);p._pendingDfd=d({url:this._url.path+"/union",content:b,callbackParamName:"callback",
load:function(a,b){g(a,b,f,c,e,p)},error:function(a){n(a,e,p)}});return p},_unionHandler:function(a,c,d,e,f,g){try{var h=A.fromJson(a.geometry).setSpatialReference(d);this._successHandler([h],"onUnionComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onUnionComplete:function(){},autoComplete:function(b,c,e,f){var g=b[0].spatialReference;b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(g.toJson()),polygons:t.toJson(this._encodeGeometries(b).geometries),polylines:t.toJson(this._encodeGeometries(c).geometries)});
var n=this._autoCompleteHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/autoComplete",content:b,callbackParamName:"callback",load:function(a,b){n(a,b,g,e,f,l)},error:function(a){p(a,f,l)}});return l},_autoCompleteHandler:function(a,c,d,e,f,g){try{var h=a.geometries;a=[];var l,s=h.length;for(l=0;l<s;l++)a[l]=new x({spatialReference:d,rings:h[l].rings});this._successHandler([a],"onAutoCompleteComplete",e,g)}catch(n){this._errorHandler(n,f,g)}},onAutoCompleteComplete:function(){},
reshape:function(b,c,e,f){var g=b.spatialReference;b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(g.toJson()),target:t.toJson({geometryType:A.getJsonType(b),geometry:b.toJson()}),reshaper:t.toJson(c.toJson())});var n=this._reshapeHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/reshape",content:b,callbackParamName:"callback",load:function(a,b){n(a,b,g,e,f,l)},error:function(a){p(a,f,l)}});return l},_reshapeHandler:function(a,c,d,e,f,g){try{var h=A.fromJson(a.geometry).setSpatialReference(d);
this._successHandler([h],"onReshapeComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onReshapeComplete:function(){},cut:function(b,c,e,f){var n=b[0].spatialReference,m=g.map(b,function(a){return a.toJson()});b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(n.toJson()),target:t.toJson({geometryType:A.getJsonType(b[0]),geometries:m}),cutter:t.toJson(c.toJson())});var p=this._cutHandler,l=this._errorHandler,s=new q(a._dfdCanceller);s._pendingDfd=d({url:this._url.path+"/cut",content:b,callbackParamName:"callback",
load:function(a,b){p(a,b,n,e,f,s)},error:function(a){l(a,f,s)}});return s},_cutHandler:function(a,c,d,e,f,h){try{var p=a.geometries,l={};l.cutIndexes=a.cutIndexes;l.geometries=[];g.forEach(p,function(a){l.geometries.push(A.fromJson(a).setSpatialReference(d))});this._successHandler([l],"onCutComplete",e,h)}catch(s){this._errorHandler(s,f,h)}},onCutComplete:function(){},intersect:function(b,c,e,f){var g=b[0].spatialReference;b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(g.toJson()),geometries:t.toJson(this._encodeGeometries(b)),
geometry:t.toJson({geometryType:A.getJsonType(c),geometry:c.toJson()})});var n=this._intersectHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/intersect",content:b,callbackParamName:"callback",load:function(a,b){n(a,b,g,e,f,l)},error:function(a){p(a,f,l)}});return l},_intersectHandler:function(a,c,d,e,f,h){try{var p=[];g.forEach(a.geometries,function(a){p.push(A.fromJson(a).setSpatialReference(d))});this._successHandler([p],"onIntersectComplete",e,h)}catch(l){this._errorHandler(l,
f,h)}},onIntersectComplete:function(){},difference:function(b,c,e,f){var g=b[0].spatialReference;b=h.mixin({},this._url.query,{f:"json",sr:t.toJson(g.toJson()),geometries:t.toJson(this._encodeGeometries(b)),geometry:t.toJson({geometryType:A.getJsonType(c),geometry:c.toJson()})});var n=this._differenceHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/difference",content:b,callbackParamName:"callback",load:function(a,b){n(a,b,g,e,f,l)},error:function(a){p(a,
f,l)}});return l},_differenceHandler:function(a,c,d,e,f,h){try{var p=[];g.forEach(a.geometries,function(a){p.push(A.fromJson(a).setSpatialReference(d))});this._successHandler([p],"onDifferenceComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onDifferenceComplete:function(){},buffer:function(b,c,e){var f=h.mixin({},this._url.query,{f:"json"},b.toJson()),g=b.outSpatialReference||b.geometries[0].spatialReference,n=this._bufferHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+
"/buffer",content:f,callbackParamName:"callback",load:function(a,b){n(a,b,g,c,e,l)},error:function(a){p(a,e,l)}});return l},_bufferHandler:function(a,c,d,e,f,g){try{var h=a.geometries;a=[];var l,s=h.length;for(l=0;l<s;l++)a[l]=new x({spatialReference:d,rings:h[l].rings});this._successHandler([a],"onBufferComplete",e,g)}catch(n){this._errorHandler(n,f,g)}},onBufferComplete:function(){},areasAndLengths:function(b,c,e){b=h.mixin({},this._url.query,{f:"json"},b.toJson());var f=this._areasAndLengthsHandler,
g=this._errorHandler,n=new q(a._dfdCanceller);n._pendingDfd=d({url:this._url.path+"/areasAndLengths",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,c,e,n)},error:function(a){g(a,e,n)}});return n},_areasAndLengthsHandler:function(a,c,d,e,f){try{this._successHandler([a],"onAreasAndLengthsComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onAreasAndLengthsComplete:function(){},lengths:function(b,c,e){b=h.mixin({},this._url.query,{f:"json"},b.toJson());var f=this._lengthsHandler,g=this._errorHandler,
n=new q(a._dfdCanceller);n._pendingDfd=d({url:this._url.path+"/lengths",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,c,e,n)},error:function(a){g(a,e,n)}});return n},_lengthsHandler:function(a,c,d,e,f){try{this._successHandler([a],"onLengthsComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onLengthsComplete:function(){},labelPoints:function(b,c,e){var f=g.map(b,function(a){return a.toJson()}),n=b[0].spatialReference,f=h.mixin({},this._url.query,{f:"json",sr:n.wkid?n.wkid:t.toJson(n.toJson()),
polygons:t.toJson(f)}),m=this._labelPointsHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/labelPoints",content:f,callbackParamName:"callback",load:function(a,d){m(a,d,b,n,c,e,l)},error:function(a){p(a,e,l)}});return l},_labelPointsHandler:function(a,c,d,e,f,h,p){try{var l=[];g.forEach(a.labelPoints,function(a){l.push(A.fromJson(a).setSpatialReference(e))});this._successHandler([l],"onLabelPointsComplete",f,p)}catch(s){this._errorHandler(s,h,p)}},onLabelPointsComplete:function(){},
relation:function(b,c,e){b=h.mixin({},this._url.query,{f:"json"},b.toJson());var f=this._relationHandler,g=this._errorHandler,n=new q(a._dfdCanceller);n._pendingDfd=d({url:this._url.path+"/relation",content:b,callbackParamName:"callback",load:function(a,b){f(a,b,c,e,n)},error:function(a){g(a,e,n)}});return n},_relationHandler:function(a,c,d,e,f){try{this._successHandler([a.relations],"onRelationComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onRelationComplete:function(){},trimExtend:function(b,
c,e){var f=h.mixin({},this._url.query,{f:"json"},b.toJson()),g=b.sr,n=this._trimExtendHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/trimExtend",content:f,callbackParamName:"callback",load:function(a,b){n(a,b,g,c,e,l)},error:function(a){p(a,e,l)}});return l},_trimExtendHandler:function(a,c,d,e,f,g){try{var h=a.geometries;a=[];var l,s=h.length;for(l=0;l<s;l++)a[l]=new m({spatialReference:d,paths:h[l].paths});this._successHandler([a],"onTrimExtendComplete",
e,g)}catch(n){this._errorHandler(n,f,g)}},onTrimExtendComplete:function(){},densify:function(b,c,e){var f=h.mixin({},this._url.query,{f:"json"},b.toJson()),g=b.geometries[0].spatialReference,n=this._densifyHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/densify",content:f,callbackParamName:"callback",load:function(a,b){n(a,b,g,c,e,l)},error:function(a){p(a,e,l)}});return l},_densifyHandler:function(a,c,d,e,f,h){try{var p=[];g.forEach(a.geometries,function(a){p.push(A.fromJson(a).setSpatialReference(d))});
this._successHandler([p],"onDensifyComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onDensifyComplete:function(){},generalize:function(b,c,e){var f=h.mixin({},this._url.query,{f:"json"},b.toJson()),g=b.geometries[0].spatialReference,n=this._generalizeHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/generalize",content:f,callbackParamName:"callback",load:function(a,b){n(a,b,g,c,e,l)},error:function(a){p(a,e,l)}});return l},_generalizeHandler:function(a,
c,d,e,f,h){try{var p=[];g.forEach(a.geometries,function(a){p.push(A.fromJson(a).setSpatialReference(d))});this._successHandler([p],"onGeneralizeComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onGeneralizeComplete:function(){},offset:function(b,c,e){var f=h.mixin({},this._url.query,{f:"json"},b.toJson()),g=b.geometries[0].spatialReference,n=this._offsetHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/offset",content:f,callbackParamName:"callback",load:function(a,
b){n(a,b,g,c,e,l)},error:function(a){p(a,e,l)}});return l},_offsetHandler:function(a,c,d,e,f,h){try{var p=[];g.forEach(a.geometries,function(a){p.push(A.fromJson(a).setSpatialReference(d))});this._successHandler([p],"onOffsetComplete",e,h)}catch(l){this._errorHandler(l,f,h)}},onOffsetComplete:function(){},distance:function(b,c,e){var f=h.mixin({},this._url.query,{f:"json"},b.toJson()),g=b.geometry1.spatialReference,n=this._distanceHandler,p=this._errorHandler,l=new q(a._dfdCanceller);l._pendingDfd=
d({url:this._url.path+"/distance",content:f,callbackParamName:"callback",load:function(a,b){n(a,b,g,c,e,l)},error:function(a){p(a,e,l)}});return l},_distanceHandler:function(a,c,d,e,f,g){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",e,g)}catch(h){this._errorHandler(h,f,g)}},onDistanceComplete:function(){},toGeoCoordinateString:function(b,c,e){var f={};h.isObject(b.sr)?f.sr=b.sr.wkid||t.toJson(b.sr.toJson()):f.sr=b.sr;f.coordinates=t.toJson(b.coordinates);f.conversionType=b.conversionType||
"MGRS";f.conversionMode=b.conversionMode;f.numOfDigits=b.numOfDigits;f.rounding=b.rounding;f.addSpaces=b.addSpaces;b=h.mixin({},this._url.query,{f:"json"},f);var g=this._toGeoCoordinateHandler,n=this._errorHandler,p=new q(a._dfdCanceller);p._pendingDfd=d({url:this._url.path+"/toGeoCoordinateString",content:b,callbackParamName:"callback",load:function(a,b){g(a,b,c,e,p)},error:function(a){n(a,e,p)}});return p},_toGeoCoordinateHandler:function(a,c,d,e,f){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
d,f)}catch(g){this._errorHandler(g,e,f)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(b,c,e){var f={};h.isObject(b.sr)?f.sr=b.sr.wkid||t.toJson(b.sr.toJson()):f.sr=b.sr;f.strings=t.toJson(b.strings);f.conversionType=b.conversionType||"MGRS";f.conversionMode=b.conversionMode;b=h.mixin({},this._url.query,{f:"json"},f);var g=this._fromGeoCoordinateHandler,n=this._errorHandler,p=new q(a._dfdCanceller);p._pendingDfd=d({url:this._url.path+"/fromGeoCoordinateString",content:b,
callbackParamName:"callback",load:function(a,b){g(a,b,c,e,p)},error:function(a){n(a,e,p)}});return p},_fromGeoCoordinateHandler:function(a,c,d,e,f){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onFromGeoCoordinateStringComplete:function(){}});h.mixin(r,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});e("extend-esri")&&h.setObject("tasks.GeometryService",r,w);return r})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(r){var h=r.getObject("dojox.html.entities",!0),g=function(g,e){var h,d;if(e._encCache&&e._encCache.regexp&&e._encCache.mapper&&e.length==
e._encCache.length)h=e._encCache.mapper,d=e._encCache.regexp;else{h={};d=["["];var a;for(a=0;a<e.length;a++)h[e[a][0]]="\x26"+e[a][1]+";",d.push(e[a][0]);d.push("]");d=RegExp(d.join(""),"g");e._encCache={mapper:h,regexp:d,length:e.length}}return g=g.replace(d,function(a){return h[a]})},t=function(g,e){var h,d;if(e._decCache&&e._decCache.regexp&&e._decCache.mapper&&e.length==e._decCache.length)h=e._decCache.mapper,d=e._decCache.regexp;else{h={};d=["("];var a;for(a=0;a<e.length;a++){var c="\x26"+e[a][1]+
";";a&&d.push("|");h[c]=e[a][0];d.push(c)}d.push(")");d=RegExp(d.join(""),"g");e._decCache={mapper:h,regexp:d,length:e.length}}return g=g.replace(d,function(a){return h[a]})};h.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];h.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],
["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],
["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],
["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],
["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8",
"Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],
["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],
["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284",
"nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009",
"thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];h.encode=function(q,e){q&&(e?q=g(q,e):(q=g(q,h.html),q=g(q,h.latin)));return q};h.decode=function(g,e){g&&(e?g=t(g,e):(g=t(g,h.html),g=t(g,h.latin)));return g};return h})},
"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A,b){function k(a){return eval("("+a+")")}function z(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<v){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=v}return b}function u(a,b){var c=a.join();
if(!y[c]){for(var d=[],e=0,f=a.length;e<f;e++){var h=a[e];d[d.length]=y[h]=y[h]||g.getObject(h)||~h.indexOf("/")&&(b?b(h):r(h))}e=d.shift();y[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return y[c]}new Date("X");var v=0;a.after(g,"extend",function(){v++},!0);var y={},p={_clearCache:function(){v++;y={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),f=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);f&&f.length&&t.forEach(f.split(/\s*,\s*/),
function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||h._scopeName)+"Type",e="data-"+(c.scope||h._scopeName)+"-",f=e+"type",g=e+"mixins",k=[];t.forEach(a,function(a){var c=d in b?b[d]:a.getAttribute(f)||a.getAttribute(d);if(c){var e=a.getAttribute(g),c=e?[c].concat(e.split(/\s*,\s*/)):[c];k.push({node:a,types:c})}});return this._instantiate(k,b,c)},_instantiate:function(a,b,d,e){function f(a){!b._started&&!d.noStart&&
t.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=t.map(a,function(a){var c=a.ctor||u(a.types,d.contextRequire);if(!c)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(c,a.node,b,d,a.scripts,a.inherited)},this);return e?c(a).then(f):f(a)},construct:function(b,c,e,p,m,q){function r(b){Q&&g.setObject(Q,b);for(F=0;F<I.length;F++)a[I[F].advice||"after"](b,I[F].method,g.hitch(b,I[F].func),!0);for(F=0;F<X.length;F++)X[F].call(b);
for(F=0;F<L.length;F++)b.watch(L[F].prop,L[F].func);for(F=0;F<T.length;F++)A(b,T[F].event,T[F].func);return b}var u=b&&b.prototype;p=p||{};var v={};p.defaults&&g.mixin(v,p.defaults);q&&g.mixin(v,q);var w;x("dom-attributes-explicit")?w=c.attributes:x("dom-attributes-specified-flag")?w=t.filter(c.attributes,function(a){return a.specified}):(q=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,
""),w=t.map(q.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==c.nodeName&&"value"==a||"enctype"==b?c.getAttribute(b):c.getAttributeNode(b).value}}));var y=p.scope||h._scopeName;q="data-"+y+"-";var E={};"dojo"!==y&&(E[q+"props"]="data-dojo-props",E[q+"type"]="data-dojo-type",E[q+"mixins"]="data-dojo-mixins",E[y+"type"]="dojoType",E[q+"id"]="data-dojo-id");for(var F=0,D,y=[],Q,K;D=w[F++];){var G=D.name,H=G.toLowerCase();D=D.value;switch(E[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;
case "data-dojo-props":K=D;break;case "data-dojo-id":case "jsid":Q=D;break;case "data-dojo-attach-point":case "dojoattachpoint":v.dojoAttachPoint=D;break;case "data-dojo-attach-event":case "dojoattachevent":v.dojoAttachEvent=D;break;case "class":v["class"]=c.className;break;case "style":v.style=c.style&&c.style.cssText;break;default:if(G in u||(G=z(b)[H]||G),G in u)switch(typeof u[G]){case "string":v[G]=D;break;case "number":v[G]=D.length?Number(D):NaN;break;case "boolean":v[G]="false"!=D.toLowerCase();
break;case "function":""===D||-1!=D.search(/[^\w\.]+/i)?v[G]=new Function(D):v[G]=g.getObject(D,!1)||new Function(D);y.push(G);break;default:H=u[G],v[G]=H&&"length"in H?D?D.split(/\s*,\s*/):[]:H instanceof Date?""==D?new Date(""):"now"==D?new Date:f.fromISOString(D):H instanceof d?h.baseUrl+D:k(D)}else v[G]=D}}for(w=0;w<y.length;w++)E=y[w].toLowerCase(),c.removeAttribute(E),c[E]=null;if(K)try{K=k.call(p.propsThis,"{"+K+"}"),g.mixin(v,K)}catch(W){throw Error(W.toString()+" in data-dojo-props\x3d'"+
K+"'");}g.mixin(v,e);m||(m=b&&(b._noScript||u._noScript)?[]:n("\x3e script[type^\x3d'dojo/']",c));var I=[],X=[],L=[],T=[];if(m)for(F=0;F<m.length;F++)E=m[F],c.removeChild(E),e=E.getAttribute(q+"event")||E.getAttribute("event"),p=E.getAttribute(q+"prop"),K=E.getAttribute(q+"method"),y=E.getAttribute(q+"advice"),w=E.getAttribute("type"),E=this._functionFromScript(E,q),e?"dojo/connect"==w?I.push({method:e,func:E}):"dojo/on"==w?T.push({event:e,func:E}):v[e]=E:"dojo/aspect"==w?I.push({method:K,advice:y,
func:E}):"dojo/watch"==w?L.push({prop:p,func:E}):X.push(E);b=(m=b.markupFactory||u.markupFactory)?m(v,c,b):new b(v,c);return b.then?b.then(r):r(b)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(n)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var d=[],e=[],f={},g=(b.scope||h._scopeName)+"Type",k="data-"+(b.scope||h._scopeName)+"-",p=
k+"type",n=k+"textdir",k=k+"mixins",q=a.firstChild,v=b.inherited;if(!v){var z=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&z(a.parentNode,b)},v={dir:z(a,"dir"),lang:z(a,"lang"),textDir:z(a,n)},w;for(w in v)v[w]||delete v[w]}for(var v={inherited:v},y,A;;)if(q)if(1!=q.nodeType)q=q.nextSibling;else if(y&&"script"==q.nodeName.toLowerCase())(G=q.getAttribute("type"))&&/^dojo\/\w/i.test(G)&&y.push(q),q=q.nextSibling;else if(A)q=q.nextSibling;else{var G=q.getAttribute(p)||q.getAttribute(g);
w=q.firstChild;if(!G&&(!w||3==w.nodeType&&!w.nextSibling))q=q.nextSibling;else{A=null;if(G){var H=q.getAttribute(k);y=H?[G].concat(H.split(/\s*,\s*/)):[G];try{A=u(y,b.contextRequire)}catch(W){}A||t.forEach(y,function(a){~a.indexOf("/")&&!f[a]&&(f[a]=!0,e[e.length]=a)});H=A&&!A.prototype._noScript?[]:null;v={types:y,ctor:A,parent:v,node:q,scripts:H};v.inherited=c(v);d.push(v)}else v={node:q,scripts:y,parent:v};y=H;A=q.stopParser||A&&A.prototype.stopParser&&!b.template;q=w}}else{if(!v||!v.node)break;
q=v.node.nextSibling;A=!1;v=v.parent;y=v.scripts}var I=new m;e.length?(x("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+e.join(", ")),(b.contextRequire||r)(e,function(){I.resolve(t.filter(d,function(a){if(!a.ctor)try{a.ctor=u(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):
I.resolve(d);return I.promise},_require:function(a,b){var c=k("{"+a.innerHTML+"}"),d=[],e=[],f=new m,h=b&&b.contextRequire||r,p;for(p in c)d.push(p),e.push(c[p]);h(e,function(){for(var a=0;a<d.length;a++)g.setObject(d[a],arguments[a]);f.resolve(arguments)});return f.promise},_scanAmd:function(a,b){var c=new m,d=c.promise;c.resolve(!0);var e=this;n("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,
b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&g.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?e.byId(c):w.body();b=b||{};var d=b.template?{template:!0}:{},f=[],h=this,k=this._scanAmd(c,b).then(function(){return h.scan(c,b)}).then(function(a){return h._instantiate(a,d,b,!0)}).then(function(a){return f=f.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});g.mixin(f,k);return f}};h.parser=p;q.parseOnLoad&&b(100,p,"parse");return p})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x){function n(){}function A(a){return function(c,d,e,f){return c&&"string"==typeof d&&c[d]==n?c.on(d.substring(2).toLowerCase(),w.hitch(e,f)):a.apply(g,arguments)}}r.around(g,"connect",A);e.connect&&r.around(e,"connect",A);r=t("dijit._Widget",[f,m,x],{onClick:n,onDblClick:n,onKeyDown:n,onKeyPress:n,onKeyUp:n,onMouseDown:n,onMouseMove:n,onMouseOut:n,onMouseOver:n,onMouseLeave:n,onMouseEnter:n,onMouseUp:n,constructor:function(a){this._toConnect={};for(var c in a)this[c]===
n&&(this._toConnect[c.replace(/^on/,"").toLowerCase()]=a[c],delete a[c])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,c){return this[this._onMap(a)]===n?g.connect(this.domNode,a.toLowerCase(),this,c):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,c){e.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,c)},attr:function(a,c){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){e.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?d("[widgetId]",this.containerNode).map(c.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});q("dijit-legacy-requires")&&a(0,function(){require(["dijit/_base"])});
return r})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(r,h,g,t){t.extend(h,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return g("dijit._FocusMixin",null,{_focusManager:r})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x,n,A,b,k){var z,u,v=new (h([m,w],{curNode:null,activeStack:[],constructor:function(){var a=d.hitch(this,function(a){g.isDescendant(this.curNode,a)&&this.set("curNode",null);g.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});r.before(e,"empty",a);r.before(e,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(b,c){var d=this,e=b.document&&b.document.body;if(e){var g=f("pointer-events")?"pointerdown":f("MSPointer")?
"MSPointerDown":f("touch-events")?"mousedown, touchstart":"mousedown",h=a(b.document,g,function(a){if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),k=a(e,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(A.isFocusable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),n=a(e,"focusout",function(a){d._onBlurNode(c||a.target)});return{remove:function(){h.remove();k.remove();n.remove();e=h=
k=n=null}}}},_onBlurNode:function(a){a=(new Date).getTime();a<z+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(d.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<u+100||(this._clearActiveWidgetsTimer=setTimeout(d.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,c){u=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);q.contains(a,"dijitPopup")&&(a=a.firstChild);var d=[];try{for(;a;){var e=t.get(a,"dijitPopupParent");if(e)a=b.byId(e).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===x.body())break;a=n.get(a.ownerDocument).frameElement}else{var f=a.getAttribute&&a.getAttribute("widgetId"),g=f&&b.byId(f);g&&!("mouse"==c&&g.get("disabled"))&&d.unshift(f);a=a.parentNode}}}catch(h){}this._setStack(d,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(z=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,c){var d=this.activeStack,e=d.length-1,f=a.length-1;if(a[f]!=d[e]){this.set("activeStack",a);var g;for(g=e;0<=g&&d[g]!=a[g];g--)if(e=b.byId(d[g]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),
this.emit("widget-blur",e,c);for(g++;g<=f;g++)if(e=b.byId(a[g]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));c(function(){var b=v.registerWin(n.get(document));f("ie")&&a(window,"unload",function(){b&&(b.remove(),b=null)})});k.focus=function(a){v.focus(a)};for(var y in v)/^_/.test(y)||(k.focus[y]="function"==typeof v[y]?d.hitch(v,y):v[y]);v.watch(function(a,b,c){k.focus[a]=c});return v})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(r,h,g,t,q,e,w,d,a,c,f,m,x){r=r(m,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,c){this._handler=h.hitch(this,this._handler);this._relationshipQueryHandler=h.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=h.hitch(this,this._executeForIdsHandler);this._countHandler=h.hitch(this,this._countHandler);
this._extentHandler=h.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(a,c,b,e,f){var g=f.assembly;a=this._encode(h.mixin({},this._url.query,{f:"json"},a.toJson(g&&g[0])));var m=this._handler,r=this._errorHandler;this.source&&(g={source:this.source.toJson()},a.layer=q.toJson(g));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){m(a,d,c,b,f.dfd)},error:function(a){r(a,b,f.dfd)},callbackSuffix:e},this.requestOptions)},executeRelationshipQuery:function(c,
e,b){c=this._encode(h.mixin({},this._url.query,{f:"json"},c.toJson()));var f=this._relationshipQueryHandler,g=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var m=new t(a._dfdCanceller);m._pendingDfd=d({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(a,c){f(a,c,e,b,m)},error:function(a){g(a,b,m)}},this.requestOptions);return m},executeForIds:function(a,c,b,e){var f=e.assembly;a=this._encode(h.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
a.toJson(f&&f[0])));var g=this._executeForIdsHandler,m=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=q.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){g(a,d,c,b,e.dfd)},error:function(a){m(a,b,e.dfd)}},this.requestOptions)},executeForCount:function(a,c,b,e){var f=e.assembly;a=this._encode(h.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(f&&
f[0])));var g=this._countHandler,m=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=q.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){g(a,d,c,b,e.dfd)},error:function(a){m(a,b,e.dfd)}},this.requestOptions)},executeForExtent:function(a,c,b,e){var f=e.assembly;a=this._encode(h.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(f&&f[0])));
var g=this._extentHandler,m=this._errorHandler;this.source&&(f={source:this.source.toJson()},a.layer=q.toJson(f));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){g(a,d,c,b,e.dfd)},error:function(a){m(a,b,e.dfd)}},this.requestOptions)},_handler:function(a,c,b,d,e){try{var f=new x(a);this._successHandler([f],"onComplete",b,e)}catch(g){this._errorHandler(g,d,e)}},_relationshipQueryHandler:function(a,c,b,d,
e){try{var f=a.geometryType,h=a.spatialReference,m={};g.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=f;b.spatialReference=h;b.features=a.relatedRecords;b=new x(b);if(null!=a.objectId)m[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(m[a[c]]=b)});this._successHandler([m],"onExecuteRelationshipQueryComplete",b,e)}catch(p){this._errorHandler(p,d,e)}},_executeForIdsHandler:function(a,c,b,d,e){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
b,e)}catch(f){this._errorHandler(f,d,e)}},_countHandler:function(a,c,b,d,e){try{var f,g=a.features,h=a.objectIds;if(h)f=h.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");f=a.count}this._successHandler([f],"onExecuteForCountComplete",b,e)}catch(m){this._errorHandler(m,d,e)}},_extentHandler:function(a,d,b,e,f){try{a.extent&&(a.extent=new c(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",b,f)}catch(g){this._errorHandler(g,e,f)}}});f._createWrappers(r);
e("extend-esri")&&h.setObject("tasks.QueryTask",r,w);return r})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(r,h,g){return g("dijit.Destroyable",null,{destroy:function(g){this._destroyed=!0},own:function(){var g=["destroyRecursive","destroy","remove"];r.forEach(arguments,function(q){function e(){d.remove();r.forEach(a,function(a){a.remove()})}var w,d=h.before(this,"destroy",function(a){q[w](a)}),a=[];q.then?(w="cancel",q.then(e,e)):r.forEach(g,
function(c){"function"===typeof q[c]&&(w||(w=c),a.push(h.after(q,c,e,!0)))})},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(r,h,g,t){r=r(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(g){g&&h.isObject(g)&&(this.objectId=g.objectId,this.success=g.success,g.success||(g=g.error,this.error=Error(),this.error.code=g.code,this.error.message=g.description))}});g("extend-esri")&&
h.setObject("layers.FeatureEditResult",r,t);return r})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(r){return r.cache})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(r,h,g,t,q,e,w,d,a,c,f){r=r(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){h.mixin(this,a);var e=
this.features,n=a.spatialReference,q=c.getGeometryType(a.geometryType),n=this.spatialReference=new d(n);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);g.forEach(e,function(a,c){var d=a.geometry&&a.geometry.spatialReference;e[c]=new w(q&&a.geometry?new q(a.geometry):null,a.symbol&&f.fromJson(a.symbol),a.attributes);e[c].geometry&&!d&&e[c].geometry.setSpatialReference(n)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,
toJson:function(d){var f={};this.displayFieldName&&(f.displayFieldName=this.displayFieldName);this.fields&&(f.fields=this.fields);this.spatialReference?f.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(f.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(f.geometryType=c.getJsonType(this.features[0].geometry)),f.features=a._encodeGraphics(this.features,d));f.exceededTransferLimit=this.exceededTransferLimit;
f.transform=this.transform;return e.fixJson(f)},_hydrate:function(){var a=this.transform,c=this.geometryType;if(a&&c)for(var d=this.features,e=a.translate[0],b=a.translate[1],f=a.scale[0],g=a.scale[1],h=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,e,f,g,h,k,n,m;d=0;for(e=a.length;d<e;d++){h=a[d];f=0;for(g=h.length;f<g;f++)k=h[f],0<f?(n+=k[0],m+=k[1]):(n=k[0],
m=k[1]),k[0]=b(n),k[1]=c(m)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,e,f,g,h;d=0;for(e=a.length;d<e;d++)f=a[d],0<d?(g+=f[0],h+=f[1]):(g=f[0],h=f[1]),f[0]=b(g),f[1]=c(h)}}(c,function(a){return a*f+e},function(a){return b-a*g}),a=0,c=d.length;a<c;a++)d[a].geometry&&h(d[a].geometry);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=
null,this;var c=a.translate[0],d=a.translate[1],e=a.scale[0],b=a.scale[1],f=this.features,g=function(a,b,c){var d,e,f,g,h,k,n=[];d=0;for(e=a.length;d<e;d++)if(f=a[d],0<d){if(k=b(f[0]),f=c(f[1]),k!==g||f!==h)n.push([k-g,f-h]),g=k,h=f}else g=b(f[0]),h=c(f[1]),n.push([g,h]);return 0<n.length?n:null},h=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,e,f,h,k;f=a.rings||a.paths;
k=[];d=0;for(e=f.length;d<e;d++)h=f[d],(h=g(h,b,c))&&k.push(h);return 0<k.length?(a.rings?a.rings=k:a.paths=k,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=g(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-c)/e)},function(a){return Math.round((d-a)/b)}),q,r;q=0;for(r=f.length;q<r;q++)f[q].geometry&&(h(f[q].geometry)||f[q].setGeometry(null));this.transform=a;return this}});
t("extend-esri")&&h.setObject("tasks.FeatureSet",r,q);return r})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(r,h,g,t,q,e){r=r(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(g){g&&h.isObject(g)&&(this.name=g.name,this.description=g.description,this.drawingTool=g.drawingTool,g=g.prototype,this.prototype=new e(g.geometry,null,g.attributes))},toJson:function(){return q.fixJson({name:this.name,
description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()})}});h.mixin(r,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",
TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});g("extend-esri")&&h.setObject("layers.FeatureTemplate",r,t);return r})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(r,h,g,t){r=r(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});g("extend-esri")&&h.setObject("tasks.StatisticDefinition",r,t);return r})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),
function(r,h,g,t,q,e,w,d){r=r([e,w],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(a,c){h.mixin(this,c);this.initialize(a,c)},getTitle:function(a){var c;this.info&&(c=this.titleHasRelatedFields?"":this._getPopupValues(a,!0).title);return c||""},getContent:function(a){return this.info?(new d({template:this,graphic:a,chartTheme:this.chartTheme},t.create("div"))).domNode:""}});g("extend-esri")&&h.setObject("dijit.PopupTemplate",r,q);return r})},
"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct dojo/sniff ../kernel ../config ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(r,
h,g,t,q,e,w,d,a,c,f,m,x,n,A,b,k,z,u,v,y,p,l,s,U,N,C,P,M,R){function S(a){return A({url:O.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function ba(a,b){var c={f:"json"};b&&(c.token=b);return A({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function Z(a){a.itemProperties.layerDefinition&&(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),
n.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),n.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),n.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);
n.isDefined(a.itemProperties.showLabels)&&!n.isDefined(a.showLabels)&&(a.showLabels=a.itemProperties.showLabels);n.isDefined(a.itemProperties.showLegend)&&!n.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);n.isDefined(a.itemProperties.refreshInterval)&&!n.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}function E(a){Z(a);a.itemProperties.layerDefinition&&a.layerDefinition&&(!n.isDefined(a.layerDefinition.maximumTrackPoints)&&n.isDefined(a.itemProperties.layerDefinition.maximumTrackPoints)&&
(a.layerDefinition.maximumTrackPoints=a.itemProperties.layerDefinition.maximumTrackPoints),!a.layerDefinition.definitionGeometry&&a.itemProperties.layerDefinition.definitionGeometry&&(a.layerDefinition.definitionGeometry=a.itemProperties.layerDefinition.definitionGeometry));a.itemProperties.purgeOptions&&!a.purgeOptions&&(a.purgeOptions=a.itemProperties.purgeOptions)}function F(b,c){var d=new q,e=b.itemData,f=[],h=[];g.forEach(e.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();
-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(h.push(a),f.push(S(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!n.isDefined(a.minScale)&&!n.isDefined(a.maxScale))?(h.push(a),f.push(S(a))):-1<b.indexOf("/imageserver")&&!n.isDefined(a.minScale)&&!n.isDefined(a.maxScale)?(h.push(a),f.push(S(a))):-1<b.indexOf("/streamserver")&&(h.push(a),f.push(S(a)))}});e.baseMap&&e.baseMap.baseMapLayers&&g.forEach(e.baseMap.baseMapLayers,function(a){a.itemId&&"VectorTileLayer"!==
a.layerType&&(h.push(a),f.push(S(a)))});if(0<f.length){var k={};(new a(f)).addCallback(function(a){g.forEach(h,function(b,c){var d=a[c][1];if(d&&!(d instanceof Error)&&(k[b.itemId]=d,!b.type)){var e=b.url.toLowerCase();if((-1<e.indexOf("/featureserver")||-1<e.indexOf("/mapserver/"))&&d.layers)g.forEach(d.layers,function(a){if(e.match("/featureserver/"+a.id+"$")=="/featureserver/"+a.id||e.match("/mapserver/"+a.id+"$")=="/mapserver/"+a.id)b.itemProperties=a,Z(b)});else if(-1<e.indexOf("/streamserver"))b.itemProperties=
d,E(b);else if(-1<e.indexOf("/mapserver"))d.layers&&!b.layers&&(b.layers=d.layers),n.isDefined(d.minScale)&&!n.isDefined(b.minScale)&&(b.minScale=d.minScale),n.isDefined(d.maxScale)&&!n.isDefined(b.maxScale)&&(b.maxScale=d.maxScale),n.isDefined(d.refreshInterval)&&!n.isDefined(b.refreshInterval)&&(b.refreshInterval=d.refreshInterval),d.visibleLayers&&!b.visibleLayers&&(b.visibleLayers=d.visibleLayers);else if(-1<e.indexOf("/imageserver")&&(n.isDefined(d.minScale)&&!n.isDefined(b.minScale)&&(b.minScale=
d.minScale),n.isDefined(d.maxScale)&&!n.isDefined(b.maxScale)&&(b.maxScale=d.maxScale),n.isDefined(d.refreshInterval)&&!n.isDefined(b.refreshInterval)&&(b.refreshInterval=d.refreshInterval),d.popupInfo&&(!b.popupInfo&&!b.disablePopup)&&(b.popupInfo=d.popupInfo),d.renderingRule&&!b.renderingRule&&(b.renderingRule=d.renderingRule,d.renderingRule.functionName&&(b.renderingRule.rasterFunction=d.renderingRule.functionName)),d.bandIds&&!b.bandIds&&(b.bandIds=d.bandIds),d.mosaicRule&&!b.mosaicRule&&(b.mosaicRule=
d.mosaicRule),d.format&&!b.format&&(b.format=d.format),n.isDefined(d.compressionQuality)&&!n.isDefined(b.compressionQuality)&&(b.compressionQuality=d.compressionQuality),d.layerDefinition&&d.layerDefinition.definitionExpression&&(!n.isDefined(b.layerDefinition)||!n.isDefined(b.layerDefinition.definitionExpression))))b.layerDefinition=b.layerDefinition||{},b.layerDefinition.definitionExpression=d.layerDefinition.definitionExpression}});b.relatedItemsData=k;d.callback(b)})}else d.callback(b);return d}
function D(a,b){var c=new q,d=a.itemData,e=d.baseMap.baseMapLayers[0];if("BingMapsAerial"===e.type||"BingMapsRoad"===e.type||"BingMapsHybrid"===e.type)if(e.portalUrl&&m.id)delete b.bingMapsKey,m.id.checkSignInStatus(z.urlToObject(O.arcgisUrl).path).then(h.hitch(null,function(a,b,c,d,f){ba(e.portalUrl,f.token).then(h.hitch(null,K,a,b,c,d),h.hitch(null,G,a,b,c,d))},a,b,d,c),h.hitch(null,function(a,b,c,d,f){ba(e.portalUrl).then(h.hitch(null,K,a,b,c,d),h.hitch(null,G,a,b,c,d))},a,b,d,c));else if(b.bingMapsKey){var f=
new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL});t.connect(f,"onLoad",h.hitch(this,function(){c.callback([a,b])}));t.connect(f,"onError",function(f){delete b.bingMapsKey;a.itemData=H(d);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});c.callback([a,b])})}else a.itemData=H(d),e=a.itemData.baseMap.baseMapLayers[0],e.errors=[],e.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),
c.callback([a,b]);else c.callback([a,b]);return c}function Q(a){var b=new q,c,d;a=a.itemData;var e=a.baseMap&&a.baseMap.baseMapLayers;if(f("ie")||Ca&&!Ca.supported())for(a=0;a<e.length;a++){var g=e[a];if(!g.isReference){"VectorTileLayer"===g.layerType&&(c=g.itemId,d=a);break}}c?Da(c,!1).addBoth(function(a){var c=/^https?:\/\/basemaps(dev)?\.arcgis\.com\/arcgis\/rest\/services\/World_Basemap\/VectorTileServer/i;a&&(a.item&&c.test(a.item.url))&&(e[d]={id:"FB_"+g.id,layerType:"ArcGISTiledMapServiceLayer",
opacity:"opacity"in g?g.opacity:1,visibility:"visibility"in g?g.visibility:!0,url:"http://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer"});b.resolve()}):b.resolve();return b}function K(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL}),t.connect(e,"onLoad",h.hitch(this,function(){d.callback([a,b])})),t.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=H(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=
[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])})):G(a,b,c,d)}function G(a,b,c,d){delete b.bingMapsKey;a.itemData=H(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])}function H(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?
{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},
{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function W(a,b,c,d){var e=a.dynamicLayerInfos||a.layerInfos,f=b.layers;if(f&&e)if(d.usePopupManager){var h;g.forEach(e,function(a){var b=a.id;if(!a.subLayerIds)for(a=0;a<f.length;a++){var d=f[a];if(d.id===b&&d.popupInfo){h||(h={});h[b]={infoTemplate:new c(d.popupInfo),layerUrl:d.layerUrl};break}}});h&&
a.setInfoTemplates(h)}else{var k=[],l=[],m=[],q=[],p=[],r=[];g.forEach(e,function(b){var c=b.id;if(!b.subLayerIds&&-1!==g.indexOf(a.visibleLayers,c))for(b=0;b<f.length;b++){var d=f[b];if(d.id===c){l.push(c);k.push(d.popupInfo);m.push(d.layerUrl||"");d.layerDefinition&&d.layerDefinition.definitionExpression?q.push(d.layerDefinition.definitionExpression):q.push("");p.push(n.isDefined(d.minScale)?d.minScale:null);r.push(n.isDefined(d.maxScale)?d.maxScale:null);break}}});k.length&&(a.__popups=k,a.__popupIds=
l,a.__popupUrls=m,a.__popupWhereClauses=q,a.__popupMinScales=p,a.__popupMaxScales=r,a.__resourceInfo=b.resourceInfo)}}function I(a){if(!a)return!1;var b=(new w(O.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function X(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function L(a){if("https:"===location.protocol&&(I(a)||X(a)))a=a.replace("http:","https:");return a}function T(a,b,c){var d=[],e;a.displayLevels||
(d=g.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=h.clone(a.exclusionAreas),e=g.map(e,function(a){a.geometry=new v(a.geometry);return a}));d=new P(L(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});c.ignorePopups||W(d,a,b,c);return d}function ca(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=
[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function ea(a,b,c){var d=new Ya;d.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&(d.format="png32");var d=new Za(L(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,
visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var f="";g.forEach(d.layerInfos,function(a){a.defaultVisibility&&(f+=(0<f.length?",":"")+a.id)});e=f}if(a.layers&&0<a.layers.length){var k=[],n=[],l,m=[],q,p;g.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(k[b.id]=b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){l=
null;p=b.layerDefinition.source;if("mapLayer"===p.type){var c=g.filter(a.resourceInfo.layers,function(a){return a.id===p.mapLayerId});c.length&&(l=h.mixin(c[0],b))}else l=h.mixin({},b);l&&(l.source=p,delete l.popupInfo,l=new $a(l),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<g.indexOf(c,b.id)?l.defaultVisibility=!0:l.defaultVisibility=!1),n.push(l))}b.layerDefinition&&(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(q=new ab(b.layerDefinition.drawingInfo),
m[b.id]=q)},this);0<k.length&&d.setLayerDefinitions(k);0<n.length?(d.setDynamicLayerInfos(n,!0),0<m.length&&d.setLayerDrawingOptions(m,!0)):(e=ca(d.layerInfos,e),d.setVisibleLayers(e))}else e=ca(d.layerInfos,e),d.setVisibleLayers(e);c.ignorePopups||W(d,a,b,c);return d}function Aa(a,b,c){var d=new bb;d.bandIds=a.bandIds;null!=a.format&&(d.format=a.format,null!=a.compressionQuality&&(d.compressionQuality=a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var e=new cb(a.renderingRule);
d.renderingRule=e}a.mosaicRule&&(e=new db(a.mosaicRule),d.mosaicRule=e);n.isDefined(a.noData)&&(d.noData=a.noData);n.isDefined(a.noDataInterpretation)&&(d.noDataInterpretation=a.noDataInterpretation);n.isDefined(a.interpolation)&&(d.interpolation=a.interpolation);e=a.layerType?"ArcGISImageServiceVectorLayer"===a.layerType:!1;n.isDefined(a.layerType)||(e=a.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===a.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===
a.resourceInfo.serviceDataType));d={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval};d=e?new eb(L(a.url),d):new fb(L(a.url),d);a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(e=l.fromJson(a.layerDefinition.drawingInfo.renderer),d.setRenderer(e)),a.layerDefinition.definitionExpression&&d.setDefinitionExpression(a.layerDefinition.definitionExpression,
!0));!c.ignorePopups&&a.popupInfo&&d.setInfoTemplate(new b(a.popupInfo));return d}function $(a,c,d){var e=[102113,102100,3857],f=d||new b(c[0].layerObject.fullExtent.spatialReference),h=new b(a.resourceInfo.fullExtent.spatialReference);return f.wkt==h.wkt&&(f.wkid==h.wkid||n.isDefined(f.latestWkid)&&f.latestWkid==h.wkid||n.isDefined(h.latestWkid)&&f.wkid==h.latestWkid||n.isDefined(f.latestWkid)&&f.latestWkid==h.latestWkid)||f.wkid&&h.wkid&&g.some(e,function(a){return a===h.wkid})&&g.some(e,function(a){return a===
f.wkid})?!0:!1}function da(a,b,c){if(!b[0].layerObject.tileInfo)return!1;a=a.resourceInfo.tileInfo;b=b[0].layerObject.tileInfo;c=c.width>c.height?c.width:c.height;for(var d=!1,e=!1,f=0;f<a.lods.length;f++){for(var g=a.lods[f].scale/a.dpi,h=0;h<b.lods.length;h++){var k=b.lods[h].scale/b.dpi;if(Math.abs(k-g)/k<1/c)if(d){e=!0;break}else d=!0}if(e)break}return e||d&&(1===a.lods.length||1===b.lods.length)?!0:!1}function fa(a,c,f,k,q,r){var B,u=f._clazz;if("OpenStreetMap"===a.type)B=new gb({id:a.id,opacity:a.opacity,
visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var w=[],Xa=[];g.forEach(a.layers,function(a){Xa.push(new hb({name:a.name,title:a.title,legendURL:a.legendURL}));w.push(a.name)},this);a.visibleLayers&&(w=a.visibleLayers);k={extent:new v(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new b({wkid:4326})),layerInfos:Xa,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,
copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0,format:a.format};B=new ib(a.url,{id:a.id,visibleLayers:w,format:"png",transparent:a.firstLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:!0,resourceInfo:k,refreshInterval:a.refreshInterval});B.spatialReference.wkid=k.spatialReferences[0]}else if("KML"===a.type){f=a.url;if(m.id&&(u=m.id.findCredential(z.urlToObject(O.arcgisUrl).path))){var x=O.arcgisUrl.substring(O.arcgisUrl.indexOf("//")+2,O.arcgisUrl.indexOf("/",
O.arcgisUrl.indexOf("//")+3)),y=x.split("."),y=y[y.length-2]+"."+y[y.length-1];c=f.indexOf(y);-1<c&&(f="https://"+x+f.substring(c+y.length),f+="?token\x3d"+u.token)}B=new jb(f,{id:a.id,visible:null!==a.visibility?a.visibility:!0,outSR:k,refreshInterval:a.refreshInterval});t.connect(B,"onLoad",function(){(a.opacity||0===a.opacity)&&B.setOpacity(a.opacity);n.isDefined(a.minScale)&&n.isDefined(a.maxScale)&&B.setScaleRange(a.minScale,a.maxScale);a.visibleFolders&&g.forEach(B.folders,function(b){-1<g.indexOf(a.visibleFolders,
b.id)?B.setFolderVisibility(b,!0):B.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(B=new kb(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new v(a.fullExtent),initialExtent:a.fullExtent&&new v(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new lb(a.tileInfo):null,refreshInterval:a.refreshInterval}),t.connect(B,"onLoad",function(){(n.isDefined(a.minScale)||n.isDefined(a.maxScale))&&B.setScaleRange(a.minScale,
a.maxScale)})):"GeoRSS"===a.type?(B=new mb(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:k,refreshInterval:a.refreshInterval}),t.connect(B,"onLoad",function(){!1===a.visibility&&B.hide();n.isDefined(a.minScale)&&n.isDefined(a.maxScale)&&B.setScaleRange(a.minScale,a.maxScale);var b=B.getFeatureLayers();g.forEach(b,function(c){a.pointSymbol&&"esriGeometryPoint"===c.geometryType?(c.renderer.symbol=p.fromJson(a.pointSymbol),1===b.length&&(B.pointSymbol=p.fromJson(a.pointSymbol))):a.lineSymbol&&
"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=p.fromJson(a.lineSymbol),1===b.length&&(B.polylineSymbol=p.fromJson(a.lineSymbol))):a.polygonSymbol&&"esriGeometryPolygon"===c.geometryType&&(c.renderer.symbol=p.fromJson(a.polygonSymbol),1===b.length&&(B.polygonSymbol=p.fromJson(a.polygonSymbol)))})})):"CSV"==a.type&&a.url?(k={layerDefinition:a.layerDefinition,columnDelimiter:a.columnDelimiter,id:a.id?a.id:null,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},
a.locationInfo&&(k.latitudeFieldName=a.locationInfo.latitudeFieldName,k.longitudeFieldName=a.locationInfo.longitudeFieldName),f.ignorePopups||(k.infoTemplate=new s(a.popupInfo?a.popupInfo:nb.generateDefaultPopupInfo(a))),B=new ob(a.url,k)):"VectorTileLayer"===a.layerType&&a.styleUrl?B=new pb(a.styleUrl,{id:a.id,minScale:a.minScale,maxScale:a.maxScale,opacity:a.opacity,visible:a.visibility}):a.layerDefinition&&!a.url?(k=e.fromJson(e.toJson(a)),delete k.id,delete k.opacity,delete k.visibility,B=new M(k,
{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],autoGeneralize:!0}),!f.ignorePopups&&k.popupInfo&&B.setInfoTemplate(new u(k.popupInfo)),Ma(B)):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?f.bingMapsKey?(k=V.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?k=V.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(k=V.MAP_STYLE_ROAD),B=new V({bingMapsKey:f.bingMapsKey,mapStyle:k,opacity:a.opacity,id:a.id}),t.connect(B,"onError",h.hitch(this,function(a){a.errors=
a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?B=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||$(a,c,k)&&da(a,q,r))?T(a,u,f):ea(a,u,f):a.resourceInfo&&a.resourceInfo.pixelSizeX?
B=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||$(a,c,k)&&da(a,q,r))?T(a,u,f):Aa(a,u,f):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type?(a.capabilities&&(a.resourceInfo.capabilities=a.capabilities),B=new M(L(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:I(a.url)?M.MODE_AUTO:n.isDefined(a.mode)?a.mode:M.MODE_ONDEMAND,editable:!1===f.editable?!1:void 0,outFields:["*"],autoGeneralize:!0,refreshInterval:a.refreshInterval}),!f.ignorePopups&&a.popupInfo&&
B.setInfoTemplate(new u(a.popupInfo)),a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(k=l.fromJson(a.layerDefinition.drawingInfo.renderer),k.isMaxInclusive=!0,B.setRenderer(k)),a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo&&(k=g.map(a.layerDefinition.drawingInfo.labelingInfo,function(a){return new qb(a)}),B.setLabelingInfo(k)),a.layerDefinition.definitionExpression&&B.setDefinitionExpression(a.layerDefinition.definitionExpression),
n.isDefined(a.layerDefinition.minScale)&&B.setMinScale(a.layerDefinition.minScale),n.isDefined(a.layerDefinition.maxScale)&&B.setMaxScale(a.layerDefinition.maxScale)),Ma(B)):a.resourceInfo&&a.resourceInfo.streamUrls&&(k={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id},a.layerDefinition&&(y=a.layerDefinition.drawingInfo,a.layerDefinition.definitionGeometry&&(x=x||{},x.geometry=a.layerDefinition.definitionGeometry),n.isDefined(a.layerDefinition.definitionExpression)&&(x=
x||{},x.where=a.layerDefinition.definitionExpression),n.isDefined(a.layerDefinition.maximumTrackPoints)&&(k.maximumTrackPoints=a.layerDefinition.maximumTrackPoints)),x&&(k.filter=x),a.purgeOptions&&(k.purgeOptions=a.purgeOptions),B=new rb(L(a.url),k),y&&y.renderer&&(k=y.renderer,B.setRenderer(l.fromJson(k))),!f.ignorePopups&&a.popupInfo&&B.setInfoTemplate(new u(a.popupInfo)),a.layerDefinition&&(n.isDefined(a.layerDefinition.minScale)&&B.setMinScale(a.layerDefinition.minScale),n.isDefined(a.layerDefinition.maxScale)&&
B.setMaxScale(a.layerDefinition.maxScale)),d.once(B,"error",function(b){a.errors.push({message:"Error loading stream layer. Check websocket url"})}));B&&(B.arcgisProps={title:a.title},a.baseMapLayer&&(a.isReference?(B.attr("data-reference",!0),B._basemapGalleryLayerType="reference"):B._basemapGalleryLayerType="basemap"));return B}function J(a,b,c,d,e){g.forEach(a,function(f){f.layerObject=fa(f,a,b,c,d,e)});var f=g.filter(a,function(a){return!a.isReference}),h=g.filter(a,function(a){return!!a.isReference});
return a=f.concat(h)}function aa(a){var c=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(c=new b,a.resourceInfo.spatialReference.wkid&&(c.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(c.wkt=a.resourceInfo.spatialReference.wkt)):a.type&&(-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?c=new b({wkid:102100}):"WMS"==a.type&&(c=new b({wkid:a.spatialReferences[0]})));return c}function La(a,b,c,d,e,f,h,k){g.forEach(b,function(b){b.url&&!b.type&&(b.resourceInfo=
a[b.deferredsPos][1],delete b.deferredsPos)});f=f||aa(b);b=J(b,c,f,h,k);e.callback(b);return e}function Ma(a){!window.CanvasRenderingContext2D&&(a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass)&&a.setRenderer(l.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:0.75,type:"esriSLS",style:"esriSLSSolid"}}}))}function Na(a,b){var c=L(a);return A({url:c,content:{f:"json"},
callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);x.defaults.io.errorHandler(a,d)}})}function Oa(a){var b=O.arcgisUrl+"/"+a.itemId+"/data";return A({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);x.defaults.io.errorHandler(c,d)}})}function Pa(a,b,c){var d=new q;if((!c.featureCollection||!c.featureCollection.layers)&&
!c.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),d.errback(),d;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,n.isDefined(c.showLegend)&&(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));Qa(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?g.forEach(c.featureCollection.layers,
function(b,c){var d=a.featureCollection.layers[c];if(!d.poupInfo&&!d.layerDefinition)d.popupInfo=b.popupInfo,d.layerDefinition=b.layerDefinition;else if(d.layerDefinition){if(n.isDefined(d.layerDefinition.minScale)&&n.isDefined(d.layerDefinition.maxScale)&&(d.layerDefinition.minScale!==b.layerDefinition.minScale||d.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minscale,delete b.layerDefinition.maxScale;d.layerDefinition.drawingInfo&&e.toJson(d.layerDefinition.drawingInfo)!==
e.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;d.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;d.layerDefinition=h.mixin(d.layerDefinition,b.layerDefinition)}else d.layerDefinition=b.layerDefinition;d.featureSet=b.featureSet;d.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=h.mixin(a.featureCollection,c.featureCollection));d.callback(a)});return d}function Qa(b,c,d){var e=
new q;r(["./csv"],function(f){var h=[];g.forEach(c.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=h.length,h.push(f.projectFeatureCollection(a,d,a.featureSet.features[0].geometry.spatialReference)))});(new a(h)).addCallback(function(){g.forEach(c.layers,function(a){n.isDefined(a.deferredsPos)&&(h[a.deferredsPos].results&&h[a.deferredsPos].results.length?a=
h[a.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+b.title+" - "+a.layerDefinition.name+"]"),a.errors=a.errors||[],a.errors.push({message:"Errors projecting feature collection. ["+b.title+" - "+a.layerDefinition.name+"]"})),delete a.deferredsPos)});e.callback(c)})});return e}function ga(b,c,e,f,k){var l=new q,n=new q,m=[],p;g.forEach(b.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&m.push(Oa(a).then(h.hitch(null,Pa,a,e)))});0===m.length?Ra(b,
c,e,f,n,k):(p=new a(m),p.addCallback(function(a){Ra(b,c,e,f,n,k)}));n.then(function(b){m=[];g.forEach(b,function(a){a=a.layerObject;if(a instanceof M&&!a.loaded&&!a.loadError){var b=new q;d.once(a,"load, error",function(){b.callback(a)});m.push(b)}});if(m.length){var c=new q;p=new a(m);p.addCallback(function(){c.callback(b)});return c.promise}return b}).then(function(a){var b=[];g.forEach(a,function(a){if(a.layerObject instanceof M){var c=a.layerObject;c.loaded&&(c.labelingInfo&&(a.showLabels||c._collection))&&
b.push(c)}});b.length?r(["../layers/LabelLayer"],function(c){var d=new c;g.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});l.callback(a)}):l.callback(a)});return l}function Ra(b,c,d,e,f,h){var k=[],l=[],n=[];g.forEach(b.operationalLayers,function(a,b){if(a.featureCollection&&a.featureCollection.layers){var c=a.featureCollection.layers.length;g.forEach(a.featureCollection.layers,function(d,e){var f=!0;a.visibleLayers&&-1==g.indexOf(a.visibleLayers,e)&&(f=!1);d.visibility=a.visibility&&
f;d.opacity=a.opacity;d.id=(a.id||"operational"+b)+"_"+e;a.title&&(d.title=1===c||!d.layerDefinition.name||a.title===d.layerDefinition.name?a.title:a.title+" - "+d.layerDefinition.name);n.push(d)},this)}else n.push(a)});g.forEach(b.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;k.push(a)});g.forEach(n,function(a,b){a.id=a.id||"operational"+b;k.push(a)});g.forEach(k,function(a){a.url&&!a.type&&(a.deferredsPos=l.length,a.errors=a.errors||[],l.push(Na(a.url,a.errors)))});0===
l.length?(d=d||aa(k),k=J(k,c,d,e,h),f.callback(k)):(new a(l)).addCallback(function(a){La(a,k,c,l,f,d,e,h)});return f}function ha(a,b,c,d){var e=a.minScale,f=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&(e=Math.min(e,b[a].minScale)),f=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,f),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(g.forEach(a.layerInfos,
function(a){a.id==d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),f=Math.max(f||0,a.maxScale||0))}),c.setScaleRange(e,f))}function ia(a,b,c,d){var e=a.url,f=a.__popupIds,k=a.__popupUrls,l=a.__popupWhereClauses,m=a.__popupMinScales,p=a.__popupMaxScales,q=a.__resourceInfo,r=[];g.forEach(a.__popups,function(d,h){if(d){var s,u=[];g.forEach(d.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<
a.dynamicLayerInfos.length){var v=g.filter(a.dynamicLayerInfos,function(a){return f[h]==a.id})[0].source;s=new M(e+"/dynamicLayer",{id:a.id+"_"+f[h],source:v,outFields:u,mode:M.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,autoGeneralize:!0});var w=function(c,d){0<l[c].length&&d.setDefinitionExpression(l[c]);if(!n.isDefined(m[c])&&!n.isDefined(p[c]))ha(a,b||q.layers,d,f[c]);else if(n.isDefined(a.minScale)||n.isDefined(a.maxScale)){var e=a.minScale,g=a.maxScale;0==e&&0<m[c]?
e=m[c]:0<e&&0==m[c]||0<e&&0<m[c]&&(e=Math.min(e,m[c]));g=Math.max(g||0,p[c]||0);d.setScaleRange(e,g)}else d.setScaleRange(m[c],p[c])};s.loaded?w(h,s):t.connect(s,"onLoad",function(a){w(h,s)})}else{var x=null,y=e+"/"+f[h];if(k[h].length)y=k[h];else if(b)for(v=0;v<b.length;v++)if(b[v].id===f[h]){x=b[v];break}s=new M(L(y),{id:a.id+"_"+f[h],outFields:u,mode:M.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,resourceInfo:x,autoGeneralize:!0});s.loaded?(0<l[h].length&&s.setDefinitionExpression(l[h]),
ha(a,b||q.layers,s,f[h])):t.connect(s,"onLoad",function(c){0<l[h].length&&s.setDefinitionExpression(l[h]);ha(a,b||q.layers,c,f[h])})}r.push(s)}});0<r.length&&(t.connect(a,"onVisibilityChange",h.hitch(this,function(a,b){g.forEach(a,function(a){b?a.show():a.hide()})},r)),t.connect(d,"onLayerRemove",h.hitch(this,function(a,b,c){a.id===c.id&&g.forEach(b,function(a){d.removeLayer(a)})},a,r)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;
delete a.__popupMaxScales;delete a.__resourceInfo;return r}function Sa(a){return A({url:L(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Ta(b,c,d){var e=[];g.forEach(b,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=e.length,e.push(Sa(a)))});var f=[];0<e.length?(new a(e)).addCallback(function(a){g.forEach(b,function(b){b.__popups&&0<b.__popups.length&&(b.__deferredsPos||0===b.__deferredsPos?(f=f.concat(ia(b,a[b.__deferredsPos][1].layers,
d,c)),delete b.__deferredsPos):f=f.concat(ia(b,null,d,c)))});c.addLayers(f)}):(g.forEach(b,function(a){a.__popups&&0<a.__popups.length&&(f=f.concat(ia(a,null,d,c)))}),c.addLayers(f))}function Ua(a){g.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&(b.name&&-1<b.name.indexOf("Text"))&&g.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);
d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Va(a){var b=6;g.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&g.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&
(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function Ba(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var e=[];g.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&a instanceof M&&a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a)});g.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;
if(e.length||d){var f=Va(e),h=a.screenPoint,k=b.toMap(new u(h.x-f,h.y+f)),f=b.toMap(new u(h.x+f,h.y-f)),k=new v(k.x,k.y,f.x,f.y,b.spatialReference),l=new N;l.geometry=k;l.timeExtent=b.timeExtent;var n=!0,k=g.map(e,function(b){var c;-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(l.geometry=a.mapPoint,n=!1,c=b.queryVisibleRasters(l,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(l),c.addCallback(function(){return b.getSelectedFeatures()}));
return c});d&&(f=new q,f.callback([d]),k.splice(0,0,f));if(!g.some(k,function(a){return-1===a.fired})){var m=d?1:0;g.forEach(e,function(a){m=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?m+a.getVisibleRasters().length:m+a.getSelectedFeatures().length});if(!m)return}c.setFeatures(k);c.show(a.mapPoint,{closestFirst:n})}}}function ub(a,b){var d=b.mapOptions||{},e;d.infoWindow||(e=new U({visibleWhenEmpty:!1},c.create("div")),d.infoWindow=e);!n.isDefined(d.showInfoWindowOnClick)&&!b.usePopupManager&&
(d.showInfoWindowOnClick=!1);d=new k(a,d);t.connect(d,"onLayersAddResult",Ua);return d}function Y(a,b,c,d,e,f){var h,k,l,n;d.map?(h=d.map,k=d.clickEventHandle,l=d.clickEventListener,n=d.errors):(h=ub(d,e),!e.ignorePopups&&(!e.disableClickBehavior&&!e.usePopupManager)&&(k=t.connect(h,"onClick",Ba),l=Ba));h.addLayers(a);!e.ignorePopups&&!e.usePopupManager&&Ta(a,h,e._clazz);var m=n||[];g.forEach(b,function(a){a.errors&&(m=m.concat(a.errors))},this);h.loaded?f.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,
clickEventListener:l}):t.connect(h,"onLoad",function(){f.callback({map:h,itemInfo:c,errors:m,clickEventHandle:k,clickEventListener:l})})}function ja(a,b,c,d,e){var f=[];g.forEach(e,function(a){h.isArray(a.layerObject)?g.forEach(a.layerObject,function(a){f.push(a)}):f.push(a.layerObject)});if("BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var k=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(k),Wa(a,b,c,d,e,f);else if(e[0].errors){clearInterval(k);
var g="";e[0].errors&&e[0].errors.length&&(g=" ("+e[0].errors[0].message+")");d.errback(Error(R.arcgis.utils.baseLayerError+g))}},10);else if(!f[0]&&e[0].baseMapLayer){var l="";e[0].errors&&e[0].errors.length&&(l=" ("+e[0].errors[0].message+")");d.errback(Error(R.arcgis.utils.baseLayerError+l))}else Wa(a,b,c,d,e,f)}function Wa(a,c,d,e,f,h){try{var k=d.mapOptions||{};d.mapOptions=k;var l=a.item;h=g.filter(h,n.isDefined);if(l)if(l.extent&&l.extent.length)if(k.extent)Y(h,f,a,c,d,e);else{var m=new v(l.extent[0][0],
l.extent[0][1],l.extent[1][0],l.extent[1][1],new b({wkid:4326})),p=h[0].spatialReference;4326===p.wkid?(k.extent=m,Y(h,f,a,c,d,e)):102100===p.wkid||102113===p.wkid||3857===p.wkid?(m.xmin=Math.max(m.xmin,-180),m.xmax=Math.min(m.xmax,180),m.ymin=Math.max(m.ymin,-89.99),m.ymax=Math.min(m.ymax,89.99),k.extent=y.geographicToWebMercator(m),Y(h,f,a,c,d,e)):d.geometryServiceURL||x.defaults.geometryService?(d.geometryServiceURL?new C(d.geometryServiceURL):x.defaults.geometryService).project([m],p,function(b){b=
b[0];k.extent=k.extent||b;Y(h,f,a,c,d,e)},function(){Y(h,f,a,c,d,e)}):e.errback(Error(R.arcgis.utils.geometryServiceError))}else Y(h,f,a,c,d,e);else Y(h,f,a,c,d,e)}catch(q){e.errback(q)}}function vb(a){var b=[];g.forEach(a.operationalLayers,function(a){a.featureCollection?b.push({featureCollection:a.featureCollection,visibility:a.visibility,title:a.title}):a.layerObject&&b.push({layer:a.layerObject,visibility:a.visibility,title:a.title})});return b}function sb(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);
g.forEach(a,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&g.forEach(a.featureCollection.layers,function(d){if(!1!==d.showLegend){var e=d.layerObject.renderer;c={layer:d.layerObject,title:a.title,defaultSymbol:e&&e.defaultSymbol&&e.defaultLabel?!0:!1};1<a.featureCollection.layers.length&&(c.title+=" - "+d.layerDefinition.name);b.push(c)}});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject&&
!(a.layerObject instanceof M&&a.layerObject.mode===M.MODE_SELECTION)){var d=a.layerObject.renderer,e=a.layerObject.declaredClass,d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===e||"esri.layers.ArcGISTiledMapServiceLayer"===e)||"esri.layers.ArcGISImageServiceLayer"===e)d=!0;c={layer:a.layerObject,title:a.title,defaultSymbol:d};a.layers&&(e=g.map(g.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),
e.length&&(c.hideLayers=e));b.push(c)}});return b}function wb(a,b){function c(a,b){g.forEach(a,function(a,c){switch(a){case ka:Za=b[c];break;case la:fb=b[c];break;case ma:eb=b[c];break;case Ea:nb=b[c];break;case na:ob=b[c];break;case Fa:$a=b[c];break;case oa:mb=b[c];break;case Ga:Ya=b[c];break;case pa:bb=b[c];break;case qa:jb=b[c];break;case ra:qb=b[c];break;case Ha:ab=b[c];break;case sa:db=b[c];break;case ta:gb=b[c];break;case ua:cb=b[c];break;case va:rb=b[c];break;case Ia:lb=b[c];break;case Ja:Ca=
b[c];break;case wa:pb=b[c];break;case xa:V=b[c];break;case ya:kb=b[c];break;case za:ib=b[c];break;case Ka:hb=b[c]}})}var d=new q,e=a.itemData,h=[];e.baseMap&&e.baseMap.baseMapLayers&&(h=h.concat(e.baseMap.baseMapLayers));e.operationalLayers&&(h=h.concat(e.operationalLayers));for(var e=g.map(h,function(a){return a&&a.layerType}),k=[],l=[],h=!1,m=0;m<e.length;m++){switch(e[m]){case "ArcGISFeatureLayer":-1===g.indexOf(k,ra)&&k.push(ra);break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===
g.indexOf(k,la)&&(k.push(la),l.push(pa),l.push(sa),l.push(ua));break;case "ArcGISImageServiceVectorLayer":-1===g.indexOf(k,ma)&&(k.push(ma),l.push(pa),l.push(sa),l.push(ua));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===g.indexOf(k,ka)&&(k.push(ka),l.push(Fa),l.push(Ga),l.push(Ha));break;case "ArcGISStreamLayer":-1===g.indexOf(k,va)&&k.push(va);break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===g.indexOf(k,xa)&&k.push(xa);break;case "CSV":-1===g.indexOf(k,
na)&&(k.push(na),l.push(Ea));break;case "GeoRSS":-1===g.indexOf(k,oa)&&k.push(oa);break;case "KML":-1===g.indexOf(k,qa)&&k.push(qa);break;case "OpenStreetMap":-1===g.indexOf(k,ta)&&k.push(ta);break;case "VectorTileLayer":-1===g.indexOf(k,wa)&&(k.push(wa),f("ie")||l.push(Ja));break;case "WebTiledLayer":-1===g.indexOf(k,ya)&&(k.push(ya),l.push(Ia));break;case "WMS":-1===g.indexOf(k,za)&&(k.push(za),l.push(Ka));break;default:h=!0}if(h)break}h&&(k=xb,l=yb);k.length?r(k,function(){c(k,arguments);l.length?
r(l,function(){c(l,arguments);d.resolve()}):d.resolve()}):d.resolve();return d}function tb(a,b,c,d){var e=d.itemData;e.baseMap&&(e.baseMap.baseMapLayers&&e.baseMap.baseMapLayers.length)&&(e.baseMap.baseMapLayers[0].firstLayer=!0);var f=b.layerMixins,k=f&&f.length;if(k){var l=function(a){for(var b=0;b<k;b++){var c=f[b];if(c.mixin)if(c.hasOwnProperty("id")){if(a.id===c.id){h.mixin(a,c.mixin);break}}else if(a.url===c.url){h.mixin(a,c.mixin);break}}};g.forEach(e.baseMap&&e.baseMap.baseMapLayers,l);g.forEach(e.operationalLayers,
l)}wb(d,b).then(function(){return Q(d,b)}).then(function(){return D(d,b)}).then(function(b){var d=b[0],e=b[1];if(!d.itemData.operationalLayers||0===d.itemData.operationalLayers.length)F(d,e).addCallback(function(b){ga(b.itemData,e).addCallback(h.hitch(null,ja,b,a,e,c))});else{var f=new q,k=d.itemData.baseMap.baseMapLayers.slice(),l=g.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:l}}};d.itemData.baseMap.baseMapLayers=g.filter(d.itemData.baseMap.baseMapLayers,
function(a){return a.isReference});F(b,e).addCallback(function(b){ga(b.itemData,e).addCallback(h.hitch(null,ja,b,a,e,f))});f.then(function(a){F(d,e).addCallback(function(b){ga(b.itemData,e,a.map.spatialReference,l,a.map).addCallback(function(d){b.itemData.baseMap.baseMapLayers=k;ja(b,a,e,c,d)})})},h.hitch(c,c.errback))}})}function Da(a,b){"undefined"===typeof b&&(b=!0);O._arcgisUrl&&0<O._arcgisUrl.length&&(O.arcgisUrl=O._arcgisUrl);var c=O.arcgisUrl+"/"+a,d={},e=new q;A({url:c,content:{f:"json"},
callbackParamName:"callback",load:function(a){d.item=a;b?A({url:c+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){d.itemData=a;e.callback(d)},error:function(a){e.errback(a)}}):e.callback(d)},error:function(a){e.errback(a)}});return e}var O,Za,fb,eb,nb,ob,$a,mb,Ya,bb,jb,qb,ab,db,gb,cb,rb,lb,Ca,pb,V,kb,ib,hb,ka="../layers/ArcGISDynamicMapServiceLayer",la="../layers/ArcGISImageServiceLayer",ma="../layers/ArcGISImageServiceVectorLayer",Ea="./csv",na="../layers/CSVLayer",Fa="../layers/DynamicLayerInfo",
oa="../layers/GeoRSSLayer",Ga="../layers/ImageParameters",pa="../layers/ImageServiceParameters",qa="../layers/KMLLayer",ra="../layers/LabelClass",Ha="../layers/LayerDrawingOptions",sa="../layers/MosaicRule",ta="../layers/OpenStreetMapLayer",ua="../layers/RasterFunction",va="../layers/StreamLayer",Ia="../layers/TileInfo",Ja="../layers/vector-tile",wa="../layers/VectorTileLayer",xa="../virtualearth/VETiledLayer",ya="../layers/WebTiledLayer",za="../layers/WMSLayer",Ka="../layers/WMSLayerInfo",xb=[ka,
la,ma,na,oa,qa,ra,ta,va,wa,xa,ya,za],yb=[Ea,Fa,Ga,pa,Ha,sa,ua,Ia,Ja,Ka];O={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:Da,createMap:function(a,b,c){var d=new q;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(h.isObject(e)?e:h.getObject(e))||s;h.isString(a)?Da(a).addCallback(h.hitch(null,tb,b,c,d)).addErrback(h.hitch(d,d.errback)):tb(b,c,d,a);return d},getLayerList:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?vb(a.itemInfo.itemData):[]},getLegendLayers:function(a){return a&&
a.itemInfo&&a.itemInfo.itemData?sb(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:F,_getItemData:S,_getBingKey:ba,_portalUrlResponse:K,_portalUrlFailure:G,_processFSItemProperties:Z,_processSSItemProperties:E,_getLayers:ga,_preBuildLayerObjects:La,_buildLayerObjects:J,_preCreateMap:ja,_getMapSR:aa,_createMap:Y,_addSelectionLayers:Ta,_createSelectionFeatureLayers:ia,_getServiceInfo:Na,_getFeatureCollectionItem:Oa,_mergeFeatureCollectionItem:Pa,_projectFeatureCollection:Qa,_getLayersInfo:Sa,
_initLayer:fa,_loadAsCached:T,_loadAsDynamic:ea,_processPopups:W,_onLayersAddResult:Ua,_sameSpatialReferenceAsBasemap:$,_sameTilingSchemeAsBasemap:da,_showPopup:Ba,_calculateClickTolerance:Va,_getVisibleFeatureLayers:ca,_updateLayerScaleInfo:ha,_checkUrl:L,_isHostedService:I,_isAgolService:X,_getLegendLayers:sb};h.setObject("arcgis.utils",O,m);return O});