// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.16/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(l,m,k,c,h,f,g){var a={_isElementShown:function(a){var g=c.get(a);return"hidden"!=g.visibility&&"collapsed"!=g.visibility&&"none"!=g.display&&"hidden"!=k.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return k.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;
case "iframe":var g;try{var c=a.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;g=c.body}catch(f){try{g=a.contentWindow.document.body}catch(h){return!1}}return g&&("true"==g.contentEditable||g.firstChild&&"true"==g.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(b){return k.get(b,"disabled")?void 0:k.has(b,"tabIndex")?+k.get(b,"tabIndex"):a.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=a.effectiveTabIndex(b)},
isFocusable:function(b){return-1<=a.effectiveTabIndex(b)},_getTabNavigable:function(b){function g(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var c,h,l,d,p,m,y={},z=a._isElementShown,B=a.effectiveTabIndex,t=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=f("ie")&&"HTML"!==a.scopeName||!z(a))){var b=B(a);if(0<=b){if(0==b)c||(c=a),h=a;else if(0<b){if(!l||b<d)d=b,l=a;if(!p||b>=m)m=b,p=a}b=g(a);k.get(a,"checked")&&
b&&(y[b]=a)}"SELECT"!=a.nodeName.toUpperCase()&&t(a)}};z(b)&&t(b);return{first:y[g(c)]||c,last:y[g(h)]||h,lowest:y[g(l)]||l,highest:y[g(p)]||p}},getFirstInTabbingOrder:function(b,g){var c=a._getTabNavigable(m.byId(b,g));return c.lowest?c.lowest:c.first},getLastInTabbingOrder:function(b,g){var c=a._getTabNavigable(m.byId(b,g));return c.last?c.last:c.highest}};h.mixin(g,a);return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(l,m,k,c){function h(a){if((a.keyCode===
l.ENTER||a.keyCode===l.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=a.parentNode)if(a.dojoClick)return!0}var f;k(document,"keydown",function(a){h(a)?(f=a.target,a.preventDefault()):f=null});k(document,"keyup",function(a){h(a)&&a.target==f&&(f=null,k.emit(a.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,altKey:a.altKey,_origType:a.type}))});var g=function(a,b){a.dojoClick=!0;return k(a,"click",b)};g.click=g;g.press=function(a,
b){var g=k(a,c.press,function(a){("mousedown"!=a.type||m.isLeft(a))&&b(a)}),h=k(a,"keydown",function(a){(a.keyCode===l.ENTER||a.keyCode===l.SPACE)&&b(a)});return{remove:function(){g.remove();h.remove()}}};g.release=function(a,b){var g=k(a,c.release,function(a){("mouseup"!=a.type||m.isLeft(a))&&b(a)}),h=k(a,"keyup",function(a){(a.keyCode===l.ENTER||a.keyCode===l.SPACE)&&b(a)});return{remove:function(){g.remove();h.remove()}}};g.move=c.move;return g})},"dijit/hccss":function(){define(["dojo/dom-class",
"dojo/hccss","dojo/domReady","dojo/_base/window"],function(l,m,k,c){k(function(){m("highcontrast")&&l.add(c.body(),"dijit_a11y")});return m})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(l,m,k){return k("dijit.Destroyable",null,{destroy:function(c){this._destroyed=!0},own:function(){var c=["destroyRecursive","destroy","remove"];l.forEach(arguments,function(h){function f(){a.remove();l.forEach(b,function(a){a.remove()})}var g,a=m.before(this,
"destroy",function(a){h[g](a)}),b=[];h.then?(g="cancel",h.then(f,f)):l.forEach(c,function(a){"function"===typeof h[a]&&(g||(g=a),b.push(m.after(h,a,f,!0)))})},this);return arguments}})})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(l,m,k,c,h,f){return l([f,h],{_onMap:function(g){var a=this.constructor._onMap,b;if(!a||!a.FINAL)delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=
!0;g=g.toLowerCase();a[g]?b=this[a[g].method]:(g=this._onCamelCase(g),this[g]&&(b=g));return b},on:function(g,a){var b=this._onMap(g),h=g.replace(/\-/g,""),f="on"+h in this.domNode;return b||!f?this.inherited(arguments):this.own(c(this.domNode,h,a))[0]},emit:function(g,a,b){var c,h,f,k=g.toLowerCase(),d=this.constructor._onMap||this.registerConnectEvents();h=this[this._onMap(k)];a=a||{};a.target||(a.target=this);h&&(d&&d[k])&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},d[k].argKeys)(a),
f=m.mixin({},arguments),f[2]=c,f[0]=d[k].name.replace(/^on/,""));return this.inherited(f||arguments)}})})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(l){var m=l.getObject("dojox.html.entities",!0),k=function(c,f){var g,a;if(f._encCache&&f._encCache.regexp&&f._encCache.mapper&&f.length==f._encCache.length)g=f._encCache.mapper,a=f._encCache.regexp;else{g={};a=["["];var b;for(b=0;b<f.length;b++)g[f[b][0]]="\x26"+f[b][1]+";",a.push(f[b][0]);a.push("]");a=RegExp(a.join(""),"g");
f._encCache={mapper:g,regexp:a,length:f.length}}return c=c.replace(a,function(a){return g[a]})},c=function(c,f){var g,a;if(f._decCache&&f._decCache.regexp&&f._decCache.mapper&&f.length==f._decCache.length)g=f._decCache.mapper,a=f._decCache.regexp;else{g={};a=["("];var b;for(b=0;b<f.length;b++){var k="\x26"+f[b][1]+";";b&&a.push("|");g[k]=f[b][0];a.push(k)}a.push(")");a=RegExp(a.join(""),"g");f._decCache={mapper:g,regexp:a,length:f.length}}return c=c.replace(a,function(a){return g[a]})};m.html=[["\x26",
"amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7",
"middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],
["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],
["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396",
"Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba",
"kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],
["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e",
"infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329",
"lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d",
"rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];m.encode=function(c,f){c&&(f?c=k(c,f):(c=k(c,m.html),c=k(c,m.latin)));return c};m.decode=function(k,f){k&&(f?k=c(k,f):(k=c(k,m.html),k=c(k,m.latin)));return k};return m})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(l,m,k,c,h,f,g,a,b,s,x,L,r){function d(){}function p(a){return function(b,c,f,h){return b&&"string"==typeof c&&b[c]==d?b.on(c.substring(2).toLowerCase(),g.hitch(f,h)):a.apply(k,arguments)}}l.around(k,"connect",p);f.connect&&l.around(f,"connect",p);l=c("dijit._Widget",[x,L,r],{onClick:d,onDblClick:d,onKeyDown:d,onKeyPress:d,onKeyUp:d,onMouseDown:d,onMouseMove:d,onMouseOut:d,onMouseOver:d,onMouseLeave:d,onMouseEnter:d,onMouseUp:d,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
d&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===d?k.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(s.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});h("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});
return l})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(l,m,k,c,h,f,g,a,b,s,x,L,r,d,p,v,y,z,B,t,D,I,J){function K(b){return function(c){a[c?
"set":"remove"](this.domNode,b,c);this._set(b,c)}}r.add("dijit-legacy-requires",!d.isAsync);r.add("dojo-bidi",!1);r("dijit-legacy-requires")&&y(0,function(){l(["dijit/_base/manager"])});var G={};c=f("dijit._WidgetBase",[z,D],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:K("lang"),dir:"",_setDirAttr:K("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",
a)},attributeMap:{},_blankGif:c.blankGif||l.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();
this.srcNodeRef=g.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,p.mixin(this,a));this.postMixInProperties();this.id||(this.id=J.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=t.body(this.ownerDocument);J.add(this);this.buildRendering();
var d;if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&(c.parentNode&&this.domNode!==c)&&(c.parentNode.replaceChild(this.domNode,c),d=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();d&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);m.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(m.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,m.forEach(this.getChildren(),function(a){!a._started&&(!a._destroyed&&p.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();m.forEach(this._connects,p.hitch(this,"disconnect"));m.forEach(this._supportingWidgets,b);this.domNode&&m.forEach(J.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);J.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?a.remove(this.domNode,"widgetId"):s.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||s.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){m.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;p.isObject(a)?L.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(c,d,g){g=3<=
arguments.length?g:this.attributeMap[c];m.forEach(p.isArray(g)?g:[g],function(g){var f=this[g.node||g||"domNode"];switch(g.type||"attribute"){case "attribute":p.isFunction(d)&&(d=p.hitch(this,d));g=g.attribute?g.attribute:/^on[A-Z][a-zA-Z]*$/.test(c)?c.toLowerCase():c;f.tagName?a.set(f,g,d):f.set(g,d);break;case "innerText":f.innerHTML="";f.appendChild(this.ownerDocument.createTextNode(d));break;case "innerHTML":f.innerHTML=d;break;case "class":b.replace(f,d,this[c])}},this)},get:function(a){var b=
this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(p.isFunction(d))var g=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!p.isFunction(this.focusNode)?"focusNode":"domNode",f=this[d]&&this[d].tagName,k;if(k=f)if(!(k=G[f])){k=this[d];var h={},I;for(I in k)h[I.toLowerCase()]=!0;k=G[f]=h}I=k;c=a in this.attributeMap?this.attributeMap[a]:
c.s in this?this[c.s]:I&&c.l in I&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return g||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==
b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var d,g=this["on"+a];g&&(d=g.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&v.emit(this.domNode,a.toLowerCase(),b);return d},on:function(a,b){var c=this._onMap(a);return c?k.after(this,c,b,
!0):this.own(v(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?J.findWidgets(this.containerNode):[]},getParent:function(){return J.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,
b,c){return this.own(h.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(B.subscribe(a,p.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():x.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=L.get(this.domNode,"display")},placeAt:function(a,b){var c=!a.tagName&&J.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c&&"domNode"in
c?c.containerNode&&!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:g.byId(a,this.ownerDocument),s.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(p.hitch(this,function(){c&&(c=null,this._destroyed||p.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});r("dojo-bidi")&&c.extend(I);return c})},"dojo/debounce":function(){define([],function(){return function(l,
m){var k;return function(){k&&clearTimeout(k);var c=this,h=arguments;k=setTimeout(function(){l.apply(c,h)},m)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(l,m,k,c){var h=function(c,a){return c-a},f={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var a=String(c),b=a.match(f._reNumber);c={integer:0,fractional:0};b&&b[1]?(c.integer=b[1].split("").length,c.fractional=b[3]?b[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&
(b=a.split("e"),a=b[0],b=b[1],a&&b&&(a=Number(a),b=Number(b),(c=0<b)||(b=Math.abs(b)),a=f.getDigits(a),c?(a.integer+=b,a.fractional=b>a.fractional?0:a.fractional-b):(a.fractional+=b,a.integer=b>a.integer?1:a.integer-b),c=a));return c},getFixedNumbers:function(c,a){var b,f;b=Number(c.toFixed(a));b<c?f=b+1/Math.pow(10,a):(f=b,b-=1/Math.pow(10,a));b=Number(b.toFixed(a));f=Number(f.toFixed(a));return[b,f]},getPctChange:function(c,a,b,f){var k={prev:null,next:null},h;null!=b&&(h=c-b,b=a-b-h,k.prev=Math.floor(Math.abs(100*
b/h)));null!=f&&(h=f-c,b=f-a-h,k.next=Math.floor(Math.abs(100*b/h)));return k},round:function(c,a){var b=c.slice(0),k,l,m,r,d,p,v,y,z,B=!a||null==a.tolerance?2:a.tolerance,t=a&&a.indexes,D=!a||null==a.strictBounds?!1:a.strictBounds;if(t)t.sort(h);else{t=[];for(p=0;p<b.length;p++)t.push(p)}for(p=0;p<t.length;p++)if(z=t[p],k=b[z],l=0===z?null:b[z-1],m=z===b.length-1?null:b[z+1],r=f.getDigits(k),r=r.fractional){v=0;for(y=!1;v<=r&&!y;)d=f.getFixedNumbers(k,v),d=D&&0===p?d[1]:d[0],y=f.hasMinimalChange(k,
d,l,m,B),v++;y&&(b[z]=d)}return b},hasMinimalChange:function(c,a,b,k,h){c=f.getPctChange(c,a,b,k);a=null==c.prev||c.prev<=h;b=null==c.next||c.next<=h;return a&&b||c.prev+c.next<=2*h},_reAllZeros:RegExp("\\"+k.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(c,a){a=a||{places:20,round:-1};var b=m.format(c,a);b&&(b=b.replace(f._reSomeZeros,"$1").replace(f._reAllZeros,""));return b}};l("extend-esri")&&(c.numberUtils=f);return f})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(l,m,k,c){c.extend(m,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return k("dijit._FocusMixin",null,{_focusManager:l})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(l,m,k,c,h,f,g,a,b,s,x,L,r,d,p,v,y){var z,B,t=new (m([L,g],{curNode:null,activeStack:[],constructor:function(){var b=a.hitch(this,function(a){k.isDescendant(this.curNode,a)&&this.set("curNode",null);k.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});l.before(f,"empty",b);l.before(f,"destroy",b)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var d=this,f=a.document&&a.document.body;if(f){var g=x("pointer-events")?"pointerdown":x("MSPointer")?
"MSPointerDown":x("touch-events")?"mousedown, touchstart":"mousedown",k=b(a.document,g,function(a){if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),h=b(f,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(p.isFocusable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),l=b(f,"focusout",function(a){d._onBlurNode(c||a.target)});return{remove:function(){k.remove();h.remove();l.remove();f=k=
h=l=null}}}},_onBlurNode:function(b){b=(new Date).getTime();b<z+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(a.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),b<B+100||(this._clearActiveWidgetsTimer=setTimeout(a.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){B=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);h.contains(a,"dijitPopup")&&(a=a.firstChild);var f=[];try{for(;a;){var g=c.get(a,"dijitPopupParent");if(g)a=v.byId(g).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===r.body())break;a=d.get(a.ownerDocument).frameElement}else{var k=a.getAttribute&&a.getAttribute("widgetId"),p=k&&v.byId(k);p&&!("mouse"==b&&p.get("disabled"))&&f.unshift(k);a=a.parentNode}}}catch(l){}this._setStack(f,
b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(z=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var c=this.activeStack,d=c.length-1,f=a.length-1;if(a[f]!=c[d]){this.set("activeStack",a);var g;for(g=d;0<=g&&c[g]!=a[g];g--)if(d=v.byId(c[g]))d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(b),
this.emit("widget-blur",d,b);for(g++;g<=f;g++)if(d=v.byId(a[g]))d.set("focused",!0),d._focusManager==this&&d._onFocus(b),this.emit("widget-focus",d,b)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));s(function(){var a=t.registerWin(d.get(document));x("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});y.focus=function(a){t.focus(a)};for(var D in t)/^_/.test(D)||(y.focus[D]="function"==typeof t[D]?a.hitch(t,D):t[D]);t.watch(function(a,b,c){y.focus[a]=c});return t})},"dojo/DeferredList":function(){define(["./_base/kernel",
"./_base/Deferred","./_base/array"],function(l,m,k){l.DeferredList=function(c,h,f,g,a){var b=[];m.call(this);var l=this;0===c.length&&!h&&this.resolve([0,[]]);var x=0;k.forEach(c,function(a,k){function d(a,d){b[k]=[a,d];x++;x===c.length&&l.resolve(b)}a.then(function(a){h?l.resolve([k,a]):d(!0,a)},function(a){f?l.reject(a):d(!1,a);if(g)return null;throw a;})})};l.DeferredList.prototype=new m;l.DeferredList.prototype.gatherResults=function(c){c=new l.DeferredList(c,!1,!0,!1);c.addCallback(function(c){var f=
[];k.forEach(c,function(c){f.push(c[1])});return f});return c};return l.DeferredList})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(l,m,k,c,h,f,g,a,b,s){function x(a,b,c){return p&&c?function(a,b){return f(a,c,b)}:y?function(c,d){var g=f(c,b,function(a){d.call(this,a);M=(new Date).getTime()}),k=f(c,a,function(a){(!M||(new Date).getTime()>M+1E3)&&d.call(this,a)});return{remove:function(){g.remove();
k.remove()}}}:function(b,c){return f(b,a,c)}}function L(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function r(a,b,d){var g=L(a.target);if(B=!a.target.disabled&&g&&g.dojoClick)if(D=(t="useTarget"==B)?g:a.target,t&&a.preventDefault(),I=a.changedTouches?a.changedTouches[0].pageX-s.global.pageXOffset:a.clientX,J=a.changedTouches?a.changedTouches[0].pageY-s.global.pageYOffset:a.clientY,K=("object"==typeof B?B.x:"number"==typeof B?B:0)||4,G=("object"==typeof B?B.y:"number"==typeof B?B:
0)||4,!z){z=!0;var h=function(a){B=t?k.isDescendant(s.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-s.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-s.global.pageYOffset:a.clientY),D):B&&(a.changedTouches?a.changedTouches[0].target:a.target)==D&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-s.global.pageXOffset:a.clientX)-I)<=K&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-s.global.pageYOffset:a.clientY)-J)<=G};s.doc.addEventListener(b,function(a){h(a);
t&&a.preventDefault()},!0);s.doc.addEventListener(d,function(a){h(a);if(B){O=(new Date).getTime();var b=t?D:a.target;"LABEL"===b.tagName&&(b=k.byId(b.getAttribute("for"))||b);var c=a.changedTouches?a.changedTouches[0]:a,d=document.createEvent("MouseEvents");d._dojo_click=!0;d.initMouseEvent("click",!0,!0,a.view,a.detail,c.screenX,c.screenY,c.clientX,c.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);setTimeout(function(){f.emit(b,"click",d);O=(new Date).getTime()},0)}},!0);a=function(a){s.doc.addEventListener(a,
function(b){!b._dojo_click&&((new Date).getTime()<=O+1E3&&!("INPUT"==b.target.tagName&&c.contains(b.target,"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var d=5>g("ios"),p=g("pointer-events")||g("MSPointer"),
v=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=g("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),y=g("touch-events"),z,B,t=!1,D,I,J,K,G,O,M,H;p?b(function(){s.doc.addEventListener(v.down,function(a){r(a,v.move,v.up)},!0)}):y&&b(function(){function a(b){var c=h.delegate(b,{bubbles:!0});6<=g("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,
c.targetTouches=b.targetTouches);return c}H=s.body();s.doc.addEventListener("touchstart",function(a){M=(new Date).getTime();var b=H;H=a.target;f.emit(b,"dojotouchout",{relatedTarget:H,bubbles:!0});f.emit(H,"dojotouchover",{relatedTarget:b,bubbles:!0});r(a,"touchmove","touchend")},!0);f(s.doc,"touchmove",function(b){M=(new Date).getTime();var c=s.doc.elementFromPoint(b.pageX-(d?0:s.global.pageXOffset),b.pageY-(d?0:s.global.pageYOffset));c&&(H!==c&&(f.emit(H,"dojotouchout",{relatedTarget:c,bubbles:!0}),
f.emit(c,"dojotouchover",{relatedTarget:H,bubbles:!0}),H=c),f.emit(c,"dojotouchmove",a(b))||b.preventDefault())});f(s.doc,"touchend",function(b){M=(new Date).getTime();var c=s.doc.elementFromPoint(b.pageX-(d?0:s.global.pageXOffset),b.pageY-(d?0:s.global.pageYOffset))||s.body();f.emit(c,"dojotouchend",a(b))})});m={press:x("mousedown","touchstart",v.down),move:x("mousemove","dojotouchmove",v.move),release:x("mouseup","dojotouchend",v.up),cancel:x(a.leave,"touchcancel",p?v.cancel:null),over:x("mouseover",
"dojotouchover",v.over),out:x("mouseout","dojotouchout",v.out),enter:a._eventHandler(x("mouseover","dojotouchover",v.over)),leave:a._eventHandler(x("mouseout","dojotouchout",v.out))};return l.touch=m})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(l,m,k,c,h,f,g){h.add("highcontrast",function(){var a=g.doc.createElement("div");a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+
(m.blankGif||l.toUrl("./resources/blank.gif"))+'");';g.body().appendChild(a);var b=c.getComputedStyle(a),f=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||f&&("none"==f||"url(invalid-url:)"==f);8>=h("ie")?a.outerHTML="":g.body().removeChild(a);return b});f(function(){h("highcontrast")&&k.add(g.body(),"dj_a11y")});return h})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(l,m,k,c,h,f){l=c("dijit._OnDijitClickMixin",
null,{connect:function(c,a,b){return this.inherited(arguments,[c,"ondijitclick"==a?f:a,b])}});l.a11yclick=f;return l})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(l,
m,k,c,h,f,g,a,b,s,x,L,r,d,p,v,y,z,B,t,D,I,J,K,G,O,M,H,T,U,V,R,W,X,Y,Q,Z,S){var P=m([Z,y],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new g([64,64,64]),defaultText:"Aa",sizeRampLightColor:new g([255,255,255]),sizeRampDarkColor:new g([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,
_legendAlign:null,constructor:function(e,N){k.mixin(this,S.widgets.legend);this._i18n=S.widgets.legend;e=e||{};e.map?N?(this.map=e.map,this.layerInfos=e.layerInfos,this._respectCurrentMapScale=!1===e.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===e.respectVisibility?!1:!0,this.arrangement=e.arrangement===P.ALIGN_RIGHT?P.ALIGN_RIGHT:P.ALIGN_LEFT,this.arrangement===P.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===e.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},
this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var e=["ar","he"],a,b;for(a=0;a<e.length;a+=1)b=e[a],l.locale&&-1!==l.locale.indexOf(b)&&(-1!==l.locale.indexOf("-")?-1!==l.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":
"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>b("ie")&&(this._repaintItems=k.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(e){if(this.domNode){e?(this.layerInfos=
e,this.layers=[],c.forEach(this.layerInfos,function(e){this._isSupportedLayerType(e.layer)&&(e.title&&(e.layer._titleForLegend=e.title),e.layer._hideDefaultSymbol=!1===e.defaultSymbol?!0:!1,e.hideLayers?(this.hideLayersInLegend[e.layer.id]=e.hideLayers,this._addSubLayersToHide(e)):this.hideLayersInLegend[e.layer.id]=[],e.hoverLabel&&(e.layer._hoverLabel=e.hoverLabel),e.hoverLabels&&(e.layer._hoverLabels=e.hoverLabels),this.layers.push(e.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=
null);for(e=this.domNode.children.length-1;0<=e;e--)d.destroy(this.domNode.children[e]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],c.forEach(this.layerInfos,function(e){this._isSupportedLayerType(e.layer)&&(e.title&&(e.layer._titleForLegend=e.title),e.layer._hideDefaultSymbol=!1===e.defaultSymbol?!0:!1,e.hideLayers?(this.hideLayersInLegend[e.layer.id]=e.hideLayers,this._addSubLayersToHide(e)):
this.hideLayersInLegend[e.layer.id]=[],e.hoverLabel&&(e.layer._hoverLabel=e.hoverLabel),e.hoverLabels&&(e.layer._hoverLabels=e.hoverLabels),this.layers.push(e.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var e=[],a=[];c.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);var A;this._isSupportedLayerType(b)&&(b.arcgisProps&&b.arcgisProps.title&&(b._titleForLegend=b.arcgisProps.title),this.layers.push(b));"esri.layers.KMLLayer"==b.declaredClass&&
(A=b.getLayers(),c.forEach(A,function(a){e.push(a.id)},this));"esri.layers.GeoRSSLayer"==b.declaredClass&&(A=b.getFeatureLayers(),c.forEach(A,function(e){a.push(e.id)},this))},this);c.forEach(this.map.graphicsLayerIds,function(b){var A=this.map.getLayer(b);-1==c.indexOf(e,b)&&-1==c.indexOf(a,b)&&(this._isSupportedLayerType(A)&&A._params&&A._params.drawMode)&&(A.arcgisProps&&A.arcgisProps.title&&(A._titleForLegend=A.arcgisProps.title),this.layers.push(A))},this)}this._createLegend()},_activate:function(){this._deactivate();
this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=h.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=h.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=h.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=h.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),c.forEach(this.layers,function(e){e.ovcConnect=h.connect(e,"onVisibilityChange",this,"_refreshLayers");e.ovcConnect=
h.connect(e,"onOpacityChange",this,"_refreshLayers");e.oscConnect=h.connect(e,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===e.declaredClass&&e.supportsDynamicLayers&&(e.odcConnect=h.connect(e,"_onDynamicLayersChange",k.hitch(this,"_updateDynamicLayers",e)));"esri.layers.ArcGISImageServiceLayer"===e.declaredClass&&(e.oirConnect=h.connect(e,"onRenderingChange",k.partial(this._updateImageServiceLayers,this,e)));"esri.layers.ArcGISImageServiceVectorLayer"===
e.declaredClass&&(e.oivrConnect=h.connect(e,"onRendererChange",k.hitch(this,"_refreshLayers")))},this))},_deactivate:function(){this._ozeConnect&&h.disconnect(this._ozeConnect);this._olaConnect&&h.disconnect(this._olaConnect);this._olroConnect&&h.disconnect(this._olroConnect);this._olrConnect&&h.disconnect(this._olrConnect);c.forEach(this.layers,function(e){e.ovcConnect&&h.disconnect(e.ovcConnect);e.oscConnect&&h.disconnect(e.oscConnect);e.odcConnect&&h.disconnect(e.odcConnect);e.oirConnect&&h.disconnect(e.oirConnect);
e.oivrConnect&&h.disconnect(e.oivrConnect)},this)},_updateDynamicLayers:function(e){delete e.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(e,a){delete a.legendResponse;e._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];c.forEach(this.map.layerIds,function(e){e=this.map.getLayer(e);this._isSupportedLayerType(e)&&this.layers.push(e)},this);c.forEach(this.map.graphicsLayerIds,function(e){e=this.map.getLayer(e);this._isSupportedLayerType(e)&&
(e._params&&e._params.drawMode)&&this.layers.push(e)},this);this.refresh()},_createLegend:function(){var e=!1;p.set(this.domNode,"position","relative");d.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var a=[];c.forEach(this.layers,function(b){if("esri.layers.KMLLayer"==b.declaredClass||"esri.layers.GeoRSSLayer"==b.declaredClass){var E;b.loaded?("esri.layers.KMLLayer"==b.declaredClass?E=b.getLayers():"esri.layers.GeoRSSLayer"==b.declaredClass&&
(E=b.getFeatureLayers(),this.hideLayersInLegend[b.id]&&(E=c.filter(E,function(e){return-1==c.indexOf(this.hideLayersInLegend[b.id],e.id)},this))),c.forEach(E,function(e){"esri.layers.FeatureLayer"==e.declaredClass&&b._titleForLegend&&(e._titleForLegend=b._titleForLegend+" - ","esriGeometryPoint"==e.geometryType?e._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==e.geometryType?e._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==e.geometryType&&(e._titleForLegend+=this.NLS_polygons),a.push(e))},
this)):h.connect(b,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===b.declaredClass)if(b.loaded){if((!this._respectVisibility||this._respectVisibility&&b.visible)&&0<b.layerInfos.length&&c.some(b.layerInfos,function(e){return e.legendURL})){var C=!1;c.forEach(b.layerInfos,function(a){a.legendURL&&-1<c.indexOf(b.visibleLayers,a.name)&&(C||(d.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(b._titleForLegend||b.name||b.id)+"\x3c/span\x3e"},
this.domNode),C=!0),d.create("div",{innerHTML:"\x3cimg src\x3d'"+a.legendURL+"'/\x3e"},this.domNode),e=!0)},this)}}else h.connect(b,"onLoad",k.hitch(this,function(){this.refresh(this.layerInfos)}));else a.push(b)},this);var b=[];c.forEach(a,function(e){if(e.loaded){if((!this._respectVisibility||this._respectVisibility&&e.visible)&&(e.layerInfos||e.renderer||"esri.layers.ArcGISImageServiceLayer"==e.declaredClass)){var a=d.create("div",{id:this.id+"_"+e.id,style:{display:"none"},"class":"esriLegendService"});
d.create("span",{innerHTML:this._getServiceTitle(e),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},a)))));d.place(a,this.id,"first");e.legendResponse||e.renderer?this._createLegendForLayer(e):b.push(this._legendRequest(e))}}else var N=h.connect(e,"onLoad",this,function(e){h.disconnect(N);N=null;this.refresh()})},this);0===b.length&&!e?(r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new x(b)).addCallback(k.hitch(this,
function(a){e?r.byId(this.id+"_msg").innerHTML="":r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},_createLegendForLayer:function(e){if(e.legendResponse||e.renderer){var a=!1;if(e.legendResponse){var b=e.dynamicLayerInfos||e.layerInfos;b&&b.length?c.forEach(b,function(b,E){if(!this.hideLayersInLegend[e.id]||-1==c.indexOf(this.hideLayersInLegend[e.id],b.id)){var d=this._buildLegendItems(e,b,E);a=a||d}},this):"esri.layers.ArcGISImageServiceLayer"==e.declaredClass&&(a=this._buildLegendItems(e,
{id:0,name:null,title:e.name,subLayerIds:null,parentLayerId:-1},0))}else e.renderer&&(b=e.url?e.url.substring(e.url.lastIndexOf("/")+1,e.url.length):"fc_"+e.id,a=this._buildLegendItems(e,{id:b,name:null,subLayerIds:null,parentLayerId:-1},0));a&&(p.set(r.byId(this.id+"_"+e.id),"display","block"),p.set(r.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(e){if(e.loaded)return 10.01<=e.version?this._legendRequestServer(e):this._legendRequestTools(e);h.connect(e,"onLoad",k.hitch(this,"_legendRequest"))},
_legendRequestServer:function(e){var a=e.url,b=a.indexOf("?"),a=-1<b?a.substring(0,b)+"/legend"+a.substring(b):a+"/legend";(b=e._getToken())&&(a+="?token\x3d"+b);var A=k.hitch(this,"_processLegendResponse"),d={f:"json"};e._params.dynamicLayers&&(d.dynamicLayers=L.stringify(this._createDynamicLayers(e)),"[{}]"===d.dynamicLayers&&(d.dynamicLayers="[]"));e._params.bandIds&&(d.bandIds=e._params.bandIds);e._params.renderingRule?d.renderingRule=e._params.renderingRule:e.rasterFunctionInfos&&0<e.rasterFunctionInfos.length&&
c.forEach(e.rasterFunctionInfos,function(e){e&&(e.name&&"none"===e.name.toLowerCase())&&(d.renderingRule=L.stringify({rasterFunction:e.name}))});return J({url:a,content:d,callbackParamName:"callback",load:function(a,b){A(e,a,b)},error:I.defaults.io.errorHandler})},_legendRequestTools:function(e){var a=e.url.toLowerCase().indexOf("/rest/"),a=e.url.substring(0,a)+e.url.substring(a+5,e.url.length),a=this._legendUrl+"?soapUrl\x3d"+window.escape(a);if(!b("ie")||8<b("ie"))a+="\x26returnbytes\x3dtrue";var c=
k.hitch(this,"_processLegendResponse");return J({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,b){c(e,a,b)},error:I.defaults.io.errorHandler})},_processLegendResponse:function(e,a){a&&a.layers?(e.legendResponse=a,r.byId(this.id+"_"+e.id)&&d.empty(r.byId(this.id+"_"+e.id)),d.create("span",{innerHTML:this._getServiceTitle(e),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},r.byId(this.id+"_"+
e.id)))))),this._createLegendForLayer(e)):console.log("Legend could not get generated for "+e.url+": "+f.toJson(a))},_buildLegendItems:function(e,a,b){var c=!1,q=r.byId(this.id+"_"+e.id),C=a.parentLayerId;if(a.subLayerIds)e=d.create("div",{id:this.id+"_"+e.id+"_"+a.id+"_group",style:{display:"none"},"class":-1==C?0<b?"esriLegendGroupLayer":"":this._legendAlign},-1==C?q:r.byId(this.id+"_"+e.id+"_"+C+"_group")),d.create("td",{innerHTML:t.encode(a.name),align:this._align},d.create("tr",{},d.create("tbody",
{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},e))));else{if(this._respectVisibility&&e.visibleLayers&&-1==(","+e.visibleLayers+",").indexOf(","+a.id+","))return c;b=d.create("div",{id:this.id+"_"+e.id+"_"+a.id,style:{display:"none"},"class":-1<C?this._legendAlign:""},-1==C?q:r.byId(this.id+"_"+e.id+"_"+C+"_group"));d.create("td",{innerHTML:t.encode(a.name)||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},b))));
e.legendResponse?c=c||this._buildLegendItems_Tools(e,a,b):e.renderer&&(c=c||this._buildLegendItems_Renderer(e,a,b))}return c},_buildLegendItems_Tools:function(e,a,b){var A=a.parentLayerId,q=this.map.getScale(),C=!1,f=function(e,a){var b,c;for(b=0;b<e.length;b++)if(a.dynamicLayerInfos)for(c=0;c<a.dynamicLayerInfos[c].length;c++){if(a.dynamicLayerInfos[c].mapLayerId==e[b].layerId)return e[b]}else if(a.id==e[b].layerId)return e[b];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&
this._isLayerInScale(e,a,q)){var g=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===e.declaredClass||"esri.layers.ArcGISMapServiceLayer"===e.declaredClass)){var k=this._getEffectiveScale(e,a);if(k.minScale&&k.minScale<q||k.maxScale&&k.maxScale>q)g=!1}if(g){var q=f(e.legendResponse.layers,a),h=q.legendType,n=q.layerType,l=q.legend;if(l){"esri.layers.ArcGISImageServiceLayer"!==e.declaredClass&&this._sanitizeLegendResponse(e,q,a);b=d.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},b);var m=d.create("tbody",{},b);(e._hoverLabel||e._hoverLabels)&&this._createHoverAction(b,e,a);c.forEach(l,function(b){if(!(10.1<=e.version&&!b.values&&1<l.length&&(e._hideDefaultSymbol||"\x3call other values\x3e"===b.label||!b.label&&!("esri.layers.ArcGISImageServiceLayer"===e.declaredClass&&10.3<=e.version||"Raster Layer"===n))))if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)C=!0,this._buildRow_Tools(b,m,e,a.id,h)},this)}}}C&&(p.set(r.byId(this.id+
"_"+e.id+"_"+a.id),"display","block"),-1<A&&(p.set(r.byId(this.id+"_"+e.id+"_"+A+"_group"),"display","block"),this._findParentGroup(e.id,e,A)));return C},_sanitizeLegendResponse:function(e,a,b){var d=a.legend;if(10.1<=e.version&&1<d.length&&!a._sanitized){e=k.getObject("layerDefinition.drawingInfo.renderer",!1,b);var q,C;e||(e=k.getObject("drawingInfo.renderer",!1,b));c.some(d,function(e){if(e.values)return!0})&&c.some(d,function(e,a){e.values||(C=a,q=e);return!!q});e?"uniqueValue"===e.type?q&&(d.splice(C,
1),d.push(q)):"classBreaks"===e.type&&(q&&d.splice(C,1),d.reverse(),q&&d.push(q)):q&&(d.splice(C,1),d.push(q));a._sanitized=!0}},_buildRow_Tools:function(e,a,c,A,q){var C=d.create("tr",{},a),f;this.alignRight?(a=d.create("td",{align:this._isRightToLeft?"left":"right"},C),f=d.create("td",{align:this._isRightToLeft?"left":"right",width:35},C)):(f=d.create("td",{width:35,align:"center"},C),a=d.create("td",{},C));C=e.url;(!b("ie")||9<=b("ie")||9>b("ie")&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&
e.imageData&&0<e.imageData.length?C="data:image/png;base64,"+e.imageData:0!==e.url.indexOf("http")&&(C=c.url+"/"+A+"/images/"+e.url,(A=c._getToken())&&(C+="?token\x3d"+A));A=d.create("img",{src:C,border:0,style:"opacity:"+c.opacity},f);e=d.create("td",{innerHTML:t.encode(e.label),align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%",dir:"ltr"},a))));q&&("Stretched"===q&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&(e.style.verticalAlign=
"top",e.style.lineHeight="1",A.style.marginBottom="-1px",A.style.display="block",a.style.verticalAlign="top");9>b("ie")&&(A.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(e,a,b){var c;e&&(c=(e=e.getVisualVariablesForType(a,b))&&e[0]);return c},_getVariables:function(e,a,b){e=[this._getVariable(e,"colorInfo",!1),this._getVariable(e,"opacityInfo",!1),this._getVariable(e,"sizeInfo",!1)];return a?c.filter(e,function(e){return!(!e||!(e.field===a&&e.normalizationField==b))}):
e},_getFieldAlias:function(e,a){var b=a.infoTemplate,b=b&&b.getFieldInfo&&b.getFieldInfo(e),c=k.isFunction(e)?null:a.getField(e),d=b||c,f="";d&&(f=b&&b.label||c&&c.alias||d.name||d.fieldName);return f},_getRampTitle:function(e,a){var b,c=e.field,d=e.normalizationField,f=!1,g=!1,h=!1,w,c=k.isFunction(c)?null:c,d=k.isFunction(d)?null:d;if(e.legendOptions&&e.legendOptions.title)b=e.legendOptions.title;else{if(a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables){var u=a.renderer.authoringInfo.visualVariables;
for(w=0;w<u.length;w++){var n=u[w];if("colorInfo"===n.type&&"ratio"===n.style){f=!0;break}else if("colorInfo"===n.type&&"percent"===n.style){g=!0;break}else if("colorInfo"===n.type&&"percentTotal"===n.style){h=!0;break}}}(f=h&&"showRatioPercentTotal"||g&&"showRatioPercent"||f&&"showRatio"||d&&"showNormField"||c&&"showField"||null)&&(b=K.substitute({field:c&&this._getFieldAlias(c,a),normField:d&&this._getFieldAlias(d,a)},this._i18n[f]))}return b},_getRendererTitle:function(a,b){var c;if(a){var d,q,
f;a instanceof H&&(d=a.attributeField,q=a.normalizationField,f="percent-of-total"===a.normalizationType);d=k.isFunction(d)?null:d;(f=(q=k.isFunction(q)?null:q)&&"showNormField"||(f?"showNormPct":null)||d&&"showField"||null)&&(c=K.substitute({field:d&&this._getFieldAlias(d,b),normField:q&&this._getFieldAlias(q,b)},this._i18n[f]))}return c},_buildLegendItems_Renderer:function(a,b,E){var A=b.parentLayerId,q=this.map,f=q.getScale(),g,h=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,f)){var w,
u,n="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:a.renderer,l,m,s,v,B;if(n instanceof T&&(n=(n="zoom"===n.rangeType?n.getRendererInfoByZoom(q.getZoom()):n.getRendererInfoByScale(f))&&n.renderer,!n))return!1;var F=this._getVariables(n),x=c.filter(F,function(a){return!!a}).length,f=F[0],q=F[1],F=F[2],y,z;f&&(l=this._getMedianColor(n,f),f.field&&(s=k.isFunction(f.field)?null:a.getField(f.field)));q&&q.field&&(B=k.isFunction(q.field)?null:a.getField(q.field));F&&F.field&&
(v=k.isFunction(F.field)?null:a.getField(F.field));if(n instanceof W)g=h=!0,this._showHeatRamp(a,b,n,E);else if(n instanceof U)g=h=!0,this._showDotDensityLegend(a,b,n,E);else if(n instanceof V)g=h=!0,u=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),w=d.create("tbody",{},u),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(u,a,b),n.latestObservationRenderer&&n.latestObservationRenderer instanceof O&&this._buildRow_Renderer(a,n.latestObservationRenderer.symbol,
l,t.encode(n.latestObservationRenderer.label)||this.NLS_currentObservations,null,w),n.observationRenderer&&n.observationRenderer instanceof O&&this._buildRow_Renderer(a,n.observationRenderer.symbol,l,t.encode(n.observationRenderer.label)||this.NLS_previousObservations,null,w);else if(n instanceof M){if(n.infos&&0<n.infos.length){g=h=!0;u=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);w=d.create("tbody",{},u);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(u,
a,b);n.attributeField&&F&&this._addSubHeader(w,this._getFieldAlias(n.attributeField,a));var D=[];c.forEach(n.infos,function(b){var d=null;a._editable&&a.types&&(d=this._getTemplateFromTypes(a.types,b.value));var N=b.label;null==N&&(N=b.value);-1===c.indexOf(D,N)&&(D.push(N),this._buildRow_Renderer(a,b.symbol,l,t.encode(N),d,w))},this)}z=this._displayDefaultSymbol(a,n,E)}else if(n instanceof H){if(n.infos&&0<n.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){g=h=!0;y=this._isUnclassedRenderer(n);
!f&&1===n.infos.length&&(m=(m=n.infos[0])&&m.symbol);y||(u=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),w=d.create("tbody",{},u),x=this._getRendererTitle(n,a),this._buildRow_Renderer(a,null,l,t.encode(x),null,w));u=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E);w=d.create("tbody",{},u);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(u,a,b);if(!y||!F)x=n.infos.slice(0).reverse(),c.forEach(x,function(b){var c=
b.label;null==c&&!y&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,l,t.encode(c),null,w)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===R.STYLE_SCALAR||a.renderer.style===R.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,n.defaultSymbol,null,"",null,w),a._hideDefaultSymbol=!0}y||(z=this._displayDefaultSymbol(a,n,E))}else n instanceof O&&(g=h=!0,u=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},E),
w=d.create("tbody",{},u),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(u,a,b),m=null,a._editable&&(a.templates&&0<a.templates.length)&&(m=a.templates[0]),u=1<x?null:s||B||v,this._buildRow_Renderer(a,n.symbol,l,t.encode(u?this._getRampTitle(1<x?null:f||q||F,a):n.label),m,w),m=f?null:n.symbol,u&&(s=B=v=null));if(g){if(f&&(f.field||f.valueExpression))this._showGradientRamp(a,b,n,null,E,f,s,null,F?!0:!1);if(F&&(F.field||F.valueExpression))g=f||n instanceof M?!1:!0,this._showSizeLegend(a,b,
n,F,l,E,v,null,g);if(q&&(q.field||q.valueExpression))v=m&&!m.url&&m.color?m.color:this.transparencyRampColor,this._showGradientRamp(a,b,n,v,E,q,B,null,!1)}z||(z=this._displayDefaultSymbol(a,n,E));h=h||z}h&&(p.set(r.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<A&&(p.set(r.byId(this.id+"_"+a.id+"_"+A+"_group"),"display","block"),this._findParentGroup(a.id,A)));return h},_isUnclassedRenderer:function(a,b){var c;if(a instanceof H&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;
c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,c){var f;!a._hideDefaultSymbol&&b.defaultSymbol&&(f=!0,c=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),c=d.create("tbody",{},c),this._buildRow_Renderer(a,b.defaultSymbol,null,t.encode(b.defaultLabel)||"others",null,c));return f},_showGradientRamp:function(a,b,c,f,q,g,k,h,w){w=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!w?" esriLegendSubFragment":
"")},q);q=d.create("tbody",{},w);(a._hoverLabel||a._hoverLabels||h)&&this._createHoverAction(w,a,b,h);(k||g.valueExpression)&&this._addSubHeader(q,this._getRampTitle(g,a));(b=this._getRampStops(c,g,f))&&b.length&&this._drawGradientRamp(q,b,!0,a,this._getRampBorderColor(c),!!f)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,d){var f,
q,k,h,l=!1;b.colors||b.opacityValues?(q=b.maxDataValue-b.minDataValue,f=c.map([0,0.25,0.5,0.75,1],function(a){k=b.minDataValue+a*q;return Number(k.toFixed(6))}),this._checkPrecision(0,4,f)):b.stops&&(f=c.map(b.stops,function(a){return a.value}),(l=c.some(b.stops,function(a){return!!a.label}))&&(h=c.map(b.stops,function(a){return a.label})));var w=f[0],u,n,m;q=f[f.length-1]-w;return c.map(f,function(c,k){d?(u=new g(d.toRgba()),n=a.getOpacity(c,{opacityInfo:b}),null!=n&&(u.a=n)):u=a.getColor(c,{colorInfo:b});
m="";0===k?m=this._specialChars.lt+" ":k===f.length-1&&(m=this._specialChars.gt+" ");return{value:c,color:u,offset:1-(c-w)/q,label:l?h[k]:m+G.format(c)}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,f=c[a],g=c[d],k=c[b],h=Math.floor(f),w=Math.floor(g),l=Math.floor(k);h===f&&(l===k&&w!==g&&h!==w&&l!==w)&&(c[d]=w);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof O)b=a.symbol;else if(a instanceof M||a instanceof
H)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,f,E,A,q,k){var h=d.create("tr",{},a),l,w,m,n,r,s=f.length-1,v;n=0;this.alignRight?(a=d.create("td",{align:this._isRightToLeft?"left":"right"},h),l=d.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},h)):(l=d.create("td",{width:this.gradientWidth,align:"center"},h),a=d.create("td",{},h));h=q&&0<q.a&&!(240<=q.r&&240<=q.g&&240<=q.b);w=d.create("div",
{"class":h?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},l);l=d.create("div",{"class":"esriLegendColorRamp"+(k?" esriLegendTransparencyRamp":"")},w);k=p.get(l,"width");h&&(q=9>b("ie")?q.toHex():"rgba("+q.toRgba().join(",")+")",p.set(l,"border",this.colorRampBorder+" "+q));E?(q=this.gradientHeight*s,p.set(l,"height",q+"px")):q=p.get(l,"height");p.set(w,"height",q+"px");h=z.createSurface(l,k,q);9>b("ie")&&(n=h.getEventSource(),p.set(n,"position","relative"),
p.set(n.parentNode,"position","relative"),n=1);try{E&&c.forEach(f,function(a,b){a.offset=b/s}),r=h.createRect({x:-n,y:-n,width:k+n,height:q+n}),r.setFill({type:"linear",x1:0,y1:0,x2:0,y2:q,colors:f}).setStroke(null),h.createRect({width:k,height:q}).setFill(new g([255,255,255,1-A.opacity])).setStroke(null),this._surfaceItems.push(h)}catch(x){h.clear(),h.destroy()}c.forEach(f,function(a,b){if(a.label){v="top:"+100*a.offset+"%;";var e="";0===b&&(e+=" esriLegendColorRampTickFirst");b===f.length-1&&(e+=
" esriLegendColorRampTickLast");d.create("div",{"class":"esriLegendColorRampTick"+e,innerHTML:"\x26nbsp;",style:v},w)}});m=d.create("div",{"class":"esriLegendColorRampLabels",style:{height:q+this.gradientHeight+"px"}},a);E?c.forEach(f,function(a){d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:t.encode(a.label)||"\x26nbsp;"},m)}):(d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},m),d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,
style:"top: "+(q+this.gradientHeight-2*this.gradientHeight)+"px;"},m))},_showHeatRamp:function(a,b,c,f,g){var k,h=c.field;k=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f);f=d.create("tbody",{},k);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(k,a,b,g);(h=h&&a.getField(h))&&this._addSubHeader(f,this._getFieldAlias(h.name,a));b=this._getHeatmapStops(c);b.length&&this._drawGradientRamp(f,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=
a.colors;var d,f,g,k;if(b&&b[0])if(d=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[d])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),d++}else f=b[0].value,g=b[d].value-f,b=c.map(b,function(a){return{color:a.color,ratio:(a.value-f)/g}});else a&&a[0]&&(d=a.length-1,k=1/(a.length-1),b=c.map(a,function(a,b){return{color:a,ratio:b*k}}));b=c.map(b,function(a,b){var e="";0===b?e="Low":b===d&&(e="High");return{color:a.color,label:e,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,
b,f,g){var q=f.legendOptions,h,l,m,w,u,n,p,r=this.dotDensitySwatchSize,s=Math.round(r/2);q&&(l=q.backgroundColor,m=q.outline,w=q.valueUnit,u=q.dotCoverage);u=(u||this.dotCoverage)/100;p=Math.round(r*r/Math.pow(f.dotSize,2)*u);g=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);n=d.create("tbody",{},g);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,b);this._addSubHeader(n,K.substitute({value:f.dotValue,unit:w||""},this.NLS_dotValue));c.forEach(f.fields,
function(b){b=k.mixin({},b);b.numPoints=p;h=new X(f._generateImageSrc(r,r,[b],{x:0,y:0},{x:r,y:r},l),m||f.outline,r,r);b=a.getField(b.name)||b;this._buildRow_Renderer(a,h,null,t.encode(this._getFieldAlias(b.name,a)),null,n,{type:"path",path:"M "+-s+","+-s+" L "+s+","+-s+" L "+s+","+s+" L "+-s+","+s+" L "+-s+","+-s+" E"})},this)},_showSizeLegend:function(a,b,c,f,g,k,h,l,m){var u=f.legendOptions,u=u&&u.customValues;g=this._getSizeSymbol(c,g);if(!(f.valueUnit&&"unknown"!==f.valueUnit||!g||!u&&(null==
f.minSize||null==f.maxSize))){m=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!m?" esriLegendSubFragment":"")},k);k=d.create("tbody",{},m);(a._hoverLabel||a._hoverLabels||l)&&this._createHoverAction(m,a,b,l);(h||f.valueExpression)&&this._addSubHeader(k,this._getRampTitle(f,a));b=u||this._getDataValues(c,g,f);for(h=m=b.length-1;0<=h;h--)l=b[h],g=Q.fromJson(g.toJson()),this._applySize(g,c,f,l),l=G.format(l),u="",h===m?u=this._specialChars.gt+" ":0===h&&(u=this._specialChars.lt+
" "),u="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+t.encode(u+l)+"\x3c/span\x3e",this._buildRow_Renderer(a,g,null,u,null,k)}},_getSizeSymbol:function(a,b){var c,d;if(a instanceof O)c=a.symbol;else if(a instanceof R)c=a.defaultSymbol;else if(a instanceof M||a instanceof H)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=Q.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new g(this.sizeRampDarkColor)):(c.setColor(new g(this.sizeRampLightColor)),
c.setOutline&&(d=new Y,d.setColor(new g(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,d,f,g){f=null==f?5:f;g=null==g?20:g;var k=a.getSizeRangeAtScale(d,this.map.getScale());f=this._interpolateSizeRange(k,f);var h=c.map(f,function(a){return this._getDataValueFromSize(a,d,k)},this),l,m,h=G.round(h);for(l=1;l<h.length-1;l++)if(m=this._roundDataValue(a,b,d,h[l],h[l-1],g))h[l]=m[0],f[l]=m[1];return h},_interpolateSizeRange:function(a,b){var c=a.minSize,
d=(a.maxSize-c)/(b-1),f,g=[];for(f=0;f<b;f++)g.push(c+d*f);return g},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var f=b.minDataValue;b=b.maxDataValue;return a=a<=d?f:a>=c?b:(a-d)/(c-d)*(b-f)+f},_roundDataValue:function(a,b,c,d,f,g){var k=this._getSize(b,a,c,d);f=this._getSize(b,a,c,f);var h,l=G.getDigits(d),m=l.integer,l=l.fractional,n,p,s,r,t,v,x,B,y,z,D;0<d&&1>d&&(h=Math.pow(10,l),d*=h,m=G.getDigits(d).integer);for(m-=1;0<=m&&!(n=Math.pow(10,m),l=Math.floor(d/n)*n,n*=Math.ceil(d/
n),null!=h&&(l/=h,n/=h),p=(l+n)/2,p=G.round([l,p,n],{indexes:[1]})[1],s=this._getSize(b,a,c,l),r=this._getSize(b,a,c,n),t=this._getSize(b,a,c,p),v=G.getPctChange(k,s,f,null),x=G.getPctChange(k,r,f,null),B=G.getPctChange(k,t,f,null),y=v.prev<=g,z=x.prev<=g,y&&z&&(v.prev<=x.prev?(y=!0,z=!1):(z=!0,y=!1)),y?D=[l,s]:z?D=[n,r]:B.prev<=g&&(D=[p,t]),D);m--);return D},_applySize:function(a,b,c,d){var f=a.type;b=this._getSize(a,b,c,d);switch(f){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":f=
a.width;c=a.height;a.setHeight(b);a.setWidth(b*(f/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,f,g,k,h){var l=d.create("tr",{},k),m;this.alignRight?(k=d.create("td",{align:this._isRightToLeft?"left":"right"},l),b&&(m=d.create("td",{align:this._isRightToLeft?
"left":"right",width:35},l))):(b&&(m=d.create("td",{width:35,align:"center"},l)),k=d.create("td",{},l));var p=l=30,n;if(b){if("simplemarkersymbol"==b.type)l=Math.min(Math.max(l,b.size+12),125),p=Math.min(Math.max(p,b.size+12),125);else if("picturemarkersymbol"==b.type)l=Math.min(Math.max(l,b.width),125),p=Math.min(b.height||p,125);else if("textsymbol"==b.type){var s,r;b.text||(s=b.text,r=!0,b.setText(this.defaultText));l=Math.min(Math.max(l,b.getWidth()+12),125);p=Math.min(Math.max(p,b.getHeight()+
12),125);r&&b.setText(s)}n=d.create("div",{style:"width:"+l+"px;height:"+p+"px;"},m)}K.isDefined(f)&&"number"===typeof f&&(f=""+f);d.create("td",{innerHTML:f||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},k))));b&&(a=this._drawSymbol(n,b,c,l,p,g,a,h),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=d.create("tr",{},a),c=d.create("td",{align:this._align,colspan:2},c);d.create("td",{innerHTML:t.encode(b)||"",align:this._align},d.create("tr",
{},d.create("tbody",{},d.create("table",{width:"95%"},c))))},_drawSymbol:function(a,c,d,f,h,l,m,s){c=Q.fromJson(c.toJson());var r=m.opacity;d&&c.setColor(new g(d.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=r;c.color.setColor(d)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&(d=c.color.toRgba(),d[3]*=r,c.color.setColor(d)),c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),
d[3]*=r,c.outline.color.setColor(d))):"picturemarkersymbol"===c.type&&(a.style.opacity=r,a.style.filter="alpha(opacity\x3d("+100*r+"))");a=z.createSurface(a,f,h);9>b("ie")&&(d=a.getEventSource(),p.set(d,"position","relative"),p.set(d.parentNode,"position","relative"));l=this._getDrawingToolShape(c,l)||Q.getShapeDescriptors(c);var u,r=(d=l.defaultShape)&&"text"===d.type;try{r&&!d.text&&(d.text=this.defaultText),u=a.createShape(s||d).setFill(l.fill).setStroke(l.stroke),r&&u.setFont(l.font)}catch(n){a.clear();
a.destroy();return}var t=u.getBoundingBox();s=t.width;l=t.height;var r=-(t.x+s/2),v=-(t.y+l/2);d=a.getDimensions();r={dx:r+d.width/2,dy:v+d.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)f=m._getScaleMatrix(t,c.size),u.applyTransform(B.scaleAt(f.xx,f.yy,{x:d.width/2,y:d.height/2}));else if(s>f||l>h)m=s/f>l/h,f=((m?f:h)-5)/(m?s:l),k.mixin(r,{xx:f,yy:f});u.applyTransform(r);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c=
{type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),
stroke:a.getStroke()}},_repaintItems:function(){c.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&k.isArray(a.children)&&c.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,f){if(f=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||f)f=t.encode(f),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=
h.connect(a,"onmousemove",k.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(r.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(k.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,r.byId(this.id+"_hoverLabel")){var e=r.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";p.set(e,"top",b+"px");p.set(e,"left",a+15+"px");p.set(e,"display",
"")}else d.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},f)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=h.connect(a,"onmouseout",k.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(r.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;c.forEach(this.layers,
function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)h.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)h.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],d;c.forEach(a.dynamicLayerInfos||a.layerInfos,function(c){d={id:c.id};d.source=c.source&&c.source.toJson();var f;a.layerDefinitions&&a.layerDefinitions[c.id]&&(f=a.layerDefinitions[c.id]);f&&(d.definitionExpression=f);var g;a.layerDrawingOptions&&a.layerDrawingOptions[c.id]&&
(g=a.layerDrawingOptions[c.id]);g&&(d.drawingInfo=g.toJson());d.minScale=c.minScale||0;d.maxScale=c.maxScale||0;b.push(d)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,f=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<f.length;d++)if(c==f[d].id){-1<f[d].parentLayerId&&(p.set(r.byId(this.id+"_"+a+"_"+f[d].parentLayerId+"_group"),"display","block"),
this._findParentGroup(a,b,f[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(d,f){var g=a.layer.dynamicLayerInfos||a.layer.layerInfos,h,k;for(h=0;h<g.length;h++)if(g[h].id===d&&g[h].subLayerIds)for(k=0;k<g[h].subLayerIds.length;k++){var l=g[h].subLayerIds[k];-1===c.indexOf(f,l)&&(f.push(l),b(l,f))}}a.layer.layerInfos&&c.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,f=!0;if(a.legendResponse&&
a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var g=a.legendResponse.layers[d];if(b.id==g.layerId){var h,k;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(h=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(k=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(h=Math.min(a.minScale,g.minScale)||a.minScale||g.minScale,k=Math.max(a.maxScale,g.maxScale));if(0<h&&h<c||k>c)f=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<
c||a.maxScale&&a.maxScale>c)f=!1;return f},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):
b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],K.isDefined(a)&&(b+=" ("+a+")"));return t.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(K.isDefined(b.parentLayerId)){var f=a.layerInfos,g=b.parentLayerId,h;for(h=f.length-1;0<=h;h--)if(f[h].id==
g)if(0==c&&0<f[h].minScale?c=f[h].minScale:0<c&&0==f[h].minScale||0<c&&0<f[h].minScale&&(c=Math.min(c,f[h].minScale)),d=Math.max(d||0,f[h].maxScale||0),-1<f[h].parentLayerId)g=f[h].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===
a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});k.mixin(P,{ALIGN_LEFT:0,ALIGN_RIGHT:1});b("extend-esri")&&k.setObject("dijit.Legend",P,D);return P});